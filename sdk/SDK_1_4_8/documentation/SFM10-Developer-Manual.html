<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>SFM10 Developer Manual 1.4.8</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: 1;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">SFM10 Developer Manual 1.4.8</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a>
<ul>
<li><a href="#uwb" id="toc-uwb">UWB</a></li>
</ul></li>
<li><a href="#hardware-components" id="toc-hardware-components">Hardware
Components</a>
<ul>
<li><a href="#sfm10-mod" id="toc-sfm10-mod">SFM10-MOD</a>
<ul>
<li><a href="#key-features" id="toc-key-features">Key Features</a></li>
<li><a href="#product-photos" id="toc-product-photos">Product
Photos</a></li>
<li><a href="#order-information" id="toc-order-information">Order
Information</a></li>
<li><a href="#product-content" id="toc-product-content">Product
Content</a></li>
<li><a href="#layout" id="toc-layout">Layout</a></li>
<li><a href="#pinout" id="toc-pinout">Pinout</a></li>
<li><a href="#power-consumption" id="toc-power-consumption">Power
Consumption</a></li>
<li><a href="#dimensions" id="toc-dimensions">Dimensions</a></li>
</ul></li>
<li><a href="#sfm10-dev" id="toc-sfm10-dev">SFM10-DEV</a>
<ul>
<li><a href="#key-features-1" id="toc-key-features-1">Key
Features</a></li>
<li><a href="#product-photos-1" id="toc-product-photos-1">Product
Photos</a></li>
<li><a href="#order-information-1" id="toc-order-information-1">Order
Information</a></li>
<li><a href="#product-content-1" id="toc-product-content-1">Product
Content</a></li>
<li><a href="#layout-1" id="toc-layout-1">Layout</a></li>
<li><a href="#pinout-1" id="toc-pinout-1">Pinout</a></li>
<li><a href="#schematic" id="toc-schematic">Schematic</a></li>
</ul></li>
<li><a href="#sfm10-kit" id="toc-sfm10-kit">SFM10-KIT</a>
<ul>
<li><a href="#key-features-2" id="toc-key-features-2">Key
Features</a></li>
<li><a href="#product-photos-2" id="toc-product-photos-2">Product
Photos</a></li>
<li><a href="#order-information-2" id="toc-order-information-2">Order
Information</a></li>
<li><a href="#product-content-2" id="toc-product-content-2">Product
Content</a></li>
<li><a href="#tutorials" id="toc-tutorials">Tutorials</a></li>
</ul></li>
<li><a href="#sfm10-dongle" id="toc-sfm10-dongle">SFM10-DONGLE</a>
<ul>
<li><a href="#product-photos-3" id="toc-product-photos-3">Product
Photos</a></li>
<li><a href="#order-information-3" id="toc-order-information-3">Order
Information</a></li>
<li><a href="#product-content-3" id="toc-product-content-3">Product
Content</a></li>
</ul></li>
<li><a href="#sfm10-wearable" id="toc-sfm10-wearable">SFM10-WEARABLE</a>
<ul>
<li><a href="#product-photos-4" id="toc-product-photos-4">Product
Photos</a></li>
<li><a href="#order-information-4" id="toc-order-information-4">Order
Information</a></li>
<li><a href="#product-content-4" id="toc-product-content-4">Product
Content</a></li>
</ul></li>
<li><a href="#sfm10-socket" id="toc-sfm10-socket">SFM10-SOCKET</a>
<ul>
<li><a href="#product-photos-5" id="toc-product-photos-5">Product
Photos</a></li>
<li><a href="#order-information-5" id="toc-order-information-5">Order
Information</a></li>
<li><a href="#product-content-5" id="toc-product-content-5">Product
Content</a></li>
</ul></li>
<li><a href="#sfm10-demo" id="toc-sfm10-demo">SFM10-DEMO</a>
<ul>
<li><a href="#product-photos-6" id="toc-product-photos-6">Product
Photos</a></li>
<li><a href="#order-information-6" id="toc-order-information-6">Order
Information</a></li>
<li><a href="#product-content-6" id="toc-product-content-6">Product
Content</a></li>
</ul></li>
</ul></li>
<li><a href="#software-development"
id="toc-software-development">Software Development</a>
<ul>
<li><a href="#getting-started" id="toc-getting-started">Getting
Started</a>
<ul>
<li><a href="#steps" id="toc-steps">Steps</a></li>
</ul></li>
<li><a href="#what-did-synchronicit-add-to-the-ol23d0"
id="toc-what-did-synchronicit-add-to-the-ol23d0">What did SynchronicIT
add to the OL23D0?</a></li>
<li><a href="#what-does-the-bootloader-do"
id="toc-what-does-the-bootloader-do">What does the Bootloader
do?</a></li>
<li><a href="#what-does-the-uwb-library-do"
id="toc-what-does-the-uwb-library-do">What does the UWB Library
do?</a></li>
<li><a href="#what-is-the-user-application"
id="toc-what-is-the-user-application">What is the User
Application?</a></li>
<li><a href="#what-does-the-user-application-look-like"
id="toc-what-does-the-user-application-look-like">What does the User
Application look like?</a>
<ul>
<li><a href="#setup" id="toc-setup"><code>setup()</code></a></li>
<li><a href="#loop" id="toc-loop"><code>loop()</code></a></li>
<li><a href="#errno" id="toc-errno"><code>errno</code></a></li>
</ul></li>
<li><a href="#what-are-uwb.-functions"
id="toc-what-are-uwb.-functions">What are UWB.* functions?</a></li>
</ul></li>
<li><a href="#software-development-setup"
id="toc-software-development-setup">Software Development Setup</a>
<ul>
<li><a href="#cp210x-driver" id="toc-cp210x-driver">CP210X
Driver</a></li>
<li><a href="#cmake" id="toc-cmake">CMake</a></li>
<li><a href="#python" id="toc-python">Python</a></li>
<li><a href="#compiler" id="toc-compiler">Compiler</a></li>
<li><a href="#visual-studio-code" id="toc-visual-studio-code">Visual
Studio Code</a></li>
<li><a href="#ninja" id="toc-ninja">Ninja</a></li>
<li><a href="#checkup" id="toc-checkup">Checkup</a></li>
<li><a href="#visual-code-and-python-extensions"
id="toc-visual-code-and-python-extensions">Visual Code and Python
Extensions</a></li>
<li><a href="#upload-a-sketch" id="toc-upload-a-sketch">Upload a
Sketch</a></li>
</ul></li>
<li><a href="#built-in-examples" id="toc-built-in-examples">Built-in
Examples</a>
<ul>
<li><a href="#example-hello-world"
id="toc-example-hello-world">example-hello-world</a></li>
<li><a href="#example-blinky-led"
id="toc-example-blinky-led">example-blinky-led</a></li>
<li><a href="#example-user-button"
id="toc-example-user-button">example-user-button</a></li>
<li><a href="#example-uart-echo"
id="toc-example-uart-echo">example-uart-echo</a></li>
<li><a href="#example-boot-reasons"
id="toc-example-boot-reasons">example-boot-reasons</a></li>
<li><a href="#example-timed-leds"
id="toc-example-timed-leds">example-timed-leds</a></li>
<li><a href="#example-ss-twr"
id="toc-example-ss-twr">example-ss-twr</a></li>
<li><a href="#example-uwb-settings"
id="toc-example-uwb-settings">example-uwb-settings</a></li>
<li><a href="#example-shield-illuminance-sensor"
id="toc-example-shield-illuminance-sensor">example-shield-illuminance-sensor</a></li>
<li><a href="#example-shield-buzzer"
id="toc-example-shield-buzzer">example-shield-buzzer</a></li>
<li><a href="#example-shield-pir"
id="toc-example-shield-pir">example-shield-pir</a></li>
<li><a href="#example-shield-sht30"
id="toc-example-shield-sht30">example-shield-sht30</a></li>
<li><a href="#example-transmit-sht30"
id="toc-example-transmit-sht30">example-transmit-sht30</a></li>
<li><a href="#example-shield-led-matrix"
id="toc-example-shield-led-matrix">example-shield-led-matrix</a></li>
<li><a href="#example-asynchronous-programming"
id="toc-example-asynchronous-programming">example-asynchronous-programming</a></li>
<li><a href="#example-clock-speeds"
id="toc-example-clock-speeds">example-clock-speeds</a></li>
<li><a href="#example-radar"
id="toc-example-radar">example-radar</a></li>
</ul></li>
<li><a href="#general-user-application-api"
id="toc-general-user-application-api">General User Application API</a>
<ul>
<li><a href="#general-error-codes" id="toc-general-error-codes">General
Error Codes</a></li>
<li><a href="#power" id="toc-power">Power</a>
<ul>
<li><a href="#getresetreason"
id="toc-getresetreason"><code>getResetReason()</code></a></li>
<li><a href="#reset" id="toc-reset"><code>reset()</code></a></li>
<li><a href="#sleeptime-pin-pinedge"
id="toc-sleeptime-pin-pinedge"><code>sleep(time, pin, pinEdge)</code></a></li>
<li><a href="#deepsleeppin"
id="toc-deepsleeppin"><code>deepSleep(pin)</code></a></li>
<li><a href="#limitcurrentmilliamps"
id="toc-limitcurrentmilliamps"><code>limitCurrent(milliAmps)</code></a></li>
<li><a href="#persistentread"
id="toc-persistentread"><code>persistentRead()</code></a></li>
<li><a href="#persistentwritevalue"
id="toc-persistentwritevalue"><code>persistentWrite(value)</code></a></li>
</ul></li>
<li><a href="#digital-io-gpio" id="toc-digital-io-gpio">Digital I/O
(GPIO)</a>
<ul>
<li><a href="#pinmodepinmask-mode"
id="toc-pinmodepinmask-mode"><code>pinMode(pinMask, mode)</code></a></li>
<li><a href="#digitalwritepinmask-value"
id="toc-digitalwritepinmask-value"><code>digitalWrite(pinMask, value)</code></a></li>
<li><a href="#digitalreadpinmask"
id="toc-digitalreadpinmask"><code>digitalRead(pinMask)</code></a></li>
<li><a href="#analogreadchannel"
id="toc-analogreadchannel"><code>analogRead(channel)</code></a></li>
</ul></li>
<li><a href="#timing-functions" id="toc-timing-functions">Timing
functions</a>
<ul>
<li><a href="#millis" id="toc-millis"><code>millis()</code></a></li>
<li><a href="#micros" id="toc-micros"><code>micros()</code></a></li>
<li><a href="#micros64"
id="toc-micros64"><code>micros64()</code></a></li>
<li><a href="#ticks" id="toc-ticks"><code>ticks()</code></a></li>
<li><a href="#delaytimems"
id="toc-delaytimems"><code>delay(timeMs)</code></a></li>
<li><a href="#delaymicrosecondstime"
id="toc-delaymicrosecondstime"><code>delayMicroseconds(time)</code></a></li>
<li><a href="#getxtalppbadc_ext_temperature"
id="toc-getxtalppbadc_ext_temperature"><code>getXtalPpb(adc_ext_temperature)</code></a></li>
</ul></li>
<li><a href="#timer-class" id="toc-timer-class">Timer class</a>
<ul>
<li><a href="#timer.setwatchdogtimeoutms"
id="toc-timer.setwatchdogtimeoutms"><code>Timer.setWatchdog(timeoutMs)</code></a></li>
<li><a href="#timer.kickwatchdog"
id="toc-timer.kickwatchdog"><code>Timer.kickWatchdog()</code></a></li>
<li><a href="#timer.begin"
id="toc-timer.begin"><code>Timer.begin()</code></a></li>
<li><a href="#timer.attimems-function"
id="toc-timer.attimems-function"><code>Timer.at(timeMs, function)</code></a></li>
<li><a href="#timer.atmicrosecondstimeus-function"
id="toc-timer.atmicrosecondstimeus-function"><code>Timer.atMicroseconds(timeUs, function)</code></a></li>
<li><a href="#timer.attickstimeticks-function"
id="toc-timer.attickstimeticks-function"><code>Timer.atTicks(timeTicks, function)</code></a></li>
<li><a href="#timer.atcount"
id="toc-timer.atcount"><code>Timer.atCount()</code></a></li>
<li><a href="#timer.everytimems-function"
id="toc-timer.everytimems-function"><code>Timer.every(timeMs, function)</code></a></li>
<li><a href="#timer.everymicrosecondstimeus-function"
id="toc-timer.everymicrosecondstimeus-function"><code>Timer.everyMicroseconds(timeUs, function)</code></a></li>
<li><a href="#timer.end"
id="toc-timer.end"><code>Timer.end()</code></a></li>
<li><a href="#timer.clearoneshots"
id="toc-timer.clearoneshots"><code>Timer.clearOneShots()</code></a></li>
<li><a href="#timer.clearperiodic"
id="toc-timer.clearperiodic"><code>Timer.clearPeriodic()</code></a></li>
</ul></li>
<li><a href="#interrupts" id="toc-interrupts">Interrupts</a>
<ul>
<li><a href="#attachinterruptsource-function-mode"
id="toc-attachinterruptsource-function-mode"><code>attachInterrupt(source, function, mode)</code></a></li>
<li><a href="#detachinterruptsource"
id="toc-detachinterruptsource"><code>detachInterrupt(source)</code></a></li>
<li><a href="#nointerrupts"
id="toc-nointerrupts"><code>noInterrupts()</code></a></li>
<li><a href="#interruptscounter"
id="toc-interruptscounter"><code>interrupts(counter)</code></a></li>
<li><a href="#waitforeventtimems"
id="toc-waitforeventtimems"><code>waitForEvent(timeMs)</code></a></li>
<li><a href="#triggereventeventmask"
id="toc-triggereventeventmask"><code>triggerEvent(eventMask)</code></a></li>
<li><a href="#cleareventeventmask"
id="toc-cleareventeventmask"><code>clearEvent(eventMask)</code></a></li>
<li><a href="#readevents"
id="toc-readevents"><code>readEvents()</code></a></li>
</ul></li>
<li><a href="#uart" id="toc-uart">UART</a>
<ul>
<li><a href="#serial.beginbaudrate"
id="toc-serial.beginbaudrate"><code>Serial.begin(baudRate)</code></a></li>
<li><a href="#serial.available"
id="toc-serial.available"><code>Serial.available()</code></a></li>
<li><a href="#serial.read"
id="toc-serial.read"><code>Serial.read()</code></a></li>
<li><a href="#serial.readbytesbuffer-length"
id="toc-serial.readbytesbuffer-length"><code>Serial.readBytes(buffer, length)</code></a></li>
<li><a href="#serial.writebuffer-length"
id="toc-serial.writebuffer-length"><code>Serial.write(buffer, length)</code></a></li>
<li><a href="#serial.settimeouttimems"
id="toc-serial.settimeouttimems"><code>Serial.setTimeout(timeMs)</code></a></li>
<li><a href="#serial.hexdumpbuffer-length-columns"
id="toc-serial.hexdumpbuffer-length-columns"><code>Serial.hexDump(buffer, length, columns)</code></a></li>
<li><a href="#serial.print"
id="toc-serial.print"><code>Serial.print()</code></a></li>
<li><a href="#serial.sprint"
id="toc-serial.sprint"><code>Serial.sprint(, )</code></a></li>
<li><a href="#serial.printint64value-buffer"
id="toc-serial.printint64value-buffer"><code>Serial.printInt64(value, buffer)</code></a></li>
<li><a href="#serial.printerror"
id="toc-serial.printerror"><code>Serial.printError()</code></a></li>
<li><a href="#serial.end"
id="toc-serial.end"><code>Serial.end()</code></a></li>
</ul></li>
<li><a href="#serial-peripheral-interface-spi"
id="toc-serial-peripheral-interface-spi">Serial Peripheral Interface
(SPI)</a>
<ul>
<li><a href="#spi.begin"
id="toc-spi.begin"><code>SPI.begin()</code></a></li>
<li><a href="#spi.begintransactionsettings"
id="toc-spi.begintransactionsettings"><code>SPI.beginTransaction(settings)</code></a></li>
<li><a href="#spi.readrxbuffer-rxlength"
id="toc-spi.readrxbuffer-rxlength"><code>SPI.read(rxBuffer, rxLength)</code></a></li>
<li><a href="#spi.writetxbuffer-txlength"
id="toc-spi.writetxbuffer-txlength"><code>SPI.write(txBuffer, txLength)</code></a></li>
<li><a href="#spi.transfertxbuffer-rxbuffer-length"
id="toc-spi.transfertxbuffer-rxbuffer-length"><code>SPI.transfer(txBuffer, rxBuffer, length)</code></a></li>
<li><a href="#spi.count"
id="toc-spi.count"><code>SPI.count()</code></a></li>
<li><a href="#spi.endtransaction"
id="toc-spi.endtransaction"><code>SPI.endTransaction()</code></a></li>
<li><a href="#spi.end" id="toc-spi.end"><code>SPI.end()</code></a></li>
</ul></li>
<li><a href="#two-wire-interface-i2c"
id="toc-two-wire-interface-i2c">Two Wire Interface (I2C)</a>
<ul>
<li><a href="#i2c.beginsdapinmask-sclpinmask"
id="toc-i2c.beginsdapinmask-sclpinmask"><code>I2C.begin(sdaPinMask, sclPinMask)</code></a></li>
<li><a href="#i2c.write..."
id="toc-i2c.write..."><code>I2C.write(...)</code></a></li>
<li><a href="#i2c.read..."
id="toc-i2c.read..."><code>I2C.read(...)</code></a></li>
<li><a href="#i2c.end" id="toc-i2c.end"><code>I2C.end()</code></a></li>
</ul></li>
<li><a href="#numbers" id="toc-numbers">Numbers</a>
<ul>
<li><a href="#getrandommin-max"
id="toc-getrandommin-max"><code>getRandom(min, max)</code></a></li>
<li><a href="#randomseedseed"
id="toc-randomseedseed"><code>randomSeed(seed)</code></a></li>
<li><a href="#usqrtvalue"
id="toc-usqrtvalue"><code>usqrt(value)</code></a></li>
<li><a href="#getserialnumber"
id="toc-getserialnumber"><code>getSerialNumber()</code></a></li>
<li><a href="#getcurrentcrc"
id="toc-getcurrentcrc"><code>getCurrentCrc()</code></a></li>
<li><a href="#getantennadelay"
id="toc-getantennadelay"><code>getAntennaDelay()</code></a></li>
<li><a href="#gethardwareid"
id="toc-gethardwareid"><code>getHardwareId()</code></a></li>
</ul></li>
<li><a href="#cryptography" id="toc-cryptography">Cryptography</a>
<ul>
<li><a href="#crypto.begin"
id="toc-crypto.begin"><code>Crypto.begin()</code></a></li>
<li><a href="#crypto.randombytesdestination-size"
id="toc-crypto.randombytesdestination-size"><code>Crypto.randomBytes(destination, size)</code></a></li>
<li><a href="#crypto.configcrc..."
id="toc-crypto.configcrc..."><code>Crypto.configCrc(...)</code></a></li>
<li><a href="#crypto.calccrcsource-length"
id="toc-crypto.calccrcsource-length"><code>Crypto.calcCrc(source, length)</code></a></li>
<li><a href="#crypto.configencryption..."
id="toc-crypto.configencryption..."><code>Crypto.configEncryption(...)</code></a></li>
<li><a href="#crypto.configdecryption..."
id="toc-crypto.configdecryption..."><code>Crypto.configDecryption(...)</code></a></li>
<li><a href="#crypto.encrypt..."
id="toc-crypto.encrypt..."><code>Crypto.encrypt(...)</code></a></li>
<li><a href="#crypto.decrypt..."
id="toc-crypto.decrypt..."><code>Crypto.decrypt(...)</code></a></li>
<li><a href="#crypto.end"
id="toc-crypto.end"><code>Crypto.end()</code></a></li>
</ul></li>
<li><a href="#eeprom" id="toc-eeprom">EEPROM</a>
<ul>
<li><a href="#eeprom.readaddress"
id="toc-eeprom.readaddress"><code>EEPROM.read(address)</code></a></li>
<li><a href="#eeprom.writeaddress-value"
id="toc-eeprom.writeaddress-value"><code>EEPROM.write(address, value)</code></a></li>
<li><a href="#eeprom.readbytesbuffer-address-length"
id="toc-eeprom.readbytesbuffer-address-length"><code>EEPROM.readBytes(buffer, address, length)</code></a></li>
<li><a href="#eeprom.writebytesbuffer-address-length"
id="toc-eeprom.writebytesbuffer-address-length"><code>EEPROM.writeBytes(buffer, address, length)</code></a></li>
</ul></li>
</ul></li>
<li><a href="#ultra-wideband-control-api"
id="toc-ultra-wideband-control-api">Ultra-wideband Control API</a>
<ul>
<li><a href="#device" id="toc-device">Device</a>
<ul>
<li><a href="#uwb.ondevicestatusupdatecallback-devicestatus"
id="toc-uwb.ondevicestatusupdatecallback-devicestatus"><code>UWB.onDeviceStatusUpdate(callback, deviceStatus)</code></a></li>
<li><a href="#uwb.resetdevice"
id="toc-uwb.resetdevice"><code>UWB.resetDevice()</code></a></li>
<li><a href="#uwb.getdeviceinfooutput"
id="toc-uwb.getdeviceinfooutput"><code>UWB.getDeviceInfo(output)</code></a></li>
<li><a href="#uwb.enterpowermodeinput"
id="toc-uwb.enterpowermodeinput"><code>UWB.enterPowerMode(input)</code></a></li>
<li><a href="#uwb.setpersistentreginput"
id="toc-uwb.setpersistentreginput"><code>UWB.setPersistentReg(input)</code></a></li>
<li><a href="#uwb.getpersistentregoutput"
id="toc-uwb.getpersistentregoutput"><code>UWB.getPersistentReg(output)</code></a></li>
<li><a href="#uwb.otaupdatereceiveinput"
id="toc-uwb.otaupdatereceiveinput"><code>UWB.otaUpdateReceive(input)</code></a></li>
<li><a href="#uwb.otaupdatetransmitinput"
id="toc-uwb.otaupdatetransmitinput"><code>UWB.otaUpdateTransmit(input)</code></a></li>
</ul></li>
<li><a href="#configuration" id="toc-configuration">Configuration</a>
<ul>
<li><a href="#uwb.setconfigurationinput"
id="toc-uwb.setconfigurationinput"><code>UWB.setConfiguration(input)</code></a></li>
<li><a href="#uwb.getconfigurationoutput"
id="toc-uwb.getconfigurationoutput"><code>UWB.getConfiguration(output)</code></a></li>
<li><a href="#uwb.storerxradioconfiginput"
id="toc-uwb.storerxradioconfiginput"><code>UWB.storeRxRadioConfig(input)</code></a></li>
<li><a href="#uwb.storetxradioconfiginput"
id="toc-uwb.storetxradioconfiginput"><code>UWB.storeTxRadioConfig(input)</code></a></li>
<li><a href="#uwb.importkeyinput"
id="toc-uwb.importkeyinput"><code>UWB.importKey(input)</code></a></li>
<li><a href="#uwb.getticksoutput"
id="toc-uwb.getticksoutput"><code>UWB.getTicks(output)</code></a></li>
<li><a href="#uwb.setpayloadinput"
id="toc-uwb.setpayloadinput"><code>UWB.setPayload(input)</code></a></li>
</ul></li>
<li><a href="#actions" id="toc-actions">Actions</a>
<ul>
<li><a href="#uwb.ontxupdatecallback-txtimestamp"
id="toc-uwb.ontxupdatecallback-txtimestamp"><code>UWB.onTxUpdate(callback, txTimestamp)</code></a></li>
<li><a
href="#uwb.onrxupdatecallback-rxtimestamp-payload-capacity-firstpathinfo-cir"
id="toc-uwb.onrxupdatecallback-rxtimestamp-payload-capacity-firstpathinfo-cir"><code>UWB.onRxUpdate(callback, rxTimestamp, payload, capacity, firstPathInfo, cir)</code></a></li>
<li><a href="#uwb.onloopbackupdatecallback-loopbacktimestamp"
id="toc-uwb.onloopbackupdatecallback-loopbacktimestamp"><code>UWB.onLoopbackUpdate(callback, loopbackTimestamp)</code></a></li>
<li><a href="#uwb.begin"
id="toc-uwb.begin"><code>UWB.begin()</code></a></li>
<li><a href="#uwb.starttxinput"
id="toc-uwb.starttxinput"><code>UWB.startTx(input)</code></a></li>
<li><a href="#uwb.startrxinput"
id="toc-uwb.startrxinput"><code>UWB.startRx(input)</code></a></li>
<li><a href="#uwb.startcontinuousrxinput"
id="toc-uwb.startcontinuousrxinput"><code>UWB.startContinuousRx(input)</code></a></li>
<li><a href="#uwb.startloopbackinput"
id="toc-uwb.startloopbackinput"><code>UWB.startLoopback(input)</code></a></li>
<li><a href="#uwb.recalcrxinput"
id="toc-uwb.recalcrxinput"><code>UWB.recalcRx(input)</code></a></li>
<li><a href="#uwb.stopaction"
id="toc-uwb.stopaction"><code>UWB.stopAction()</code></a></li>
<li><a href="#uwb.getcirinput-output"
id="toc-uwb.getcirinput-output"><code>UWB.getCir(input, output)</code></a></li>
<li><a href="#uwb.end" id="toc-uwb.end"><code>UWB.end()</code></a></li>
</ul></li>
<li><a href="#uci-status-codes" id="toc-uci-status-codes">UCI Status
Codes</a></li>
<li><a href="#radio-config-table" id="toc-radio-config-table">Radio
Config Table</a></li>
</ul></li>
</ul>
</nav>
<h1 id="introduction">Introduction</h1>
<p>The SFM10 Module is designed for mobile, wearable electronics,
Internet-of-Things (IoT), agriculture, healthcare, and automotive
applications. It provides UWB capabilities with a minimal number of
external components required. It houses the NXP Trimension (TM) OL23D0,
which enables secure ranging and precision sensing across devices.</p>
<p>The module contains easy-to-use hardware and software, allowing
anyone to create UWB solutions that fit their needs with the least
amount of effort. A positioning system can be built using just SFM10
Modules.</p>
<p>This user manual provides an introduction to the SFM10-DEV
development board and its capabilities. The document consists of an
overview of the hardware components, a brief introduction to UWB and an
explanation of the SFM firmware structure. Then, the API definitions are
described followed by an explanation on how to create distance
measurements between modules.</p>
<h3 id="uwb">UWB</h3>
<p>UWB is a radio technology that is fundamentally different from the
conventional carrier wave methods in telecommunication. With a carrier
wave signal, the transmitter emits a waveform at a certain frequency
(for example ~2.4 GHz for WiFi). This waveform is emitted for some
period of time and the receiver is tuned to pick up this electromagnetic
energy at this specific wave-length. To encode digital data, the
transmitter slightly modulates the signal (e.g., varying amplitude or
phase).</p>
<p>However, UWB does not use a carrier wave: an UWB radio is an
impulse-radio that utilizes patterns of extremely brief bursts of
electromagnetic energy. Compared to a carrier wave signal, the UWB
signal is much harder to detect, because electromagnetic bursts could
have several causes and the receiver must have quite some knowledge of
what pattern to expect in order to be able to detect it.</p>
<p>The pulse pattern is composed of four parts:</p>
<ol type="1">
<li>preamble: a repetitive pattern (i.e. sync code) that is used for
signal detection</li>
<li>start of frame delimiter: a pattern that marks the end of the
preamble</li>
<li>STS sequence: randomness for extra security. This part is
optional.</li>
<li>Payload: digital data. This part is also optional.</li>
</ol>
<p>Because the electromagnetic signal is composed of very brief pulses,
we can obtain very precise timing capabilities. When a pulse travels
through the air, it could hit and bounce off physical obstacles like
walls or ceiling. The receiver will pick up the energy of the pulse,
including these reflections. However, because the pulse is so short in
time, the reflections will not overlap, but arrive as distinct pulses at
the receiver. The very first burst of electromagnetic energy that
arrives at the receiver is usually the most interesting: it is the
signal of interest that must have traveled in a straight line from
transmitter to receiver and therefore can be used to compute the
distance.</p>
<h1 id="hardware-components">Hardware Components</h1>
<h2 id="sfm10-mod">SFM10-MOD</h2>
<p>The SFM10-MOD module is built around the fully integrated and
programmable NXP Trimension (TM) OL23D0. This module offers
self-contained Ultra-Wideband (UWB) networking capabilities, adhering to
the IEEE 802.15.4z standard. The OL23D0 integrates a microcontroller,
security extensions, and UWB radio circuitry, making it an efficient
solution for various applications.</p>
<p>Designed for mobile, wearable electronics, Internet of Things (IoT),
agriculture, and automotive applications, the this module offers UWB
networking capabilities with minimal external components. It features
all the necessary decoupling capacitors to stabilize internal voltages
and utilizes a ceramic antenna for UWB signal transmission and
reception. The module’s compact size of approximately 24x15mm and
connections on both sides with 50mil (1.27mm) spacing enhance its
versatility.</p>
<p>The OL23D0 enables secure ranging and precision sensing across
devices. As a fully integrated single-chip Impulse Radio Ultra-Wideband
(IR-UWB) low-energy transceiver IC, it complies with both IEEE 802.15.4
HRP UWB PHY and IEEE 802.15.4z BPRF/HPRF UWB PHY for secure ranging. It
can accurately determine distances up to 5 cm. Additionally, it supports
data transfer rates of up to 6.8 Mbps (BPRF) and 7.8 Mbps (HPRF).</p>
<p>UWB technology provides precise, secure, real-time localization
capabilities. Our philosophy is to make this promising technology
accessible to everyone, even the least experienced programmer. We’ve
designed a complementary programming environment in the C language,
complete with ample documentation and examples, to ensure an intuitive,
user-friendly, and fast development experience.</p>
<h3 id="key-features">Key Features</h3>
<ul>
<li><strong>Single-Chip UWB Solution</strong>: The SFM10 stands out as
the world’s only single-chip Ultra-Wideband (UWB) solution, streamlining
design and reducing complexity.</li>
<li><strong>Integrated RF Components</strong>: The module integrates all
essential and optimized RF components, ensuring efficient performance
without the need for external add-ons.</li>
<li><strong>Global UWB Coverage</strong>: Supporting SHF UWB bands
spanning from 6.0 GHz to 8.5 GHz, the SFM10 is suitable for worldwide
deployment.</li>
<li><strong>IEEE 802.15.4 HRP UWB PHY</strong>: The module adheres to
the IEEE 802.15.4 High-Rate Pulse (HRP) UWB PHY, enabling high-speed
data transmission.</li>
<li><strong>Secure Radio Technology</strong>: Compliant with the IEEE
802.15.4z standard, the SFM10 employs secure radio technology for
reliable communication.</li>
<li><strong>Versatile Data Rates</strong>: 110 kbps (BPRF) for robust
communication. 850 kbps (BRRF) for efficient data exchange. 6.8 Mbps
(BPRF) and 7.8 Mbps (HPRF) for diverse application needs.</li>
<li><strong>Narrowband Interference Filtering</strong>: The SFM10
incorporates a filtering stage to block unwanted narrowband
interferences, ensuring clean signals.</li>
<li><strong>Programmable Transmitter Power</strong>: Achieve optimal
range and efficiency with a programmable transmitter output power of up
to 30 dBm peak.</li>
<li><strong>Scrambled Timestamp Sequence (STS)</strong>: The module
generates STS compliant with NIST SP 800-90A, enhancing security.</li>
<li><strong>32-Bit Arm Cortex Microcontroller</strong>: The SFM10
features an Arm Cortex-based 32-bit microcontroller with built-in
security extensions.</li>
<li><strong>XTAL Sharing</strong>: An XO buffer allows sharing the
crystal oscillator (XTAL) with other devices (e.g., UHF or BLE
transceivers).</li>
<li><strong>True Random Number Generation (TRNG)</strong>: Secure
applications benefit from the TRNG capability.</li>
<li><strong>Flexible Communication Interfaces</strong>: SPI, UART, and
(software) I2C compatibility for seamless integration.</li>
<li><strong>Integrated temperature sensor </strong>for precise clock
compensation.</li>
<li><strong>Coin Cell Battery Support</strong>: The module offers a
configurable current limiter, ideal for applications powered by coin
cell batteries.</li>
<li><strong>Optimized Low-Power Modes</strong>: Extend battery life with
efficient low-power modes.</li>
<li><strong>High Accuracy Distance Measurement</strong>: Leverage UWB
for precise distance determination (up to 5 cm accuracy).</li>
<li><strong>DW1000 and DW3000 Compatibility</strong>: The SFM10 is
compatible with the popular DW1000 and DW3000 UWB transceivers.</li>
<li><strong>Internal Timers</strong>: Utilize internal timers for
precise scheduling in your applications.</li>
<li><strong>User-Friendly Programming Environment</strong>: Enjoy a
simple and clear programming environment (C language) with ample
documentation and examples.</li>
<li><strong>Sub-Microsecond Wireless GPIO Timestamping</strong>: Achieve
precise synchronization between devices with sub-microsecond
accuracy.</li>
<li><strong>Wide Supply Voltage Range</strong>: The module operates from
1.8V to 3.6V.</li>
<li><strong>Flexible Programming Options</strong>: Programmable via UART
for ease of configuration. Programmable via USB using an FTDI chip or
equivalent.</li>
</ul>
<h3 id="product-photos">Product Photos</h3>
<p><img src="figures/photos/SFM10-MOD-REEL_0856.jpg" /></p>
<p><img src="figures/photos/SFM10-MOD_0688.jpg" /></p>
<p><img src="figures/photos/SFM10-MOD_0695.jpg" /></p>
<p><img src="figures/photos/SFM10-MOD_0697.jpg" /></p>
<p><img src="figures/photos/SFM10-MOD_0699.jpg" /></p>
<p><img src="figures/photos/SFM10-MOD_0701.jpg" /></p>
<p><img src="figures/photos/SFM10-MOD_0703.jpg" /></p>
<p><img src="figures/photos/SFM10-MOD-REEL_0866.jpg" /></p>
<h3 id="order-information">Order Information</h3>
<p>Part Number: SFM10-MOD</p>
<p>Price: EUR 19,-</p>
<p>Where to order: info@synchronicit.nl</p>
<h3 id="product-content">Product Content</h3>
<ul>
<li>Single SFM10 Module</li>
</ul>
<h3 id="layout">Layout</h3>
<p><img src="figures/SFM10%20components.png" /> <em>SFM10
components</em></p>
<p>Within the SFM10-MOD, we encounter the following essential
components:</p>
<ul>
<li><p>The module is equipped with an <strong>RF shield</strong>, a
protective layer made of metal. This shield serves the crucial purpose
of electromagnetic shielding, effectively preventing external signals
from disrupting the operation of the module’s sensitive radio
circuitry.</p></li>
<li><p>The <strong>OL23D0</strong> is the sole chip on the board. Within
the OL23D0 UWB transceiver of the module, there resides a 32-bit
Cortex-M33 microcontroller equipped with security extensions. This
microcontroller, designed by ARM, specifically targets the Internet of
Things (IoT) and embedded applications that demand robust security or
precise digital signal control. Developers can create their own software
(referred to as firmware) to guide the microcontroller’s actions, as
detailed in the User Application Development section.</p></li>
<li><p>Positioned at the corner of the module, a ceramic
<strong>antenna</strong> known as the Johansson 7000AT18A1600 serves as
the on-board antenna. With an overall gain of -0.5 dB within the
frequency range of 6200-8240 MHz, this antenna has been meticulously
tuned to achieve a robust omnidirectional radiation pattern.</p></li>
<li><p>The heartbeat of every microcontroller lies within its oscillator
circuit. This electronic circuit generates clock pulses that synchronize
the execution of instructions throughout the chip. When the module boots
up, it initially utilizes an internal oscillator operating at
approximately 38.4 MHz. However, it’s important to note that the exact
speed is variable, influenced by factors such as the chip’s temperature.
As the chip heats up, the oscillator’s frequency decreases. During a UWB
session, specialized UWB circuitry comes into play, relying on a more
precise oscillator circuit. To accommodate this, an external crystal
(<strong>XTAL</strong>) is positioned next to the chip, operating at a
stable 55.2 MHz. This crystal ensures the necessary precision for UWB
communication.</p></li>
</ul>
<h3 id="pinout">Pinout</h3>
<p><img src="figures/SFM10%20pinout.png" /> <em>SFM10 pinout</em></p>
<ul>
<li><strong>Pin 1</strong>: Ground (digital)</li>
<li><strong>Pin 2</strong>: Power supply buffer, VBUF. Internally
connected to VBAT (pin 3 and 21) via a programmable current limiter.
VBUF is the main power input when using an external power supply. Leave
VBUF unconnected when battery powered, enabling the internal
programmable current limiter.</li>
<li><strong>Pin 3</strong>: VBAT. Power supply for digital I/Os and
power supply for the chip via current limiter. Connect VBAT to a
battery, or connect VBAT to VBUF when no current limiter is needed.</li>
<li><strong>Pin 4</strong>: Ground (digital)</li>
<li><strong>Pin 5</strong>: General-purpose input/output bit number 8 /
Output gating signal for an optional external Power Amplifier (PA) /
UART CTS / boot mode selection.</li>
<li><strong>Pin 6</strong>: General-purpose input/output bit number 6 /
Data input (RX) in LIN/UART operation.</li>
<li><strong>Pin 7</strong>: General-purpose input/output bit number 7 /
Data output (TX) in LIN/UART operation.</li>
<li><strong>Pin 8</strong>: General-purpose input/output bit number 9 /
Alternative Slave Select / Chip Select (active low) named CS2; output in
SPI Master operation; input in SPI Slave operation / boot mode
selection.</li>
<li><strong>Pin 9</strong>: XTAL Out. Outputs a Clock Reference (typical
27.6MHz) for external IC. XTAL clock output buffer, optionally divided.
Trapezoid-wave with configurable slope to guaranty minimum 0.6Vpp at
typical 27.6MHz</li>
<li><strong>Pin 10</strong>: Serial Wire Debug (SWD) clock, with an
internal pull-up resistor</li>
<li><strong>Pin 11</strong>: Serial Wire Debug (SWD) data, with an
internal pull-up resistor</li>
<li><strong>Pin 12</strong>: Ground (digital)</li>
<li><strong>Pin 13</strong>: Ground (digital)</li>
<li><strong>Pin 14</strong>: Reset input (active low), with an internal
pull-up resistor. To perform a reset, RST shall be active for at least 5
us.</li>
<li><strong>Pin 15</strong>: General-purpose input/output bit number 1 /
Data clock for SPI operation (SCK); output in SPI Master operation;
input in SPI Slave operation.</li>
<li><strong>Pin 16</strong>: General-purpose input/output bit number 3 /
Data input for SPI full duplex operation (MISO in SPI Master
operation).</li>
<li><strong>Pin 17</strong>: General-purpose input/output bit number 2 /
Data output for SPI full duplex operation (MOSI in SPI Master
operation).</li>
<li><strong>Pin 18</strong>: General-purpose input/output bit number 0 /
Slave Select / Chip Select (active low) named CS1; output in SPI Master
operation; input in SPI Slave operation</li>
<li><strong>Pin 19</strong>: General-purpose input/output bit number 5 /
Interrupt output (active low) in SPI operation.</li>
<li><strong>Pin 20</strong>: General-purpose input/output bit number 4 /
Ready output (active low) in 6-wire SPI operation</li>
<li><strong>Pin 21</strong>: An alternative to VBAT at pin 3.</li>
<li><strong>Pin 22</strong>: An alternative to VBUF at pin 2.</li>
<li><strong>Pin 23</strong>: Ground (digital)</li>
<li><strong>Pin 24</strong>: Ground (digital)</li>
</ul>
<h3 id="power-consumption">Power Consumption</h3>
<p><img src="figures/datasheet/fig1_Hard_Power_Down.png" /></p>
<p>The Hard Power Down (HPD) mode has the lowest power consumption. When
in HPD, the device can wakeup only via GPIO.</p>
<p><img src="figures/datasheet/fig2_Deep_Power_Down.png" /></p>
<p>The Deep Power Down (DPD) mode has the second lowest power
consumption. When in DPD, the device can wakeup via an internal timer or
via GPIO. See the <a href="/docs?topic=example-clock-speeds">Clock
Speeds example</a>.</p>
<p><img src="figures/datasheet/fig3_CPU-Only.png" /></p>
<p>When the SFM10 wakes up, the UWB Circuitry is not yet powered. This
state we refer to as CPU-only.</p>
<p><img src="figures/datasheet/fig4_UWB_Circuitry.png" /></p>
<p><img src="figures/datasheet/fig5_UWB_RX.png" /></p>
<p>When the UWB Circuitry is activated, and RX is active, the most power
is consumed.</p>
<p><img src="figures/datasheet/fig6_UWB_10Hz_TX_.png" /></p>
<p>UWB TX is relatively short with a power consumption comparable to RX.
The figure (10Hz TX) shows the average power consumption during the
following: Transmit Serial Number over UWB then go to DPD (about 6ms
CPU, 1ms UWB, and 93ms asleep).</p>
<h3 id="dimensions">Dimensions</h3>
<p><img src="figures/datasheet/SFM10_dimensions.png" /></p>
<p><img
src="figures/datasheet/sfm10-mode-footprint-guidelines.png" /></p>
<h2 id="sfm10-dev">SFM10-DEV</h2>
<p>The SFM10-DEV development board is specifically designed for
evaluating the capabilities of the SFM10-MOD. The SFM10-DEV board
combines convenience, programmability, and educational resources to
empower developers exploring the exciting world of UWB technology.
Whether you’re a seasoned programmer or a curious beginner, this
platform invites you to unlock the potential of precise localization and
spatial awareness.</p>
<p><strong>Form Factor and Compatibility</strong>: The SFM10-DEV adopts
the form factor of the popular <strong>Wemos D1 mini series</strong>.
This design choice ensures compatibility with generic D1 shields,
allowing developers to easily enhance the board’s functionality. By
leveraging D1 shields, users can add features such as sensors, displays,
or communication modules without complex wiring or soldering.</p>
<p><strong>I/O Headers for Breadboarding</strong>:</p>
<pre><code>                The spacing of the I/O headers on the SFM10-DEV is **100mil (2.54mm)**. This aligns perfectly with a standard breadboard and dupont cables.
                Whether you&#39;re connecting sensors, actuators, or other components, the breadboard-friendly layout simplifies prototyping and experimentation.</code></pre>
<p><strong>Micro-USB Connectivity</strong>:<br />
The SFM10-DEV features a <strong>micro-USB</strong> port that connects
to an <strong>on-board CP2102 (Silicon Labs)</strong> chip. The CP2102
acts as a bridge between the USB interface and the UART pins of the
SFM10 Module. Through this serial port interface, users can upload their
custom applications to the Module.</p>
<p><strong>Flexible Power Options</strong>:<br />
Developers have multiple power sources to choose from, ensuring
adaptability to various scenarios: * <strong>USB Port</strong>: The
board can be powered directly via the micro-USB port. * <strong>External
Supply</strong>: An external power supply (up to 6V) can be connected. *
<strong>Battery Operation</strong>: The SFM10-DEV accepts battery power
within the range of 1.8V to 3.6V.</p>
<p><strong>Unlocking UWB Technology</strong>:</p>
<pre><code>                The SFM10-DEV is all about Ultra-Wideband (UWB) technology.
                UWB provides precise, secure, real-time localization capabilities.
                Imagine giving spatial awareness to smart device, enabling them to understand their position and surroundings with remarkable accuracy.
            
                Our mission is to make UWB accessible to everyone, regardless of their programming expertise.
                The C language programming environment, coupled with extensive documentation and examples, ensures a smooth learning curve.</code></pre>
<p>The SFM10-DEV is part of the comprehensive SFM10 Evaluation Kit. The
kit includes tutorials that cover essential concepts:</p>
<ul>
<li>Clock Synchronization: Understanding how devices synchronize their
internal clocks.</li>
<li>Time of Flight (ToF): Grasping the time taken by signals to travel
between devices.</li>
<li>Time Division Multiple Access (TDMA): Learning about efficient
channel access in UWB networks.</li>
</ul>
<p><strong>Single-Chip Wonder</strong>:<br />
The SFM10 Module stands out as the world’s only single-chip UWB
solution. Its integration of all necessary RF components simplifies
development and accelerates time-to-market.</p>
<p>In summary, the SFM10-DEV combines technical excellence, ease of use,
and comprehensive features to empower developers.</p>
<h3 id="key-features-1">Key Features</h3>
<ul>
<li><strong>Convenient Evaluation Platform</strong>: The SFM10-DEV
serves as a convenient board specifically designed for evaluating the
capabilities of the SFM10-MOD. Whether you’re a seasoned developer or a
curious enthusiast, this platform simplifies the exploration of UWB
technology.</li>
<li><strong>Single-Chip UWB Solution</strong>: The module stands out as
the world’s only single-chip UWB solution. Its integration of all
essential RF components streamlines development and accelerates
time-to-market.</li>
<li><strong>Programmable via USB (via UART)</strong>: The SFM10-DEV is
programmable via USB, thanks to the on-board CP2102 (Silicon Labs) chip.
The CP2102 bridges the USB interface to the UART pins of the module,
allowing seamless application uploads.</li>
<li><strong>Smooth Learning Curve</strong>: The SFM10-DEV offers a very
good learning curve for developers. Whether you’re new to UWB or an
experienced programmer, the platform ensures an accessible and intuitive
experience.</li>
<li><strong>Wide UWB Band Support</strong>: The board supports SHF UWB
bands spanning from 6.0 GHz to 8.5 GHz, making it suitable for worldwide
use. This versatility enables applications across different regions and
regulatory domains.</li>
<li><strong>Secure Radio Technology</strong>: The SFM10-DEV incorporates
secure radio technology compliant with the IEEE 802.15.4z standard.
Security-conscious developers can confidently build applications with
robust communication.</li>
<li><strong>High Data Rates</strong>: The module achieves impressive
data rates: 110 kbps (BPRF), 850 kbps (BRRF), 6.8 Mbps (BPRF), 7.8 Mbps
(HPRF). These rates cater to diverse use cases, from low-power sensor
networks to high-throughput applications.</li>
<li><strong>Effective Narrowband Interference Filtering</strong>: The
board features a filtering stage that effectively blocks narrowband
interferences. This ensures reliable communication even in noisy
environments.</li>
<li><strong>Adjustable Transmitter Output Power</strong>: Developers can
program the transmitter output power of the SFM10-DEV, reaching up to 30
dBm peak. Fine-tune the power level based on application
requirements.</li>
<li><strong>NIST-Compliant Scrambled Timestamp Sequence (STS)</strong>:
The SFM10-DEV generates Scrambled Timestamp Sequences compliant with
NIST SP 800-90A. These sequences play a crucial role in precise
time-of-flight measurements.</li>
<li><strong>Robust Microcontroller Core</strong>: The board houses an
Arm Cortex-based 32-bit microcontroller with security extensions. This
powerful core handles computation and security tasks efficiently.</li>
<li><strong>XTAL Sharing and True Random Number Generation</strong>: An
XO buffer allows sharing the crystal oscillator (XTAL) with other
devices (e.g., UHF or BLE transceivers). The board also boasts true
random number generation (TRNG) for cryptographic applications.</li>
<li><strong>Versatile Communication Interfaces</strong>: The SFM10-DEV
supports SPI, UART, and (software) I2C communication. Developers can
choose the most suitable interface for their specific use case.</li>
<li><strong>Temperature Compensation and Low-Power Modes</strong>: An
integrated temperature sensor compensates for clock variations due to
temperature changes. The board offers optimized low-power modes,
extending battery life in energy-efficient applications.</li>
<li><strong>Precise Distance Measurement and Timers</strong>: Achieve
high-accuracy distance measurement using UWB technology. Internal timers
allow precise scheduling for various tasks.</li>
<li><strong>User-Friendly Programming Environment</strong>: The
SFM10-DEV provides a simple, clear programming environment. Whether
you’re writing custom firmware or experimenting with examples, the
platform encourages rapid development.</li>
<li><strong>Sub-Microsecond Wireless GPIO Timestamping</strong>: The
board supports sub-microsecond wireless GPIO timestamping. This feature
is valuable for applications requiring precise synchronization.</li>
<li><strong>Flexible Supply Voltage Range</strong>: The SFM10-DEV
operates within a supply voltage range of 1.8V to 3.6V. Whether powered
by USB, external supply, or battery, the board adapts to your
needs.</li>
</ul>
<h3 id="product-photos-1">Product Photos</h3>
<p><img src="figures/photos/SFM10-DEV_0594.jpg" /></p>
<p><img src="figures/photos/SFM10-DEV_0593.jpg" /></p>
<p><img src="figures/photos/SFM10-DEV_0597.jpg" /></p>
<p><img src="figures/photos/SFM10-DEV_0603.jpg" /></p>
<p><img src="figures/photos/SFM10-DEV_0632.jpg" /></p>
<p><img src="figures/photos/SFM10-DEV_0675.jpg" /></p>
<p><img src="figures/photos/SFM10-DEV_0926.jpg" /></p>
<p><img src="figures/photos/SFM10-DEV_0927.jpg" /></p>
<p><img src="figures/photos/IDE_code.jpg" /></p>
<p><img src="figures/photos/SFM10-DEV_0925.jpg" /></p>
<h3 id="order-information-1">Order Information</h3>
<p>Part Number: SFM10-DEV</p>
<p>Price: EUR 49,-</p>
<p>Where to order: info@synchronicit.nl</p>
<h3 id="product-content-1">Product Content</h3>
<ul>
<li>Single SFM10-DEV board containing a SFM10 Module</li>
<li>One pair of stackable 8-pin headers</li>
</ul>
<h3 id="layout-1">Layout</h3>
<p><img src="figures/SFM10-DEV%20components.png" /> <em>SFM10-DEV
components</em></p>
<p>The SFM10-DEV board contains on the bottom side a SFM10 Module
(housing the OL23D0 UWB chip).</p>
<p>On the front side we find the following components:</p>
<ul>
<li><p><strong>The current limiter bypass jumper</strong>. The SFM10
exposes two voltage rails: VBAT and VBUF. The pre-soldered jumper
connects these two rails. On the SFM10, buffer capacitors are connected
to VBUF for applications where the battery cannot deliver the high peak
current demand of the OL23D0. Removing the jumper disconnects VBUF,
leaving the 3V3 pin to be connected to VBAT only. An adjustable current
limiter between VBAT and VBUF limits the recharge current of the VBUF
capacitors. As a result, the battery current will never exceed the
maximum current setting of the limiter.</p></li>
<li><p><strong>The 5V to 3.3V LDO</strong>. When connected to a PC via
the USB micro connector, the voltage of VUSB will be 5V. However, the
OL23D0 will be damaged if 5.0V is applied to it. Therefore, the voltage
is dropped to 3.3V using an LDO, which can supply up to 500mA. The
voltage range of all I/O is 3.3V. In case you want to use peripheral
circuitry that has different I/O voltages, it is recommended to use a
level shifter. When the 3v3 pin is powered externally (for example with
a CR2032 battery), a diode will prevent current flowing backwards to the
LDO and USB chip.</p></li>
<li><p><strong>The MOSI/MISO swap jumpers</strong>. The OL23D0 has two
SPI data pins: SDI (Data input for SPI full duplex operation) and SDO
(Data I/O for SPI operation; output in full duplex operation;
input/output in half duplex operation). Thus, only one of these two pins
can be an output (SDO). Because with microcontrollers it is more common
to use the names MISO (master-in-slave-out) and MOSI
(master-out-slave-in), we used these names on the SFM10-DEV. However,
this labeling is correct when the SFM10 is configured as a SPI Master
only. When configured as a SPI Slave, the jumpers can be repositioned,
which electrically swaps the D6 and D7 pins, making the MISO/MOSI labels
consistent again.</p></li>
<li><p><strong>The Micro USB</strong> female connector allows connecting
the SFM10 to, for example, a PC for power and UART data communication,
using a common USB micro cable.</p></li>
<li><p><strong>The reset button</strong>. When the reset button is
pressed, the reset line is pulled to GND (i.e., active low), resetting
the OL23D0.</p></li>
<li><p><strong>The tick length indication</strong>. The measurement
clock runs at 128*499.2 MHz (which is about 64 GHz). This equals
1/63897.6 microseconds per tick. The radio propagation speed in air is
approximately 299704079 m/s (speed of light). Thus, if we want to
convert a tick to millimeters, we find: 1000*299704079 / (128*499.2e6)
~= 4.690381 mm. Thus, the resolution of the measurement clock is roughly
4.7 millimeters.</p></li>
<li><p><strong>The red LED</strong>. Pin D1 (alias GPIO8) is connected
to a red LED that can be programmed and used as a status LED (active
low). The presence of the LED does not prevent you from using this pin
for I2C.</p></li>
<li><p><strong>The green LED</strong>. Pin D2 (alias GPIO9) is connected
to a green LED that can be programmed and used as a status LED (active
low). The presence of the LED does not prevent you from using this pin
for I2C.</p></li>
<li><p><strong>The UART-to-USB chip</strong>. The UART-to-USB chip,
which is the CP2102 by Silicon Labs, will be detected and configured as
a COM port when connected to your PC via USB. Using this serial port
interface you can upload user applications to the SFM10 and interact
with it.</p></li>
<li><p><strong>The programming status LED</strong> will show the
programming status when compiling and uploading firmware.</p></li>
<li><p><strong>The D3 button</strong> will pull down pin D3 low (i.e.,
active low) when pressed. The internal pull-up resistor needs to be
activated on pin D3 to make use of this button.</p></li>
</ul>
<h3 id="pinout-1">Pinout</h3>
<p><img src="figures/SFM10-DEV%20pinout.png" /> <em>SFM10-DEV
pinout</em></p>
<ul>
<li><strong>Pin RST</strong>: Reset input (active low), with an internal
pull-up resistor. To perform a reset, RST shall be active for at least 5
us.<br />
</li>
<li><strong>Pin NC</strong>: Not Connected. In the Wemos D1 mini form
factor, this pin corresponds to the analog-to-digital convertor (ADC)
A0. However, the ADCs within the SFM10 are all connected
internally.<br />
</li>
<li><strong>Pin D0</strong>: General-purpose input/output bit number 5.
Interrupt output (active low) in SPI operation.<br />
</li>
<li><strong>Pin D5</strong>: General-purpose input/output bit number 1.
Data clock for SPI operation (SCK); output in SPI Master operation;
input in SPI Slave operation.<br />
</li>
<li><strong>Pin D6</strong>: General-purpose input/output bit number 3.
Data input for SPI full duplex operation (MISO in SPI Master
operation).<br />
</li>
<li><strong>Pin D7</strong>: General-purpose input/output bit number 2.
Data output for SPI full duplex operation (MOSI in SPI Master
operation).<br />
</li>
<li><strong>Pin D8</strong>: General-purpose input/output bit number 0.
Slave Select / Chip Select (active low) named CS1; output in SPI Master
operation; input in SPI Slave operation</li>
<li><strong>Pin 3V3</strong>: The general voltage requirement is 1.8V to
3.6V. If the system supply of the application is in that range, the
supply could be connected directly. When USB is connected, VUSB (5V)
will be dropped to ~3.3V using the on-board LDO. One can connect
external circuitry that uses this 3.3V as long as its current
consumption stays below 400mA.</li>
<li><strong>Pin TX</strong>: General-purpose input/output bit number 7.
Data output in LIN/UART operation.<br />
</li>
<li><strong>Pin RX</strong>: General-purpose input/output bit number 6.
Data input in LIN/UART operation.<br />
</li>
<li><strong>Pin D1</strong>: General-purpose input/output bit number 8.
Output gating signal for an optional external Power Amplifier (PA)<br />
</li>
<li><strong>Pin D2</strong>: General-purpose input/output bit number 9.
Alternative Slave Select / Chip Select (active low) named CS2; output in
SPI Master operation; input in SPI Slave operation<br />
</li>
<li><strong>Pin D3</strong>: General-purpose input/output bit number
4.</li>
<li><strong>Pin XO</strong>: XTAL Out. Outputs a Clock Reference
(typical 27.6MHz) for external IC. XTAL clock output buffer, optionally
divided. Trapezoid-wave with configurable slope to guaranty minimum
0.6Vpp at typical 27.6MHz</li>
<li><strong>Pin GND</strong>: Ground (digital)</li>
<li><strong>Pin VUSB</strong>: Connected to the USB 5V rail.</li>
</ul>
<h3 id="schematic">Schematic</h3>
<p><img src="figures/datasheet/schematic-sfm10-dev-v1-4.jpg" />
<em>sfm10-dev v1.4</em></p>
<h2 id="sfm10-kit">SFM10-KIT</h2>
<p>The SFM10-KIT is a comprehensive package that includes six SFM10-DEV
Boards, providing an ideal platform for various stages of UWB
(Ultra-Wideband) exploration.</p>
<p>Here’s what you need to know about this versatile kit:</p>
<p><strong>Development Board Multiplicity</strong>: The SFM10-KIT
comprises six Development Boards, each tailored for evaluating the SFM10
Module. Whether you’re a hobbyist, researcher, or professional, having
multiple boards facilitates parallel prototyping and
experimentation.</p>
<p><strong>SFM10 Tutorials</strong>: When you purchase the this
Evaluation Kit, you gain exclusive access to the comprehensive SFM10
tutorials. These tutorials serve as your guide, leading you step by step
through key concepts related to Ultra-Wideband (UWB) technology. Whether
you’re a curious learner or a seasoned developer, these resources
empower you to unlock the full potential of the SFM10 Module.</p>
<p><strong>Prototyping and Performance Evaluation</strong>: Use the
SFM10-KIT for rapid prototyping and hardware performance evaluation.
Dive into the intricacies of UWB technology, test your ideas, and
fine-tune your designs.</p>
<p><strong>The Module Unveiled</strong>: At the heart of the SFM10-KIT
lies the SFM10-MOD, a fully integrated and programmable UWB solution.
Based on the NXP Trimension (TM) OL23D0, this module combines ease of
use with powerful capabilities.</p>
<p><strong>Effortless UWB Solution Creation</strong>: With the
SFM10-KIT, you can build UWB applications with minimal effort. Explore a
wide range of use cases, from energy-efficient signal transmission to
precise distance measurements.</p>
<p>Potential Applications: The possibilities are vast: * Low-Energy
Signal Transmission: Efficiently transmit data with minimal power
consumption. * Clock Synchronization: Achieve precise synchronization
across external devices. * Synchronized Timestamping: Capture events
with sub-microsecond accuracy. * Two-Way Ranging (TWR): Measure
distances using time-of-flight principles. * Time Difference of Arrival
(TDoA): Locate objects based on signal arrival times. * Spatial
Awareness: Enable devices to understand their surroundings. * Real-Time
Localization Systems (RTLS): Track assets or people in real time. *
Highly Secure Data Transfer: Safeguard sensitive information.</p>
<p>In summary, the SFM10-KIT opens doors to UWB innovation, empowering
you to create cutting-edge applications with confidence. Let your
imagination roam, and let the SFM10-KIT be your guide!</p>
<h3 id="key-features-2">Key Features</h3>
<ul>
<li><p>Convenient kit for evaluation of the SFM10 Module</p></li>
<li><p>Programmable via USB (using UART)</p></li>
<li><p>Free application development software</p></li>
<li><p>Simple, clear programming environment (C)</p></li>
<li><p>Tutorials for the novice programmer</p></li>
<li><p>Ideal for IoT</p></li>
<li><p>The world’s only single-chip UWB solution</p></li>
<li><p>Integrated Arm Cortex M33 microcontroller</p></li>
<li><p>Optimized low-power modes for (coin cell) battery supply</p></li>
<li><p>High accuracy distance measurement</p></li>
<li><p>Compatible with DW1000 and DW3000</p></li>
<li><p>SPI, UART, and (software) I2C compatible</p></li>
</ul>
<h3 id="product-photos-2">Product Photos</h3>
<p><img src="figures/photos/SFM10-KIT_0649.jpg" /></p>
<p><img src="figures/photos/SFM10-KIT_0612.jpg" /></p>
<p><img src="figures/photos/SFM10-KIT_0615.jpg" /></p>
<p><img src="figures/photos/SFM10-KIT_0684.jpg" /></p>
<p><img src="figures/photos/IDE_code.jpg" /></p>
<p><img src="figures/photos/SFM10-KIT_butt.jpg" /></p>
<p><img src="figures/photos/SFM10-KIT_tdma.jpg" /></p>
<p><img src="figures/photos/SFM10-KIT_vsco.jpg" /></p>
<p><img src="figures/photos/SFM10-KIT_0945.jpg" /></p>
<h3 id="order-information-2">Order Information</h3>
<p>Part Number: SFM10-KIT</p>
<p>Price: EUR 499,-</p>
<p>Where to order: info@synchronicit.nl</p>
<h3 id="product-content-2">Product Content</h3>
<ul>
<li>Six SFM10-DEV boards</li>
<li>Six USB micro cables (1m)</li>
<li>Six pairs of stackable 8-pin headers</li>
<li>Tutorial activation code</li>
</ul>
<h3 id="tutorials">Tutorials</h3>
<p>Creating a Real-Time Localization System (RTLS) is a challenging
endeavor. It goes beyond simply purchasing a chipset from NXP. To build
an effective RTLS, you’ll need to consider several critical components
and concepts:</p>
<ul>
<li><strong>Radio Signal Propagation</strong>: Understanding how radio
waves propagate through space is essential. Factors like signal
strength, interference, and multipath effects play a crucial role.</li>
<li><strong>Location Engine Mathematics</strong>: The mathematics behind
determining precise positions based on received signals is intricate.
Concepts like trilateration and multilateration are fundamental.</li>
<li><strong>Power Management</strong>: Efficiently managing power
consumption is vital for battery-operated devices. Balancing accuracy
with energy efficiency is a delicate task.</li>
<li><strong>Clock Drift and Clock Wandering</strong>: Clock
synchronization is crucial for accurate timestamping. Dealing with clock
inaccuracies due to drift and wandering is part of the challenge.</li>
<li><strong>TDMA Algorithms</strong>: Time-Division Multiple Access
(TDMA) ensures efficient communication between devices. Coordinating
transmissions within specific time slots is essential.</li>
</ul>
<p>The typical Ultra-Wideband (UWB) solution involves multiple chipsets,
including an external host controller and the UWB transceiver. The
external microcontroller handles power management and orchestrates
communication with the UWB chip. This complexity can be daunting for
developers new to UWB technology or (embedded) programming.</p>
<p>At SynchronicIT, we aim to simplify this process. Our ambition is to
make exciting UWB technology accessible to everyone, even those with
minimal technical knowledge. Here’s how we help:</p>
<ul>
<li><strong>Software Page</strong>: Visit our software page, where
you’ll find all the necessary files to build a user application and
upload it to an SFM10 Development Board. Our build tools are entirely
free of charge.</li>
<li><strong>API</strong>: We’ve made the User Application API available
to anyone. It provides a straightforward interface for integrating UWB
functionality into your applications.</li>
<li><strong>Built-In Examples</strong>: Our downloads include built-in
examples to kickstart your UWB journey. While the free documentation
won’t hold your hand through every detail, our tutorials bridge the
gap.</li>
<li><strong>Tutorials Access</strong>: When you purchase an SFM10
Evaluation Kit, you’ll receive a tutorial activation code. Register,
explore the tutorials, and unlock the full potential of UWB
technology.</li>
</ul>
<h2 id="sfm10-dongle">SFM10-DONGLE</h2>
<p>The SFM10-DONGLE shares identical functionality with the SFM10-DEV
Board, differing only in its form factor-it takes the shape of a
convenient USB dongle. When you receive it, the SFM10-DONGLE will come
encased in a sleek black dongle housing, as depicted in the accompanying
image.</p>
<p>Refer to the SFM10 Development Board for more details.</p>
<h3 id="product-photos-3">Product Photos</h3>
<p><img src="figures/photos/SFM10-DONGLE_0871.jpg" /></p>
<p><img src="figures/photos/SFM10-DONGLE_0763.jpg" /></p>
<p><img src="figures/photos/SFM10-DONGLE_0881.jpg" /></p>
<p><img src="figures/photos/SFM10-DONGLE_0780.jpg" /></p>
<p><img src="figures/photos/SFM10-DONGLE_0787.jpg" /></p>
<p><img src="figures/photos/SFM10-DONGLE_0808.jpg" /></p>
<p><img src="figures/photos/SFM10-DONGLE_0876.jpg" /></p>
<p><img src="figures/photos/SFM10-DONGLE_0879.jpg" /></p>
<h3 id="order-information-3">Order Information</h3>
<p>Part Number: SFM10-DONGLE</p>
<p>Price: EUR 65-</p>
<p>Where to order: info@synchronicit.nl</p>
<h3 id="product-content-3">Product Content</h3>
<ul>
<li>SFM10-DONGLE USB module</li>
<li>Black enclosure for the dongle</li>
</ul>
<h2 id="sfm10-wearable">SFM10-WEARABLE</h2>
<p>The SFM10-WEARABLE is a versatile device equipped with essential
features for wearable applications. It incorporates an accelerometer, a
wireless charger, and a LiPo battery charger. Notably, it is also
waterproof, making it suitable for various outdoor and water-resistant
use cases. This compact module can be programmed using two convenient
methods: over-the-air or via a common FTDI TTL/USB adapter.</p>
<h3 id="product-photos-4">Product Photos</h3>
<p><img src="figures/photos/SFM10-WEARABLE_0888.jpg" /></p>
<p><img src="figures/photos/SFM10-WEARABLE_0736.jpg" /></p>
<p><img src="figures/photos/SFM10-WEARABLE_0752.jpg" /></p>
<p><img src="figures/photos/SFM10-WEARABLE_0799.jpg" /></p>
<p><img src="figures/photos/SFM10-WEARABLE_0806.jpg" /></p>
<p><img src="figures/photos/SFM10-WEARABLE_0895.jpg" /></p>
<p><img src="figures/photos/SFM10-WEARABLE_0899.jpg" /></p>
<h3 id="order-information-4">Order Information</h3>
<p>Part Number: SFM10-WEARABLE</p>
<p>Price: EUR 99,-</p>
<p>Where to order: info@synchronicit.nl</p>
<h3 id="product-content-4">Product Content</h3>
<ul>
<li>SFM10-WEARABLE board with white enclosure</li>
<li>Wrist band (black)</li>
<li>Belt clip (white)</li>
</ul>
<h2 id="sfm10-socket">SFM10-SOCKET</h2>
<p>The SFM10-SOCKET is a convenient adapter that enables seamless
connections between 2.54mm headers or Dupont cables and an SFM10-MOD,
all without the need for soldering.</p>
<p>Soldering connections are permanent. With this adapter, you can
easily disconnect and reconnect a SFM10-MOD as needed. This flexibility
is especially useful during prototyping, testing, verifying
functionality, or when making adjustments.</p>
<h3 id="product-photos-5">Product Photos</h3>
<p><img src="figures/photos/SFM10-SOCKET_0830.jpg" /></p>
<p><img src="figures/photos/SFM10-SOCKET_0825.jpg" /></p>
<p><img src="figures/photos/SFM10-SOCKET_0826.jpg" /></p>
<p><img src="figures/photos/SFM10-SOCKET_0829.jpg" /></p>
<h3 id="order-information-5">Order Information</h3>
<p>Part Number: SFM10-SOCKET</p>
<p>Price: EUR 49,-</p>
<p>Where to order: info@synchronicit.nl</p>
<h3 id="product-content-5">Product Content</h3>
<ul>
<li>SFM10-SOCKET</li>
</ul>
<h2 id="sfm10-demo">SFM10-DEMO</h2>
<p>The SFM10-DEMO showcases the impressive distance measurement
capability of the SFM10. In this setup, one SFM10 module drives a 32x8
LED matrix, dynamically displaying real-time distance measurements (in
centimeters) between the LED display and a LiPo-battery-powered SFM10
(tag).</p>
<h3 id="product-photos-6">Product Photos</h3>
<p><img src="figures/photos/SFM10-DEMO_0908.jpg" /></p>
<p><img src="figures/photos/SFM10-DEMO_0905.jpg" /></p>
<h3 id="order-information-6">Order Information</h3>
<p>Part Number: SFM10-DEMO</p>
<p>Price: EUR 249,-</p>
<p>Where to order: info@synchronicit.nl</p>
<h3 id="product-content-6">Product Content</h3>
<ul>
<li>Two SFM10-DEV modules</li>
<li>32x8 LED maxtrix shield for a SFM10-DEV</li>
<li>Battery shield for SFM10-DEV with a LiPo 390mAh</li>
</ul>
<h1 id="software-development">Software Development</h1>
<h2 id="getting-started">Getting Started</h2>
<h3 id="steps">Steps</h3>
<ul>
<li>The first step is to learn about and download the Software
Development Kit.</li>
<li>The second step is to follow the Software Development Setup guide to
install the recommended third-party software. This installation guide is
written for a Windows PC, but the listed software is not OS
specific.</li>
<li>The third step is to get familiar with the structure of a user
application as explained below.</li>
<li>The fourth step is to have a look at the Built-in Examples,
demonstrating basic functionality, and to have a look at the User
Application API.</li>
<li>The fifth step is to follow the Tutorials. Note that before you can
participate you need to register first.</li>
</ul>
<h2 id="what-did-synchronicit-add-to-the-ol23d0">What did SynchronicIT
add to the OL23D0?</h2>
<p>The software that runs on the SFM10 Module is what we call
firmware.</p>
<p>Firmware is a term for a piece of software that is stored on a
hardware device in order to make it run properly.</p>
<p>On top of what is provided by the chip manufacturer, SynchronicIT
added three firmware layers to make it usable: the Bootloader, the UWB
Library, and the User Application.</p>
<p><img src="figures/Firmware%20structure.png" /> <em>Firmware structure
and memory addresses</em></p>
<p>In addition to the UWB baseband functionality, the OL23D0 is shipped
with ROM functions for peripherals and memory management. This firmware
layer is hidden in our SDK for a few reasons. It requires extensive
documentation and quite some prior knowledge to use it. The chip is
designed with a high level of security in mind, therefore some
functionalities are hidden by the manufacturer. In addition, you will
need expensive tools to create custom firmware and upload it to the
device. Instead this development kit should provide easy-to-use software
tools, allowing anyone to build UWB solutions.</p>
<h2 id="what-does-the-bootloader-do">What does the Bootloader do?</h2>
<p>The SFM10 Module contains a bootloader consuming only 4kB of flash
memory that enables customers to upload (higher layer) firmware over
UART.</p>
<p>In general, a bootloader is a small program that runs on a
microcontroller and is responsible for loading and executing the main
application code. It is used to upgrade or modify the system software
without the need for specialized firmware upgrade tools.</p>
<p>The bootloader that we created for the SFM10 uses UART and the reset
line to upload new firmware. A common alternative to upload an
application binary is SWD, which stands for Serial Wire Debug and is a
two-wire protocol used for debugging and programming ARM
microcontrollers.</p>
<p>Compared to SWD, using UART to upload a binary has several benefits.
One of them is that application output and debug information is commonly
printed over UART. By also using UART to upload the application we get a
fluent user experience without the need to connect a lot of wires. In
addition, for SWD you need specialized (costly) programmers, while
USB-to-UART converters are commonly available and cheap.</p>
<p>Here we will explain our bootloader interface.</p>
<p><img src="figures/bootloader/sfm10-bootloader-0.png" /></p>
<p>The bootloader flow is as follows: after a boot it checks if the
conditions are met for “Upload Mode”. If not, it checks if an
application is present in flash to start up. If not, it will print a “SN
string”.</p>
<p><img src="figures/bootloader/sfm10-bootloader-1.png" /></p>
<p><img src="figures/bootloader/sfm10-bootloader-2.png" /></p>
<p><img src="figures/bootloader/sfm10-bootloader-3.png" /></p>
<h2 id="what-does-the-uwb-library-do">What does the UWB Library do?</h2>
<p>The main firmware block that we build for this SDK is what we call
the UWB Library, or primary application.</p>
<p>Creating a Real Time Localisation System (RTLS) is not a trivial
task. It requires knowledge of signal propagation, power management,
clock drift, internal delays, etc. This complexity is a big hurdle for
developers that are new to UWB and a giant leap for anyone new to
(embedded) programming. To make configuration and programming of this
complex device as easy as possible, the SFM10 Module comes with a UWB
Library that implements all important functions. It can be regarded as a
stable foundation for creating custom-tailored UWB solutions.</p>
<p>This program is loaded right after the bootloader. However, it won’t
do anything by itself. It exposes a list of functions that your own
application can use. The UWB Library can be updated via the bootloader,
which is advised when a new version is made available.</p>
<h2 id="what-is-the-user-application">What is the User Application?</h2>
<p>The third firmware layer is the User Application which makes use of
the functions that are exposed by the UWB Library. The User Application
can be freely programmed to fit to the needs or preferences of a
specific customer or application.</p>
<p>This piece of firmware you will build yourself. We choose to design
an Arduino-like programming language because the Arduino language is
well documented, has a large community, is easy-to-use for beginners,
yet flexible enough for advanced users. Like with an Arduino sketch, the
user of our module defines a <code>setup()</code> function that
initializes and sets the initial values, and a <code>loop()</code>
function that loops consecutively, allowing your program to change and
respond.</p>
<p>After the UWB Library is successfully uploaded, the User Application
can be updated and replaced as many times as you want. However, when a
new version of the UWB Library is uploaded, the binaries of the User
Application (hex files) need to be recompiled with the new header files
before they are uploaded again.</p>
<h2 id="what-does-the-user-application-look-like">What does the User
Application look like?</h2>
<p>To build the user application, we will use the language C. C is a
general-purpose programming language created by Dennis Ritchie at the
Bell Laboratories in 1972. Despite being old, it still is very powerful
and efficient. It is widely used especially with embedded systems,
because:</p>
<ul>
<li>It offers low-level access to the device hardware.</li>
<li>It forces you to think about proper usages of the very limited
resources available (e.g., CPU time and memory size).</li>
<li>Compared to alternatives it is a very fast language. Typically C was
used as a building block to create other languages (e.g., C++, Python,
Java).</li>
</ul>
<p>Because C operates close to the low-level hardware, it is considered
as a low-level language, which means it is quite technical and could be
challenging at first.</p>
<p>If you have no experience with C (or even any other language) don’t
worry - because it is an old language and it is so widely used, there
are plenty of tutorials out there. For example <a
href="https://www.w3schools.com/c/c_syntax.php">here</a>.</p>
<p>However, although the syntax is C, the code (or ‘sketch’) that you
will write for the user application will use a slightly different
skeleton compared to the typical <code>int main()</code> program, as
explained below in the section below.</p>
<h3 id="setup"><code>setup()</code></h3>
<p>Your sketch should always contain the function <code>setup()</code>,
which is to initialize variables, pin modes, libraries, etc. The
<code>setup()</code> function will run only once, after each powerup or
reset of the module.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span> <span class="co">// initialize UART</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Hello world</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="loop"><code>loop()</code></h3>
<p>Your sketch is expected to contain the function <code>loop()</code>,
which is called continuously. The loop frequency can be adjusted by
changing <code>CONFIG_LOOP_INTERVAL</code> to some value other than 0.
The value is in milliseconds. The default of 0 means <code>loop()</code>
will be called as often as possible.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span> <span class="co">// run once:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Hello world!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span> <span class="co">// runs indefinitely:</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Hi</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span> <span class="co">// wait one second</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="errno"><code>errno</code></h3>
<p>The global variable “errno” can be checked to test whether a problem
has occurred. In your sketch, you can set its value to 0 and check at
some point if errno does not equal 0 anymore. The value of errno is
never set to zero by any system call or library function. Alternatively
you detect an error as soon as it occurs using
<code>attachInterrupt(ERROR_INTERRUPT, fun, 0)</code>. The value of
errno will encode the Standalone function group (e.g., GPIO, SPI, UART),
the function within the group, and the reason of error.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// To print changes of the errno variable:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> handleError<span class="op">()</span> <span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;E0x</span><span class="sc">%06X\n</span><span class="st">&quot;</span><span class="op">,</span> errno<span class="op">);</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>ERROR_INTERRUPT<span class="op">,</span> handleError<span class="op">,</span> <span class="dv">0</span><span class="op">);</span> <span class="co">// set callback</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span><span class="dv">99</span><span class="op">,</span> INPUT<span class="op">);</span> <span class="co">// will trigger a call to error(), printing E10102</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                            <span class="co">// corresponding to E_GPIO_PIN_MODE__PIN_UNKNOWN</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>ERROR_INTERRUPT<span class="op">,</span> Serial<span class="op">.</span>printError<span class="op">,</span> <span class="dv">0</span><span class="op">);</span> <span class="co">// set predefined callback</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h2 id="what-are-uwb.-functions">What are UWB.* functions?</h2>
<p>At the User Application API page you will find all the functions that
the UWB library exposes for you to use. Note that the last few function
families have a name starting with <code>UWB</code>.</p>
<p>These are special in the sense that they are exposed to the external
host MCU when the SFM10 is used as a slave, using generated files
<code>phy-uci-interpreter.h</code> and
<code>phy-uci-interpreter.c</code>.</p>
<p>Note the term UCI. This abbreviation stands for Ultra-wideband
Command Interface and it enables communication with the Ultra-wideband
subsystem (UWBS). The UCI defines the transport layer, independent from
the physical connection. This means it can be used over UART or SPI when
the SFM10 is connected as a slave module to a host microprocessor. See
user application <code>uci-over-uart</code> in the SDK.</p>
<p>Three types of UCI messages are defined:</p>
<ul>
<li>a Command message (CMD), which provides instructions to the
UWBS,</li>
<li>a Response message (RSP) that is always a (direct) response
following a command,</li>
<li>and a notification message (NTF) that informs about some state which
can occur at any time.</li>
</ul>
<p>According to the standard, a UCI message should always start with a
four-bytes header that defines the type and length of the consecutive
payload. Within a User Application, all UCI functions are directly
accessible under the <code>UWB.</code> class without an intermediate
transport layer. Hence, a four-byte header is always omitted.</p>
<p>The return value of a UCI function indicates the success or error of
the command. This is different from the non-UCI functions, where errors
can be caught via variable <code>errno</code>. In case a function
returns output, for example <code>UWB.getDeviceInfo()</code>, it will
use a user-provided structure pointer. You can subscribe to notification
messages using the <code>UWB.on..()</code> functions in which you
provide a callback function and provide the data containers that should
be used.</p>
<p>To make the SFM10 a UCI slave device, please see the uci-over-uart
and uci-over-spi User Application examples. They basically add a UCI
header to outgoing messages and use some header interpretation logic for
incoming messages. Please see the documentation within the examples to
learn about the UCI packet format and the current Phy implementation and
serialization.</p>
<h1 id="software-development-setup">Software Development Setup</h1>
<p>Before we can use the SFM10-DEV, we need to install a few third-party
software components. Some may be installed already at your side. In that
case you can skip that of course.</p>
<ul>
<li><p>CMake is distributed under the <a
href="https://opensource.org/licenses/BSD-3-Clause">3-clause BSD
License</a>.</p></li>
<li><p>Python software and documentation are licensed under the <a
href="https://docs.python.org/3/license.html#psf-license-agreement-for-python-release">PSF
License Agreement</a>.</p></li>
<li><p>The Arm GNU Toolchain uses the <a
href="https://www.gnu.org/licenses/gpl-3.0.en.html">GNU General Public
License</a>.</p></li>
<li><p>Visual Studio Code is available under the <a
href="https://code.visualstudio.com/license">MIT license
agreement</a>.</p></li>
<li><p>Ninja is distributed under the <a
href="https://www.apache.org/licenses/LICENSE-2.0">Apache License
2.0</a>.</p></li>
</ul>
<p>This installation guide was written Juni 6th 2022 for a fresh Windows
10 Version 21H2 system.</p>
<p>Download the SFM10 SDK, extract it and place the folder somewhere
convenient, for example <code>C:/SFM10/</code>.</p>
<h2 id="cp210x-driver">CP210X Driver</h2>
<p>Connect a SFM10-DEV development board to your PC. Ensure that you
fully insert the micro-USB end of our supplied USB cables into the
socket. Windows should install drivers automatically.</p>
<p><img src="figures/installation/driver_1.png" /></p>
<p>To verify that the installation was successful, press the Windows
button and type “devi” and open Device Manager.</p>
<p><img src="figures/installation/driver_2.png" /></p>
<p>The CP2102N should be listed under Ports (COM &amp; LPT). If
automatic installation fails, the CP2102N is shown under “Other
devices”.</p>
<p><img src="figures/installation/driver_3.png" /></p>
<p>If this happens, go to <a
href="https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers">www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers</a>
and click on the downloads tab. Download the “CP210x Windows Drivers”
zip.</p>
<p><img src="figures/installation/driver_4.png" /></p>
<p>Extract the CP210x_Windows_Drivers.zip file.</p>
<p><img src="figures/installation/driver_5.png" /></p>
<p>And start the installation by opening CP210xVCPInstaller_x64.exe.</p>
<p><img src="figures/installation/driver_6.png" /></p>
<p><img src="figures/installation/driver_7.png" /></p>
<p>After the installation completes, the CP210x should now appear under
Ports (COM &amp; LPT).</p>
<p><img src="figures/installation/driver_8.png" /></p>
<p>Note that the COM port ID here is COM3. Let’s remember that for
later.</p>
<h2 id="cmake">CMake</h2>
<p>CMake is an open-source, cross-platform family of tools designed to
build, test and package software. It will interpret for example the
CMakeLists.txt files that you find throughout the SDK.</p>
<p>If you already have CMAKE installed, open a command prompt window and
type “cmake –version”. If this returns version 3.23.2 or higher, you can
skip installing CMAKE.</p>
<p>Go to <a href="https://cmake.org/download/">cmake.org/download</a>
and download “Windows x64 Installer”. An installer is convenient,
because it will give you the option to automatically add cmake to your
PATH environment variable.</p>
<p><img src="figures/installation/cmake_1.png" /></p>
<p>After the download, open in the installer (by opening
cmake-3.24.0-rc5-windows-x86_64.msi). You will see something like:</p>
<p><img src="figures/installation/cmake_2.png" /></p>
<p>Click Next, tick “I accept the terms” and click Next. Then, change
the selection to “Add CMake to the system PATH”:</p>
<p><img src="figures/installation/cmake_3.png" /></p>
<p>Click Next, and install it wherever you like (for example the default
<code>C:/Program Files/CMake/</code> location). Click Next and finally
click Install (it will require admin rights of course).</p>
<p><img src="figures/installation/cmake_4.png" /></p>
<h2 id="python">Python</h2>
<p>Python is a popular high-level, interpreted, general-purpose
programming language. We will use it mainly for USB-UART
communication.</p>
<p>Go to <a
href="https://www.python.org/downloads/">python.org/downloads</a> and
click on the button “Download Python”. You may want to check first if
you have Python installed already: Open a Command Prompt (press WINDOWS
button, type in “cmd” and press enter). Type in the following commands:
<code>python --version</code>. If this returns a Python version 3.0.0 or
higher, you’re good.</p>
<p><img src="figures/installation/python_1.png" /></p>
<p>Open the installation (for example python-3.10.5-amd64.exe).</p>
<p><img src="figures/installation/python_2.png" /></p>
<p>Make sure that you select the checkbox “Add Python to PATH”. Then,
click on Install Now. Again, it will ask for administrator rights.</p>
<p><img src="figures/installation/python_3.png" /></p>
<h2 id="compiler">Compiler</h2>
<p>In computing, a compiler is a computer program that translates
computer code written in one programming language (the source language)
into another language. Here the source language is C, and the output is
ARM assembly language.</p>
<p>Go to <a
href="https://developer.arm.com/Tools%20and%20Software/GNU%20Toolchain">developer.arm.com</a>
and click on “Download GNU Toolchain”.</p>
<p><img src="figures/installation/compiler_1.png" /></p>
<p>Scroll down a bit and download
gcc-arm-11.2-2022.02-mingw-w64-i686-arm-none-eabi.exe.</p>
<p><img src="figures/installation/compiler_2.png" /></p>
<p>After downloading, open the installation. It will ask for
administrator rights right away. Select the language.</p>
<p><img src="figures/installation/compiler_3.png" /></p>
<p>Click Next, then I Agree. Install it anywhere you like and press
Install.</p>
<p><img src="figures/installation/compiler_4.png" /></p>
<p>After installation, make sure you check the “Add path to environment
variable” before you click Finish.</p>
<h2 id="visual-studio-code">Visual Studio Code</h2>
<p>An integrated development environment (IDE) is a software application
for building applications. Within the IDE we will build the User
Application that will run on the SFM10 Module. We will use Visual Studio
Code here. Visual Studio Code, also commonly referred to as VS Code, is
a source-code editor made by Microsoft for Windows, Linux and macOS.</p>
<p>It is currently ranked the most popular developer environment tool as
indicated by a Survey from Stack Overflow.</p>
<p>Go to <a
href="https://code.visualstudio.com/download">code.visualstudio.com/download</a>.</p>
<p><img src="figures/installation/vscode_1.png" /></p>
<p>Download the “User Installer 64 bit”. Op the installation file (for
example VSCodeUserSetup-x64-1.67.2.exe).</p>
<p><img src="figures/installation/vscode_2.png" /></p>
<p>Accept and click Next. Install it anywhere you like (I used the
default) and press Next. Click Next again, and then, make sure you
select both checkboxes “Add Open with Code action” and the checkbox “Add
to PATH”.</p>
<p><img src="figures/installation/vscode_3.png" /></p>
<p>Press Next and then Install.</p>
<p><img src="figures/installation/vscode_4.png" /></p>
<h2 id="ninja">Ninja</h2>
<p>Ninja is designed to have its input files generated by a higher-level
build system such as CMake, and it is designed to run builds as fast as
possible. Simply put, it will make the connection between CMake and the
GCC compiler.</p>
<p>Ninja does not come with an installer, so we need to add it to the
environment variables manually. We placed ninja.exe in the source-files
folder of the SDK already, so we now only need to add the source-files
folder to the PATH variable. Press the Windows button, type in “envi” or
“variables” and select “Edit the system environment variables”.
Alternatively, on the Windows taskbar, right-click the Windows icon and
select System. In the Settings window click Advanced system
settings.</p>
<p><img src="figures/installation/envi_1.png" /></p>
<p>Click on “Environment Variables”.</p>
<p><img src="figures/installation/envi_2.png" /></p>
<p>Under system variables, click on “Path” and add a new row (click on
New) with the path to the SDK source-files.</p>
<p><img src="figures/installation/envi_3.png" /></p>
<p><img src="figures/installation/envi_4.png" /></p>
<p>Press OK, and OK.</p>
<h2 id="checkup">Checkup</h2>
<p>Before we proceed, we need to sign out of Windows and sign in again
to make the changes to the PATH environment variable effective (or
reboot your system). After the reboot we will check if all installations
were successful. Open a Command Prompt (press WINDOWS button, type in
“cmd” and press enter). Type in the following commands:</p>
<p><code>arm-none-eabi-gcc --version</code></p>
<p><code>python --version</code></p>
<p><code>cmake --version</code></p>
<p><code>ninja --version</code></p>
<p><img src="figures/installation/after_reboot.png" /></p>
<p>In case you got a “not recognized as an internal or external
command”, adding to PATH was not successful. In that case, either
install that piece of software again, or add it to PATH manually like we
did for Ninja.</p>
<h2 id="visual-code-and-python-extensions">Visual Code and Python
Extensions</h2>
<p>Go to the location of the SDK on your disk.</p>
<p><img src="figures/installation/sdk_2.png" /></p>
<p>When inside the folder, press the right mouse button, and click on
“Open with Code”</p>
<p><img src="figures/installation/sdk_3.png" /></p>
<p>Click on “Yes, I trust the authors” to continue. Now, we need to
install a few extensions.</p>
<p>Click on the “blocks” icon on the left and the first extension we are
going to install appears already at the top: Python. Click on the blue
install button. At some point the Windows Firewall asks if Visual Studio
Code is allowed to access the internet and you click on Allow
access.</p>
<p><img src="figures/installation/sdk_4.png" /></p>
<p>Next, in the search-bar in the top left corner, type in “c ext” and
install the C/C++ Extension Pack.</p>
<p><img src="figures/installation/sdk_5.png" /></p>
<p>After all components of the expansion pack are installed, we are
going to add extensions to Python. Press Ctrl and ` together and a
console will appear, or use the top navigation bar and select
View-&gt;Terminal. Type in:</p>
<p><code>pip install six</code></p>
<p><code>pip install intelhex</code></p>
<p><code>pip install pyserial</code></p>
<p>Be sure to install <code>pyserial</code> not <code>serial</code>.</p>
<p>You can ignore the pip version warnings. In case you run into an
error, for example <code>OSError: [Errno 13] Permission denied</code>,
you need to open Visual Code or the regular windows terminal using
administrator rights.</p>
<p><img src="figures/installation/sdk_6.png" /></p>
<p>Now, close Visual Studio Code.</p>
<h2 id="upload-a-sketch">Upload a Sketch</h2>
<p>Using Explorer go to the “user-application-examples” folder of the
SDK. Right click on the “example-hello-world” folder and select Open
with Code.</p>
<p><img src="figures/installation/sdk_7.png" /></p>
<p>In Visual Studio Code, on the bottom right, pop ups may appear asking
to configure things. We can ignore them.</p>
<p><img src="figures/installation/sdk_8.png" /></p>
<p>Within Visual Studio Code, browse to the file settings.json, located
in the .vscode folder. On line 3 it says “serialPort”: ““. When leaving
the serialPort variable empty like this, the current user application
will be uploaded to all connected (and available) SFM10 devices. You can
change it to for example”serialPort”: “COM6” to target only the device
connected as COM6, or change it to a comma-separated list to target
multiple, for example: “serialPort”: “COM3,COM5,COM6”.</p>
<p>Now, open file <code>main.c</code> (double click will prevent the
file from closing).</p>
<p><img src="figures/installation/sdk_9.png" /></p>
<p>Press Ctrl+Shift+B and it will start the Build sequence, listed in
tasks.json. It will first create a build folder, then it will run CMake
for setting up a building environment, then Ninja to use the GCC
compiler and linker, and finally it calls a python script within the SDK
to upload the binary.</p>
<p>On the right we see the API version code, the project name
(example-hello-world), the application type and the application size.
The line below the size lists the target devices (only COM14 here).</p>
<p><img src="figures/installation/sdk_10.png" /></p>
<p>If a <code>No CMAKE_ASM_COMPILER could be found</code> error is shown
the environment variable was not set correctly by the ARM GNU Toolchain
installer. Open the “Path” variable as was done for setting up Ninja and
add the folder where <code>arm-none-eabi-gcc.exe</code> is located, for
example: C:/Program Files (x86)/Arm GNU Toolchain arm-none-eabi/11.2
2022.02/bin as shown in this figure:</p>
<p><img src="figures/installation/cmake_compiler_error_fix.png" /></p>
<p><img src="figures/installation/sdk_11.png" /></p>
<p>In the figure above, all steps were successfully taken, except for
the last one. This happened after I set “serialPort” to “COM6”. It notes
that COM14 is available but not targetet (in grey) which may hint that
the variable “serialPort” was set wrong.</p>
<p>Note items could be listed after “ignoring” for several reasons.</p>
<p>With Ctrl+Shift+B we perform the build and upload procedure. We can
also press the F5 key. This will do the latter plus it opens a terminal
window in which UART output of the SFM10-DEV is shown, and serial
communication to the SFM10-DEV can be entered.</p>
<p><img src="figures/installation/sdk_12.png" /></p>
<p>The connection can be closed (must be closed before another binary
can be uploaded) by pressing Ctrl+C after selecting the terminal, or by
pressing Shift+F5.</p>
<p>We can edit main.c, for example change the word “Hello world” into
“monkey” with an incrementing count value. When we leave “serialPort”
empty and connect multiple SFM10-DEV boards using USB, and press F5,
they will all receive new firmware and the serial monitor will connect
to them all, dissociating them with colors.</p>
<p><img src="figures/installation/sdk_14.png" /></p>
<p>Note that each time a new SDK is downloaded and used, each connected
module will receive the dedicated UWB library before a user application
is uploaded. This will happen automatically. For more information, see
“What did SynchronicIT add to the OL23D0” and other topics on the
Getting Started / Software Developement section.</p>
<p><img src="figures/installation/sdk_15.png" /></p>
<p>That’s it. Good luck with your project!</p>
<h1 id="built-in-examples">Built-in Examples</h1>
<h3 id="example-hello-world">example-hello-world</h3>
<p>Hello World is one of the classic examples demonstrating minimal
application structure and UART output.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We always start with including the user-application header file:</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Our setup, that runs only once:</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">// We configure the TX / RX pins as UART and initialize it with a </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">// baud rate of 115200 bits per second:</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Our loop, that runs continuously:</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">// We print Hello World. Don&#39;t forget to add \n at the end, which </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">// triggers a UART flush: all the bytes in the UART buffer are </span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>      <span class="co">// sent on the wire.</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Hello world!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="example-blinky-led">example-blinky-led</h3>
<p>Blinky LED is one of the classic examples demonstrating GPIO output
and the delay (wait) function.</p>
<p>It will use the onboard red and green LED of the SFM10 Development
Board.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We always start with including the user-application header file:</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Let&#39;s define some MACRO functions that turn on/off a LED</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The LEDs on the SFM10-DEV board are active low, meaning that we </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// have to set the GPIO pin to LOW when the LED must be lit and </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// HIGH when it must be off.</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define ON </span>LOW</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define OFF </span>HIGH</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define TURN_RED_LED</span><span class="op">(</span>value<span class="op">)</span><span class="pp">   </span><span class="op">{</span><span class="pp"> </span>digitalWrite<span class="op">(</span>PIN_LED_R<span class="op">,</span><span class="pp"> </span>value<span class="op">);</span><span class="pp"> </span><span class="op">}</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define TURN_GREEN_LED</span><span class="op">(</span>value<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span>digitalWrite<span class="op">(</span>PIN_LED_G<span class="op">,</span><span class="pp"> </span>value<span class="op">);</span><span class="pp"> </span><span class="op">}</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Now we can write this for example: </span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   TURN_RED_LED(ON);</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Which now is an alternative notication for:</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   digitalWrite(PIN_LED_R, LOW);</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Our setup, that runs only once:</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">// We configure the GPIO pins that control both LEDs.</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>      <span class="co">// We can &#39;or&#39; the pins together to make it a single call to </span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>      <span class="co">// pinMode(). We set them both as OUTPUT pins with the initial </span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>      <span class="co">// state HIGH, meaning the LEDs are off:</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>      pinMode<span class="op">(</span>PIN_LED_R <span class="op">|</span> PIN_LED_G<span class="op">,</span> OUTPUT_HIGH<span class="op">);</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Our loop, that runs continuously:</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">// We turn on the red LED for 500 ms:</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>      TURN_RED_LED<span class="op">(</span>ON<span class="op">);</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">500</span><span class="op">);</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>      TURN_RED_LED<span class="op">(</span>OFF<span class="op">);</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>      <span class="co">// We wait 200 ms:</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">200</span><span class="op">);</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Then we turn on the green LED for 100 ms:</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>      TURN_GREEN_LED<span class="op">(</span>ON<span class="op">);</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>      TURN_GREEN_LED<span class="op">(</span>OFF<span class="op">);</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>      <span class="co">// We wait 1 second:</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">200</span><span class="op">);</span>  </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p>In the figure below both GPIO pins are recorded for 10 seconds. From
T=0 s onwards, you see D1 (orange line) toggling with an interval of
about half a second. The line D2 (red) briefly goes down (1/10th of a
second), making the green LED blink.</p>
<p><img src="figures/examples/example-blinky-led/saleae.png" /></p>
<p>Note that although 500+200+100+200=1000ms the pattern shows an
interval of slightly more than 1 second. This is because the scheduler
in the background, and the functions <code>digitalWrite()</code> and
<code>loop()</code> itself consume some processing time. One way to
achieve more precise scheduling is using the Timer class, see the
timed-leds example.</p>
<h3 id="example-user-button">example-user-button</h3>
<p>The User Button example demonstrates detection of a GPIO pin state
change.</p>
<p>It will use the onboard button and red LED of the SFM10 Development
Board.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We always start with including the user-application header file:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The LEDs on the SFM10-DEV board are active low, meaning that we </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// have to set the GPIO pin to LOW when the LED must be lit and </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// HIGH when it must be off.</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define ON </span>LOW</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define OFF </span>HIGH</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define TURN_RED_LED</span><span class="op">(</span>value<span class="op">)</span><span class="pp">   </span><span class="op">{</span><span class="pp"> </span>digitalWrite<span class="op">(</span>PIN_LED_R<span class="op">,</span><span class="pp"> </span>value<span class="op">);</span><span class="pp"> </span><span class="op">}</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Forward declaration of function, so we can &#39;use&#39; them before they </span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// are defined:</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> btn_down_isr<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> btn_up_isr<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We initialize the LED pins and the UART:</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>PIN_LED_R <span class="op">|</span> PIN_LED_G<span class="op">,</span> OUTPUT_HIGH<span class="op">);</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// In case an error occurs, errno will change its value. </span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Using the line below we can catch this event:</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>ERROR_INTERRUPT<span class="op">,</span> Serial<span class="op">.</span>printError<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> INPUT_PULLUP<span class="op">);</span> <span class="co">// setup button pin</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> btn_down_isr<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> btn_down_isr<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        detachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">);</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> btn_up_isr<span class="op">,</span> RISING<span class="op">);</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        TURN_RED_LED<span class="op">(</span>ON<span class="op">);</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> btn_up_isr<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>        detachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">);</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> btn_down_isr<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>        TURN_RED_LED<span class="op">(</span>OFF<span class="op">);</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="example-uart-echo">example-uart-echo</h3>
<p>The UART Echo example demonstrates how incoming data can be captured
and sent via a serial terminal.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We always start with including the user-application header file:</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Our setup, that runs only once:</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">// We configure the TX / RX pins as UART and initialize it with a </span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">// baud rate of 115200 bits per second:</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// In case some error occurs, we can detect them by setting:</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      attachInterrupt<span class="op">(</span>ERROR_INTERRUPT<span class="op">,</span> Serial<span class="op">.</span>printError<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Send me some characters and I&#39;ll echo them back</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Our loop, that runs continuously:</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> count <span class="op">=</span> Serial<span class="op">.</span>available<span class="op">();</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>count <span class="op">&gt;</span><span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> buffer<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>readBytes<span class="op">(</span>buffer<span class="op">,</span> count<span class="op">);</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;RECEIVED: &quot;</span><span class="op">);</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>write<span class="op">(</span>buffer<span class="op">,</span> count<span class="op">);</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p>Below, the example is opened in VS Code and after pressing the F5
button the serial monitor is opened. We’ve sent two strings, but note
that they are partially received.</p>
<p>This is because the check <code>Serial.available()</code> returned
before the whole string was transferred, resulting in multiple lines of
<code>RECEIVED</code>. One solution to this is to wait a little before
calling <code>Serial.available()</code> for example by inserting
<code>delay(1);</code> before it. Or, you fill the buffer, for example
using <code>Serial.read()</code> until you encounter the newline
character.</p>
<p><img src="figures/examples/example-uart-echo/code.png" /></p>
<h3 id="example-boot-reasons">example-boot-reasons</h3>
<p>Demonstrates several boot reasons.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>ERROR_INTERRUPT<span class="op">,</span> Serial<span class="op">.</span>printError<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Reset reason = &quot;</span><span class="op">);</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>getResetReason<span class="op">())</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> POWER_ON<span class="op">:</span>              Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;POWER_ON&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> RESET_PIN<span class="op">:</span>             Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;RESET_PIN&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> DPD_RESET_PIN<span class="op">:</span>         Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;DPD_RESET_PIN&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> HPD_RESET_PIN<span class="op">:</span>         Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;HPD_RESET_PIN&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> HPD_WAKE_UP_PIN<span class="op">:</span>       Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;HPD_WAKE_UP_PIN&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> SOFTWARE_RESET<span class="op">:</span>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;SOFTWARE_RESET&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> FAIL_BIAS_BANDGAP_VDD<span class="op">:</span> Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;FAIL_BIAS_BANDGAP_VDD&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> FAIL_CPU_VDD<span class="op">:</span>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;FAIL_CPU_VDD&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> BROWNOUT_CPU<span class="op">:</span>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;BROWNOUT_CPU&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> FAIL_PFLASH_VDD<span class="op">:</span>       Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;FAIL_PFLASH_VDD&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> FAIL_BUF_LOW_VDD<span class="op">:</span>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;FAIL_BUF_LOW_VDD&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> WATCHDOG<span class="op">:</span>              Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;WATCHDOG&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> FAIL_STATE_CHANGE<span class="op">:</span>     Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;FAIL_STATE_CHANGE&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> WUP_TIMER<span class="op">:</span>             Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;WUP_TIMER&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> WUP_SNAPSHOT<span class="op">:</span>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;WUP_SNAPSHOT&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> DPD_GPIO<span class="op">:</span>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;DPD_GPIO&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">default</span><span class="op">:</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>getResetReason<span class="op">())</span> <span class="op">{</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> RESET_PIN<span class="op">:</span> <span class="op">{</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>                delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span> </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>                reset<span class="op">();</span> <span class="co">// trigger SOFTWARE_RESET</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">break</span><span class="op">;</span> </span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> SOFTWARE_RESET<span class="op">:</span> <span class="op">{</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>                Timer<span class="op">.</span>setWatchdog<span class="op">(</span><span class="dv">1000</span><span class="op">);</span> <span class="co">// trigger WATCHDOG</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">break</span><span class="op">;</span> </span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> WATCHDOG<span class="op">:</span> <span class="op">{</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>                delay<span class="op">(</span><span class="dv">10</span><span class="op">);</span> <span class="co">// allow Serial.print() to complete</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>                sleep<span class="op">(</span><span class="dv">1000</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span> <span class="co">// trigger WUP_TIMER</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">break</span><span class="op">;</span> </span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> WUP_TIMER<span class="op">:</span> <span class="op">{</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Press the User Button to continue...</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>                delay<span class="op">(</span><span class="dv">10</span><span class="op">);</span> </span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>                sleep<span class="op">(</span><span class="dv">0</span><span class="op">,</span> D3<span class="op">,</span> FALLING<span class="op">);</span> <span class="co">// trigger DPD_GPIO</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">break</span><span class="op">;</span> </span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> DPD_GPIO<span class="op">:</span> <span class="op">{</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Send me some serial character(s)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>                delay<span class="op">(</span><span class="dv">10</span><span class="op">);</span> </span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>                deepSleep<span class="op">(</span>PIN_RX<span class="op">);</span> <span class="co">// trigger HPD_WAKE_UP_PIN</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> HPD_WAKE_UP_PIN<span class="op">:</span> <span class="op">{</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Done</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;You reached this line</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* example output:</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a><span class="co">    Reset reason = RESET_PIN</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a><span class="co">    Reset reason = SOFTWARE_RESET</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a><span class="co">    You reached this line</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a><span class="co">    Reset reason = WATCHDOG</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a><span class="co">    Reset reason = WUP_TIMER</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a><span class="co">    Press the User Button to continue...</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a><span class="co">    Reset reason = DPD_GPIO</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a><span class="co">    Send me some serial character(s)</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a><span class="co">    TO COM6: test</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a><span class="co">    Reset reason = HPD_WAKE_UP_PIN</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a><span class="co">    Done</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a><span class="co">    You reached this line</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="example-timed-leds">example-timed-leds</h3>
<p>The Timed LEDS example demonstrates how the LED blinking pattern from
the blinky-led example can be replicated with tight timing.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We always start with including the user-application header file:</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We initialize the LED pins and the UART:</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>PIN_LED_R <span class="op">|</span> PIN_LED_G<span class="op">,</span> OUTPUT_HIGH<span class="op">);</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// In case an error occurs, errno will change its value. </span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Using the line below we can catch this event:</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>ERROR_INTERRUPT<span class="op">,</span> Serial<span class="op">.</span>printError<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We start the hardware timer class:</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We start the UWB circuitry which activates the XTAL, providing a </span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// precise clock. This can be omited to reduce power consumption:</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Instead of defining MACROs like we did with blinky-led, we </span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create explicit functions for the LED states:</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> redOn<span class="op">()</span> <span class="op">{</span>  </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>        digitalWrite<span class="op">(</span>PIN_LED_R<span class="op">,</span> LOW<span class="op">);</span> </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> redOff<span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        digitalWrite<span class="op">(</span>PIN_LED_R<span class="op">,</span> HIGH<span class="op">);</span> </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> greenOn<span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        digitalWrite<span class="op">(</span>PIN_LED_G<span class="op">,</span> LOW<span class="op">);</span> </span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> greenOff<span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>        digitalWrite<span class="op">(</span>PIN_LED_G<span class="op">,</span> HIGH<span class="op">);</span> </span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The function defined below will be our last state of the </span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// pattern, it will let our scheduler know that we are done </span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// (see waitForEvent):</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> proceed<span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>        triggerEvent<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Our loop, that runs continuously:</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="dt">uint32_t</span> iteration <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We keep count of how many times we come here:</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>        iteration<span class="op">++;</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Based on the iteration count, we set the (absolute) </span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">// start time in milliseconds:</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> startTime <span class="op">=</span> <span class="dv">1000</span> <span class="op">*</span> iteration<span class="op">;</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Using the Timer class, we schedule the LED blinking</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">// pattern: </span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>at<span class="op">(</span>startTime <span class="op">+</span>   <span class="dv">0</span><span class="op">,</span> redOn<span class="op">);</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>at<span class="op">(</span>startTime <span class="op">+</span> <span class="dv">500</span><span class="op">,</span> redOff<span class="op">);</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>at<span class="op">(</span>startTime <span class="op">+</span> <span class="dv">700</span><span class="op">,</span> greenOn<span class="op">);</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>at<span class="op">(</span>startTime <span class="op">+</span> <span class="dv">800</span><span class="op">,</span> greenOff<span class="op">);</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>at<span class="op">(</span>startTime <span class="op">+</span> <span class="dv">900</span><span class="op">,</span> proceed<span class="op">);</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>        waitForEvent<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We end up here only after triggerEvent() is called </span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>        <span class="co">// somewhere, making sure the next blinking pattern is </span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>        <span class="co">// scheduled only when the previous is finished.</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p>As shown below, the interval between the patterns equals exactly 1000
ms. Compare this to the blinky-led example. Note that order of the
<code>Timer.at()</code> calls can be scrambled. The Timer class will
ensure chronological execution.</p>
<p><img src="figures/examples/example-timed-leds/saleae.png" /></p>
<h3 id="example-ss-twr">example-ss-twr</h3>
<p>This example is for two devices and demonstrates Single-Sided
Two-Way-Ranging (SS-TWR).</p>
<p>Both start as a responder node. After pressing the user button on one
of them, it will become an initiator and performs ten (uncorrected)
distance measurements with the other.</p>
<p><img src="figures/examples/example-ss-twr/photo.jpg" /></p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">    9437: 356 mm</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">    9448: 272 mm</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">    9459: 323 mm</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">    9470: 342 mm</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">    9481: 234 mm</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">    9492: 276 mm</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">    9503: 337 mm</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">    9514: 370 mm</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">    9525: 211 mm</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">    9536: 361 mm</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Variable to indicate the current role:</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> isInitiator <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// 0 = responder</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Forward declarations (so we can &#39;use&#39; these </span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// before they are defined):</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> initiator_task<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> responder_task<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> btn_down_isr<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We setup UART, UWB, and USER_BUTTON</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> INPUT_PULLUP<span class="op">);</span> <span class="co">// setup button pin</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> btn_down_isr<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>ERROR_INTERRUPT<span class="op">,</span> Serial<span class="op">.</span>printError<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// In loop, we perform the initiator or responder task:</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>isInitiator<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>        initiator_task<span class="op">();</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        isInitiator<span class="op">--;</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>        responder_task<span class="op">();</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Button press handler:</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> btn_down_isr<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>      <span class="co">// After a button press, we&#39;ll perform 10 distance measurements:</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>      isInitiator <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>      <span class="co">// trigger an event to make the responder_task stop</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Any event number will do except for RX_DONE and TX_DONE</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>      triggerEvent<span class="op">(</span>GPIO_INTERRUPT<span class="op">);</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> initiator_task<span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We transmit an empty packet as soon as possible (UWB.startTx(ASAP))</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>        TxTimestampNtf txResult<span class="op">;</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onTxUpdate<span class="op">(</span>TX_DONE<span class="op">,</span> <span class="op">&amp;</span>txResult<span class="op">);</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>        ASSERT_GOTO<span class="op">(</span>UWB<span class="op">.</span>startTx<span class="op">(</span>ASAP<span class="op">),</span> SUCCESS<span class="op">,</span> end<span class="op">);</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>        ASSERT_GOTO<span class="op">(</span>waitForEvent<span class="op">(</span><span class="dv">1</span><span class="op">),</span> TX_DONE<span class="op">,</span> end<span class="op">);</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We listen for the response:</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>        RxTimestampNtf rxResult<span class="op">;</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>        PayloadNtf rxPayload<span class="op">;</span> </span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onRxUpdate<span class="op">(</span>RX_DONE<span class="op">,</span> <span class="op">&amp;</span>rxResult<span class="op">,</span> <span class="op">&amp;</span>rxPayload<span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>        ASSERT_GOTO<span class="op">(</span>UWB<span class="op">.</span>startRx<span class="op">(</span>ASAP<span class="op">),</span> SUCCESS<span class="op">,</span> end<span class="op">);</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>        ASSERT_GOTO<span class="op">(</span>waitForEvent<span class="op">(</span><span class="dv">2</span><span class="op">),</span> RX_DONE<span class="op">,</span> end<span class="op">);</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We print the result:</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#define replyTime_ </span><span class="op">(*(</span><span class="dt">uint32_t</span><span class="op">*)</span>rxPayload<span class="op">.</span>payloadData<span class="op">)</span><span class="pp">   </span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#define roundTripTime </span><span class="op">(</span>rxResult<span class="op">.</span>rxTimestamp<span class="pp"> </span><span class="op">-</span><span class="pp"> </span>txResult<span class="op">.</span>txTimestamp<span class="op">)</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#define antennaDelay </span><span class="op">(</span><span class="dv">13914</span><span class="op">)</span></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int64_t</span> ToF <span class="op">=</span> <span class="op">(</span>roundTripTime <span class="op">-</span> <span class="va">replyTime_</span><span class="op">)</span> <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> antennaDelay<span class="op">;</span> </span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> distance <span class="op">=</span> TICKS_TO_MILLIMETERS<span class="op">(</span>ToF<span class="op">);</span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">%5u</span><span class="st">: </span><span class="sc">%i</span><span class="st"> mm</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> millis<span class="op">(),</span> distance<span class="op">);</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>        end<span class="op">:</span> </span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>stopAction<span class="op">();</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> responder_task<span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We listen for a packet and store the time of reception:</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>        RxTimestampNtf received<span class="op">;</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onRxUpdate<span class="op">(</span>RX_DONE<span class="op">,</span> <span class="op">&amp;</span>received<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>        ASSERT_GOTO<span class="op">(</span>UWB<span class="op">.</span>startRx<span class="op">(</span>ASAP<span class="op">),</span> SUCCESS<span class="op">,</span> end<span class="op">);</span></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>        ASSERT_GOTO<span class="op">(</span>waitForEvent<span class="op">(</span><span class="dv">1000</span><span class="op">),</span> RX_DONE<span class="op">,</span> end<span class="op">);</span></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>        ASSERT_0<span class="op">(</span>received<span class="op">.</span>uciStatus<span class="op">);</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>        <span class="co">// After reception, we schedule the response:</span></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>        SetPayloadCmd reply <span class="op">=</span> <span class="op">{</span> <span class="op">.</span>payloadLength <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span> <span class="op">};</span></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#define replyTime </span><span class="op">(*(</span><span class="dt">uint32_t</span><span class="op">*)</span>reply<span class="op">.</span>payloadData<span class="op">)</span></span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>        StartTxCmd send <span class="op">=</span> <span class="op">{</span> <span class="op">.</span>time <span class="op">=</span> <span class="op">*</span>ticks<span class="op">()</span> <span class="op">+</span> MICROS_TO_TICKS<span class="op">(</span><span class="dv">150</span><span class="op">)</span> <span class="op">};</span></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>        replyTime <span class="op">=</span> send<span class="op">.</span>time <span class="op">-</span> received<span class="op">.</span>rxTimestamp<span class="op">;</span>  </span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We set the reply time as payload, and transmit:</span></span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>setPayload<span class="op">(&amp;</span>reply<span class="op">);</span> </span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>stopAction<span class="op">();</span> <span class="co">// just to make sure</span></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onTxUpdate<span class="op">(</span>TX_DONE<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>        ASSERT_GOTO<span class="op">(</span>UWB<span class="op">.</span>startTx<span class="op">(&amp;</span>send<span class="op">),</span> SUCCESS<span class="op">,</span> end<span class="op">);</span></span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>        ASSERT_GOTO<span class="op">(</span>waitForEvent<span class="op">(</span><span class="dv">2</span><span class="op">),</span> TX_DONE<span class="op">,</span> end<span class="op">);</span>  </span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>        end<span class="op">:</span></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>stopAction<span class="op">();</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="example-uwb-settings">example-uwb-settings</h3>
<p>Demonstrates how to change UWB radio configuration, STS encryption
key, preample (sync) code, and center frequency.</p>
<p>This example is for two or more devices.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Forward declaration of our periodic TX function</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> send_poll<span class="op">();</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// In setup, we configure and start the UWB</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Start UART and UWB class</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// We start off with the default settings</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">// before we change some parameters:</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      SetConfigurationCmd config<span class="op">;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      SetConfiguration_setDefaults<span class="op">(&amp;</span>config<span class="op">);</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Let&#39;s user radio cfg 1: STS + payload:</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>      config<span class="op">.</span>rxRadioCfg <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>      config<span class="op">.</span>txRadioCfg <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>      <span class="co">// We will use an AES key for the STS encryption</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">// The key we&#39;ll store at index 1</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>      config<span class="op">.</span>stsKeyIdx <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>      <span class="co">// And let&#39;s use CHAN 9, which is centered around ~8 GHz</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>      config<span class="op">.</span>channelFrequency <span class="op">=</span> UWB_CHANNEL_9<span class="op">;</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Apply the configuration:</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>      ASSERT<span class="op">(</span>UWB<span class="op">.</span>setConfiguration<span class="op">(&amp;</span>config<span class="op">),</span> SUCCESS<span class="op">);</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Import AES key for index 1:</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>      ImportKeyCmd p <span class="op">=</span> <span class="op">{</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span>keyIdx <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span>keyUsage <span class="op">=</span> UWB_DEVICE_IMPORT_KEY_CMD_PAYLOAD_STS_GENERATION<span class="op">,</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span>rawKey <span class="op">=</span> <span class="op">{</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>          <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>          <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>          <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>          <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>          <span class="op">}</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>      <span class="op">};</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>      ASSERT<span class="op">(</span>UWB<span class="op">.</span>importKey<span class="op">(&amp;</span>p<span class="op">),</span> SUCCESS<span class="op">);</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Now the settings are imported we can start the UWB circuitry:</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>      ASSERT<span class="op">(</span>UWB<span class="op">.</span>begin<span class="op">(),</span> SUCCESS<span class="op">);</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Most settings are allowed to be changed while the session is running</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Let&#39;s periodically transmit a &#39;poll&#39; packet:</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>      Timer<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>      Timer<span class="op">.</span>every<span class="op">(</span><span class="dv">1000</span><span class="op">,</span> send_poll<span class="op">);</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Setup only the rx/tx event triggers:</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>      UWB<span class="op">.</span>onRxUpdate<span class="op">(</span>RX_DONE<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>      UWB<span class="op">.</span>onTxUpdate<span class="op">(</span>TX_DONE<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>      <span class="co">//  By default, we listen for poll messages</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>      ASSERT<span class="op">(</span>UWB<span class="op">.</span>startRx<span class="op">(</span><span class="dv">0</span><span class="op">),</span> SUCCESS<span class="op">);</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>      <span class="cf">switch</span> <span class="op">(</span>waitForEvent<span class="op">(</span><span class="dv">0</span><span class="op">))</span> <span class="co">// we wait</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>      <span class="op">{</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>RX_DONE<span class="op">:</span> <span class="op">{</span> <span class="co">// poll received</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Received message!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>TX_DONE<span class="op">:</span> <span class="op">{</span> <span class="co">// or timed TX</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Sent message!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">default</span><span class="op">:</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> send_poll<span class="op">()</span> <span class="op">{</span></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Stop listening</span></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>      ASSERT<span class="op">(</span>UWB<span class="op">.</span>stopAction<span class="op">(),</span> SUCCESS<span class="op">);</span></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Make some (arbitary) payload</span></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint8_t</span> buffer<span class="op">[</span><span class="dv">10</span><span class="op">];</span></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>      SetPayloadCmd<span class="op">*</span> cmd <span class="op">=</span> <span class="op">(</span>SetPayloadCmd<span class="op">*)</span>buffer<span class="op">;</span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>      cmd<span class="op">-&gt;</span>payloadLength <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>      ASSERT<span class="op">(</span>UWB<span class="op">.</span>setPayload<span class="op">(</span>cmd<span class="op">),</span> SUCCESS<span class="op">);</span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>      <span class="co">// And Transmit</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>      ASSERT<span class="op">(</span>UWB<span class="op">.</span>startTx<span class="op">(</span><span class="dv">0</span><span class="op">),</span> SUCCESS<span class="op">);</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3
id="example-shield-illuminance-sensor">example-shield-illuminance-sensor</h3>
<p>I2C digital illuminance sensor shield using the BH1750FVI. <a
href="https://www.wemos.cc/en/latest/d1_mini_shield/ambient_light.html">See
Wemos website</a>.</p>
<p><img
src="figures/examples/example-shield-illuminance-sensor/photo.jpg" /></p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">    measured 167 lux</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">    measured 167 lux</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">    measured 161 lux</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">    measured 167 lux</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">    measured 166 lux</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define BH1750_ADDRESS </span><span class="bn">0x23</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define BH1750_POWER_ON </span><span class="bn">0x01</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> Mode <span class="op">{</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">// same as Power Down</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>      UNCONFIGURED <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Measurement at 1 lux resolution. Measurement time is approx 120ms.</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>      CONTINUOUS_HIGH_RES_MODE <span class="op">=</span> <span class="bn">0x10</span><span class="op">,</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Measurement at 0.5 lux resolution. Measurement time is approx 120ms.</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>      CONTINUOUS_HIGH_RES_MODE_2 <span class="op">=</span> <span class="bn">0x11</span><span class="op">,</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Measurement at 4 lux resolution. Measurement time is approx 16ms.</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>      CONTINUOUS_LOW_RES_MODE <span class="op">=</span> <span class="bn">0x13</span><span class="op">,</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Measurement at 1 lux resolution. Measurement time is approx 120ms.</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>      ONE_TIME_HIGH_RES_MODE <span class="op">=</span> <span class="bn">0x20</span><span class="op">,</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Measurement at 0.5 lux resolution. Measurement time is approx 120ms.</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>      ONE_TIME_HIGH_RES_MODE_2 <span class="op">=</span> <span class="bn">0x21</span><span class="op">,</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Measurement at 4 lux resolution. Measurement time is approx 16ms.</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>      ONE_TIME_LOW_RES_MODE <span class="op">=</span> <span class="bn">0x23</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Start UART and I2C</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>      I2C<span class="op">.</span>begin<span class="op">(</span>D2<span class="op">,</span> D1<span class="op">);</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Instruct BH1750 to wake up</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint8_t</span> data<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> BH1750_POWER_ON <span class="op">};</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>      I2C<span class="op">.</span>write<span class="op">(</span>BH1750_ADDRESS<span class="op">,</span> data<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Instruct BH1750 to perform a measurement</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint8_t</span> data<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> ONE_TIME_HIGH_RES_MODE<span class="op">,</span> <span class="dv">0</span> <span class="op">};</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>      I2C<span class="op">.</span>write<span class="op">(</span>BH1750_ADDRESS<span class="op">,</span> data<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Wait until the measurement has completed</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">130</span><span class="op">);</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Transfer the reading</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>      I2C<span class="op">.</span>read<span class="op">(</span>BH1750_ADDRESS<span class="op">,</span> data<span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span> </span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Convert and print the reading</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint16_t</span> lux <span class="op">=</span> <span class="op">(((</span><span class="dt">uint16_t</span><span class="op">)</span>data<span class="op">[</span><span class="dv">0</span><span class="op">])&lt;&lt;</span><span class="dv">8</span><span class="op">)</span> <span class="op">+</span> data<span class="op">[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;measured </span><span class="sc">%u</span><span class="st"> lux</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> lux<span class="op">);</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="example-shield-buzzer">example-shield-buzzer</h3>
<p>Passive buzzer speaker. In this demo, the notes of the C scale are
played are played after sequentially pressing the user (D3) button. <a
href="https://www.wemos.cc/en/latest/d1_mini_shield/buzzer.html">See
Wemos website</a>.</p>
<p><img src="figures/examples/example-shield-buzzer/photo.jpg" /></p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Do-Re-Mi-Fa-So-La-Ti-Do frequencies (Hz):</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint16_t</span> frequencys<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">262</span><span class="op">,</span> <span class="dv">294</span><span class="op">,</span> <span class="dv">330</span><span class="op">,</span> <span class="dv">349</span><span class="op">,</span> <span class="dv">392</span><span class="op">,</span> <span class="dv">440</span><span class="op">,</span> <span class="dv">494</span><span class="op">,</span> <span class="dv">523</span><span class="op">};</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint16_t</span> fIdx <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// To keep track of current pitch</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Function to-be-called to create a PWM signal</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> buzz<span class="op">()</span> <span class="op">{</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">static</span> <span class="dt">bool</span> buzz_state <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>      digitalWrite<span class="op">(</span>D5<span class="op">,</span> buzz_state<span class="op">);</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>      buzz_state <span class="op">=</span> <span class="op">!</span>buzz_state<span class="op">;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Forward declare the button interrupt handlers:</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> btn_down_isr<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> btn_up_isr<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// In our Setup, we only initialize the user (D3) button</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>      pinMode<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> INPUT_PULLUP<span class="op">);</span> <span class="co">// setup button pin</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>      attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> btn_down_isr<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When button down, then a PWM signal is started at pin D5</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> btn_down_isr<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Start listening for button release event:</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>      detachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">);</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>      attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> btn_up_isr<span class="op">,</span> RISING<span class="op">);</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Set D5 as OUTPUT PIN to start the pull/push of the speaker</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>      pinMode<span class="op">(</span>D5<span class="op">,</span> OUTPUT_HIGH<span class="op">);</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Calculate the half-period and set the timer:</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint16_t</span> half_period <span class="op">=</span> <span class="op">(</span><span class="dv">1000000</span><span class="op">/</span><span class="dv">2</span><span class="op">)</span> <span class="op">/</span> frequencys<span class="op">[</span>fIdx<span class="op">];</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>      Timer<span class="op">.</span>everyMicroseconds<span class="op">(</span>half_period<span class="op">,</span> buzz<span class="op">);</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Setup for next tone:</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>      fIdx <span class="op">=</span> fIdx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>fIdx <span class="op">&gt;=</span> <span class="kw">sizeof</span><span class="op">(</span>frequencys<span class="op">)</span> <span class="op">/</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">uint16_t</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>          fIdx <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// On button release, the tone is stopped</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> btn_up_isr<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Start listening for button press event again:</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>      detachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">);</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>      attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> btn_down_isr<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>      Timer<span class="op">.</span>end<span class="op">();</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Stop the pull/push to prevent current flow to/from </span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>      <span class="co">// the speaker:</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>      pinMode<span class="op">(</span>D5<span class="op">,</span> INPUT<span class="op">);</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="example-shield-pir">example-shield-pir</h3>
<p>Detect human motion using a passive infrared sensor (PIR) that
detects small abrupt changes in temperature. <a
href="https://www.wemos.cc/en/latest/d1_mini_shield/pir.html">See Wemos
website</a>.</p>
<p><img src="figures/examples/example-shield-pir/photo.jpg" /></p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">    0</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">    0</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">    0</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">    0</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">    motion_detected</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">    1</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">    1</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">    1</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">    1</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">    no_motion_anymore</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">    0</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">    0</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">    0</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">    0</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co">    0</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Some macro&#39;s to turn on/off the red onboard LED:</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define ON </span>LOW</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define OFF </span>HIGH</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define TURN_RED_LED</span><span class="op">(</span>value<span class="op">)</span><span class="pp">   </span><span class="op">{</span><span class="pp"> </span>digitalWrite<span class="op">(</span>PIN_LED_R<span class="op">,</span><span class="pp"> </span>value<span class="op">);</span><span class="pp"> </span><span class="op">}</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Forward declare the interrupt handlers:</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> motion_detected<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> no_motion_anymore<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Procedure on motion detect:</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> motion_detected<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Print function name:</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="ot">__FUNCTION__</span><span class="op">);</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Start listening for when D3 goes LOW:</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>      detachInterrupt<span class="op">(</span>D3<span class="op">);</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>      attachInterrupt<span class="op">(</span>D3<span class="op">,</span> no_motion_anymore<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Turn on LED to indicate motion:</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>      TURN_RED_LED<span class="op">(</span>ON<span class="op">);</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Procedure when no motion anymore:</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> no_motion_anymore<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="ot">__FUNCTION__</span><span class="op">);</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Start listening for when D3 goes HIGH:</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>      detachInterrupt<span class="op">(</span>D3<span class="op">);</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>      attachInterrupt<span class="op">(</span>D3<span class="op">,</span> motion_detected<span class="op">,</span> RISING<span class="op">);</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Turn off LED:</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>      TURN_RED_LED<span class="op">(</span>OFF<span class="op">);</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Setup LED output and PIR input pins:</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>      pinMode<span class="op">(</span>PIN_LED_R<span class="op">,</span> OUTPUT_HIGH<span class="op">);</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>      pinMode<span class="op">(</span>D3<span class="op">,</span> INPUT<span class="op">);</span> <span class="co">// D3 = PIR pin</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>      attachInterrupt<span class="op">(</span>D3<span class="op">,</span> motion_detected<span class="op">,</span> RISING<span class="op">);</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Print status of PIR pin twice per second:</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> digitalRead<span class="op">(</span>D3<span class="op">));</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">500</span><span class="op">);</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="example-shield-sht30">example-shield-sht30</h3>
<p>I2C Interface digital temperature and humidity sensor shield based
SHT30. <a
href="https://www.wemos.cc/en/latest/d1_mini_shield/sht30.html">See
Wemos website</a>.</p>
<p><img src="figures/examples/example-shield-sht30/photo.jpg" /></p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Temperature: 22.4 deg C, Relative Humidity: 61.2%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Temperature: 22.4 deg C, Relative Humidity: 61.3%</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Temperature: 22.4 deg C, Relative Humidity: 61.2%</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Temperature: 22.4 deg C, Relative Humidity: 61.2%</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Temperature: 22.4 deg C, Relative Humidity: 61.2%</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Temperature: 22.4 deg C, Relative Humidity: 61.2%</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Temperature: 22.4 deg C, Relative Humidity: 61.2%</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define ADDRESS_SHT30 </span><span class="op">(</span><span class="bn">0x45</span><span class="op">)</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Start UART and I2C:</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>begin<span class="op">(</span>D2<span class="op">,</span> D1<span class="op">);</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Send measurement command</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> data<span class="op">[</span><span class="dv">6</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="bn">0x2C</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">};</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>write<span class="op">(</span>ADDRESS_SHT30<span class="op">,</span> data<span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Wait a little, then transfer the readings</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">500</span><span class="op">);</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>read<span class="op">(</span>ADDRESS_SHT30<span class="op">,</span> data<span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Transfered bytes:</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 0: cTemp msb, 1: cTemp lsb, 2: cTemp crc, </span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 3: humidity msb, 4: humidity lsb, 5: humidity crc</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int16_t</span> temp_x10 <span class="op">=</span> <span class="op">(((((</span><span class="dt">uint32_t</span><span class="op">)</span>data<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="dv">8</span><span class="op">)</span> <span class="op">+</span> \</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>            <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>data<span class="op">[</span><span class="dv">1</span><span class="op">])</span> <span class="op">*</span> <span class="dv">1750</span><span class="op">)</span> <span class="op">/</span> <span class="dv">65535</span><span class="op">)</span> <span class="op">-</span> <span class="dv">450</span><span class="op">;</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int16_t</span> humidity_x10 <span class="op">=</span> <span class="op">(((((</span><span class="dt">uint32_t</span><span class="op">)</span>data<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="dv">8</span><span class="op">)</span> <span class="op">+</span> \</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>data<span class="op">[</span><span class="dv">4</span><span class="op">])</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">)</span> <span class="op">/</span> <span class="dv">65535</span><span class="op">);</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Temperature: </span><span class="sc">%i</span><span class="st">.</span><span class="sc">%u</span><span class="st"> deg C, &quot;</span><span class="op">,</span> \</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>            temp_x10<span class="op">/</span><span class="dv">10</span><span class="op">,</span> temp_x10<span class="op">%</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Relative Humidity: </span><span class="sc">%i</span><span class="st">.</span><span class="sc">%u%%\n</span><span class="st">&quot;</span><span class="op">,</span> \</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>            humidity_x10<span class="op">/</span><span class="dv">10</span><span class="op">,</span> humidity_x10<span class="op">%</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="example-transmit-sht30">example-transmit-sht30</h3>
<p>Demonstrating remote readout of a SHT30 temperature/humidity
sensor.</p>
<p>When a SHT30 is connected, temperature and humidity levels will be
read and transmitted over UWB. If there is no SHT30 connected, the
device will listen for UWB and prints the received temperature and
humidity readings over UART.</p>
<p><img src="figures/examples/example-transmit-sht30/photo.jpg" /></p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">    sht30_connected = 1</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">    sht30_connected = 0</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Measured: 24.6 deg C, 61.2 %RH</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">    From 0xF05BB7F6: 24.6 deg C, 61.2 %RH</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Measured: 24.6 deg C, 60.9 %RH</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">    From 0xF05BB7F6: 24.6 deg C, 60.9 %RH</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Measured: 24.6 deg C, 60.5 %RH</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">    From 0xF05BB7F6: 24.6 deg C, 60.5 %RH</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Measured: 24.6 deg C, 60.1 %RH</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">    From 0xF05BB7F6: 24.6 deg C, 60.1 %RH</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Measured: 24.6 deg C, 59.8 %RH</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">    From 0xF05BB7F6: 24.6 deg C, 59.8 %RH</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Measured: 24.5 deg C, 59.5 %RH</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">    From 0xF05BB7F6: 24.5 deg C, 59.5 %RH</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define ADDRESS_SHT30 </span><span class="op">(</span><span class="bn">0x45</span><span class="op">)</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ======================[ DATA STRUCTURES ]====================== //</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">typedef</span> <span class="kw">struct</span> <span class="dt">sht30_payload_t</span> <span class="op">{</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> serial_nr<span class="op">;</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int16_t</span> temp_x10<span class="op">;</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int16_t</span> humidity_x10<span class="op">;</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="dt">sht30_payload_t</span><span class="op">;</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ======================[ DATA CONTAINERS ]====================== //</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">uint8_t</span> uwb_buffer<span class="op">[</span><span class="dv">3</span><span class="op">+</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">sht30_payload_t</span><span class="op">)];</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> sht30_connected <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> my_serial<span class="op">;</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ======================[ SETUP and LOOP ]====================== //</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Start UART and I2C and detect SHT30:</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>ERROR_INTERRUPT<span class="op">,</span> Serial<span class="op">.</span>printError<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>begin<span class="op">(</span>D2<span class="op">,</span> D1<span class="op">);</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>        sht30_connected <span class="op">=</span> I2C<span class="op">.</span>write<span class="op">(</span>ADDRESS_SHT30<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">true</span><span class="op">)</span> \</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>            <span class="op">==</span> WRITE_RESULT_ACK<span class="op">;</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;sht30_connected = </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> sht30_connected<span class="op">);</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>        my_serial <span class="op">=</span> getSerialNumber<span class="op">();</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>        ASSERT_0<span class="op">(</span>UWB<span class="op">.</span>begin<span class="op">());</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sht30_payload_t</span><span class="op">*</span> plData<span class="op">;</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sht30_connected<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Do measurement (see sht30 example)</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>            <span class="dt">uint8_t</span> data<span class="op">[</span><span class="dv">6</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="bn">0x2C</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">};</span> </span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>            I2C<span class="op">.</span>write<span class="op">(</span>ADDRESS_SHT30<span class="op">,</span> data<span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>            delay<span class="op">(</span><span class="dv">500</span><span class="op">);</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>            I2C<span class="op">.</span>read<span class="op">(</span>ADDRESS_SHT30<span class="op">,</span> data<span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Construct Payload (see sht30_payload_t above)</span></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>            SetPayloadCmd<span class="op">*</span> payload <span class="op">=</span> <span class="op">(</span>SetPayloadCmd<span class="op">*)</span>uwb_buffer<span class="op">;</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>            payload<span class="op">-&gt;</span>payloadLength <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">sht30_payload_t</span><span class="op">);</span></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>            plData <span class="op">=</span> <span class="op">(</span><span class="dt">sht30_payload_t</span><span class="op">*)</span>payload<span class="op">-&gt;</span>payloadData<span class="op">;</span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>            plData<span class="op">-&gt;</span>serial_nr <span class="op">=</span> my_serial<span class="op">;</span></span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>            plData<span class="op">-&gt;</span>temp_x10 <span class="op">=</span> <span class="op">(((((</span><span class="dt">uint32_t</span><span class="op">)</span>data<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="dv">8</span><span class="op">)</span> <span class="op">+</span> \</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>                <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>data<span class="op">[</span><span class="dv">1</span><span class="op">])</span> <span class="op">*</span> <span class="dv">1750</span><span class="op">)</span> <span class="op">/</span> <span class="dv">65535</span><span class="op">)</span> <span class="op">-</span> <span class="dv">450</span><span class="op">;</span></span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>            plData<span class="op">-&gt;</span>humidity_x10 <span class="op">=</span> <span class="op">(((((</span><span class="dt">uint32_t</span><span class="op">)</span>data<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="dv">8</span><span class="op">)</span> <span class="op">+</span> \</span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>                <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>data<span class="op">[</span><span class="dv">4</span><span class="op">])</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">)</span> <span class="op">/</span> <span class="dv">65535</span><span class="op">);</span></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Pass payload and transmit UWB packet</span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>            ASSERT_0<span class="op">(</span>UWB<span class="op">.</span>setPayload<span class="op">(</span>payload<span class="op">));</span></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>            UWB<span class="op">.</span>onTxUpdate<span class="op">(</span>TX_DONE<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>            ASSERT_0<span class="op">(</span>UWB<span class="op">.</span>startTx<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Wait until TX was success:</span></span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>            <span class="dt">uint32_t</span> eventID <span class="op">=</span> waitForEvent<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>eventID <span class="op">!=</span> <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>TX_DONE<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span><span class="op">;</span></span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Target payload buffer</span></span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>            PayloadNtf<span class="op">*</span> payload <span class="op">=</span> <span class="op">(</span>PayloadNtf<span class="op">*)</span>uwb_buffer<span class="op">;</span></span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>            UWB<span class="op">.</span>onRxUpdate<span class="op">(</span>RX_DONE<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> payload<span class="op">,</span> \</span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>                <span class="kw">sizeof</span><span class="op">(</span><span class="dt">sht30_payload_t</span><span class="op">),</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Reset and start RX</span></span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>            UWB<span class="op">.</span>stopAction<span class="op">();</span></span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>            ASSERT_0<span class="op">(</span>UWB<span class="op">.</span>startRx<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>            <span class="dt">uint32_t</span> eventID <span class="op">=</span> waitForEvent<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>eventID <span class="op">!=</span> <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>RX_DONE <span class="op">||</span> \</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>                payload<span class="op">-&gt;</span>payloadLength <span class="op">!=</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">sht30_payload_t</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Got something else, restart RX</span></span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span><span class="op">;</span></span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>            <span class="co">// If we get here, RX was success</span></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>            plData <span class="op">=</span> <span class="op">(</span><span class="dt">sht30_payload_t</span><span class="op">*)</span>payload<span class="op">-&gt;</span>payloadData<span class="op">;</span></span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Print reading/received payload:</span></span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>sht30_connected<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;From 0x</span><span class="sc">%08X</span><span class="st">: &quot;</span><span class="op">,</span>  plData<span class="op">-&gt;</span>serial_nr<span class="op">);</span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Measured: &quot;</span><span class="op">);</span></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">%i</span><span class="st">.</span><span class="sc">%u</span><span class="st"> deg C, &quot;</span><span class="op">,</span> \</span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>            plData<span class="op">-&gt;</span>temp_x10<span class="op">/</span><span class="dv">10</span><span class="op">,</span> plData<span class="op">-&gt;</span>temp_x10<span class="op">%</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">%i</span><span class="st">.</span><span class="sc">%u</span><span class="st"> </span><span class="sc">%%</span><span class="st">RH</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> \</span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>            plData<span class="op">-&gt;</span>humidity_x10<span class="op">/</span><span class="dv">10</span><span class="op">,</span> plData<span class="op">-&gt;</span>humidity_x10<span class="op">%</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="example-shield-led-matrix">example-shield-led-matrix</h3>
<p>8x8 Matrix LED interfaced using 1 clock and 1 data wire. <a
href="https://www.wemos.cc/en/latest/d1_mini_shield/matrix_led.html">See
Wemos website</a>.</p>
<p><img
src="figures/examples/example-shield-led-matrix/photo.jpg" /></p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define DISP_CLK_PIN  </span><span class="op">(</span>D5<span class="op">)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define DISP_DATA_PIN </span><span class="op">(</span>D7<span class="op">)</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define DISP_CLK_HIGH</span><span class="op">()</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span>PORTD<span class="pp"> </span><span class="op">|=</span><span class="pp"> </span>DISP_CLK_PIN<span class="op">;</span><span class="pp"> </span><span class="op">}</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define DISP_CLK_LOW</span><span class="op">()</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span>PORTD<span class="pp"> </span><span class="op">&amp;=</span><span class="pp"> </span><span class="op">~</span>DISP_CLK_PIN<span class="op">;</span><span class="pp"> </span><span class="op">}</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define DISP_DATA_HIGH</span><span class="op">()</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span>PORTD<span class="pp"> </span><span class="op">|=</span><span class="pp"> </span>DISP_DATA_PIN<span class="op">;</span><span class="pp"> </span><span class="op">}</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define DISP_DATA_LOW</span><span class="op">()</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span>PORTD<span class="pp"> </span><span class="op">&amp;=</span><span class="pp"> </span><span class="op">~</span>DISP_DATA_PIN<span class="op">;</span><span class="pp"> </span><span class="op">}</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// bit-bang macro:</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define matrix_send_fast</span><span class="op">(</span>data<span class="op">,</span><span class="pp"> </span>bits<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="pp">      </span><span class="cf">for</span><span class="pp"> </span><span class="op">(</span><span class="dt">uint8_t</span><span class="pp"> </span>i<span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="dv">0</span><span class="op">;</span><span class="pp"> </span>i<span class="pp"> </span><span class="op">&lt;</span><span class="pp"> </span>bits<span class="op">;</span><span class="pp"> </span>i<span class="op">++)</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>PORTD<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>data_clk<span class="op">;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>data<span class="pp"> </span><span class="op">&amp;</span><span class="pp"> </span><span class="op">(</span><span class="dv">1</span><span class="bu">ul</span><span class="op">&lt;&lt;</span>i<span class="op">))</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="pp">          </span>PORTD<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>DATA_clk<span class="op">;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="pp">          </span>PORTD<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>DATA_CLK<span class="op">;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="pp">          </span>PORTD<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>data_clk<span class="op">;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="pp">          </span>PORTD<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>data_CLK<span class="op">;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="pp">      </span><span class="op">}</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> matrix_init<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>      pinMode<span class="op">(</span>DISP_DATA_PIN <span class="op">|</span> DISP_CLK_PIN<span class="op">,</span> OUTPUT_HIGH<span class="op">);</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// show single 64 bit value with 3-bit intensity:</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> matrix_refresh<span class="op">(</span><span class="dt">uint64_t</span><span class="op">*</span> data<span class="op">,</span> <span class="dt">uint8_t</span> intensity_3bit<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint32_t</span> data_clk <span class="op">=</span> PORTD <span class="op">&amp;</span> <span class="op">~(</span>DISP_CLK_PIN <span class="op">|</span> DISP_DATA_PIN<span class="op">);</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint32_t</span> data_CLK <span class="op">=</span> data_clk <span class="op">|</span> DISP_CLK_PIN<span class="op">;</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint32_t</span> DATA_clk <span class="op">=</span> data_clk <span class="op">|</span> DISP_DATA_PIN<span class="op">;</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint32_t</span> DATA_CLK <span class="op">=</span> data_clk <span class="op">|</span> DISP_CLK_PIN <span class="op">|</span> DISP_DATA_PIN<span class="op">;</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>      PORTD <span class="op">=</span> data_CLK<span class="op">;</span> </span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>      matrix_send_fast<span class="op">(</span><span class="bn">0x44</span><span class="op">,</span> <span class="dv">8</span><span class="op">);</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>      PORTD <span class="op">=</span> DATA_CLK<span class="op">;</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>      PORTD <span class="op">=</span> data_CLK<span class="op">;</span> </span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>      matrix_send_fast<span class="op">(</span><span class="bn">0xC0</span><span class="op">,</span> <span class="dv">8</span><span class="op">);</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint32_t</span> d1 <span class="op">=</span> <span class="op">((</span><span class="dt">uint32_t</span><span class="op">*)</span>data<span class="op">)[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint32_t</span> d2 <span class="op">=</span> <span class="op">((</span><span class="dt">uint32_t</span><span class="op">*)</span>data<span class="op">)[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>      matrix_send_fast<span class="op">(</span>d1<span class="op">,</span> <span class="dv">32</span><span class="op">);</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>      matrix_send_fast<span class="op">(</span>d2<span class="op">,</span> <span class="dv">32</span><span class="op">);</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>      PORTD <span class="op">=</span> DATA_CLK<span class="op">;</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>      PORTD <span class="op">=</span> data_CLK<span class="op">;</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>      PORTD <span class="op">=</span> data_clk<span class="op">;</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>      PORTD <span class="op">=</span> data_CLK<span class="op">;</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>      PORTD <span class="op">=</span> DATA_CLK<span class="op">;</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>      PORTD <span class="op">=</span> data_CLK<span class="op">;</span> </span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint8_t</span> intensity_cmd <span class="op">=</span> <span class="bn">0x88</span><span class="op">|(</span>intensity_3bit<span class="op">);</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>      matrix_send_fast<span class="op">(</span>intensity_cmd<span class="op">,</span> <span class="dv">8</span><span class="op">);</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>      PORTD <span class="op">=</span> DATA_CLK<span class="op">;</span> </span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">// iterate every pixel</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> show_animation<span class="op">()</span> <span class="op">{</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span> <span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">64</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint64_t</span> data <span class="op">=</span> <span class="dv">1</span><span class="bu">ull</span> <span class="op">&lt;&lt;</span> <span class="op">(</span>i <span class="op">%</span> <span class="dv">64</span><span class="op">);</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>        matrix_refresh<span class="op">(&amp;</span>data<span class="op">,</span> <span class="dv">7</span><span class="op">);</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> sprite_heart <span class="op">=</span> <span class="bn">0x1824428181996600</span><span class="op">;</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>        matrix_init<span class="op">();</span></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">// show heart sprite for 5 seconds</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>        matrix_refresh<span class="op">(&amp;</span>sprite_heart<span class="op">,</span> <span class="dv">7</span><span class="op">);</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">5000</span><span class="op">);</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>    <span class="co">// play animation</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>      show_animation<span class="op">();</span></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3
id="example-asynchronous-programming">example-asynchronous-programming</h3>
<p>Demonstrating asynchronous events: user button interrupt, UWB_TX_DONE
interrupt, and UWB.onTxUpdate.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">    It took 46 us to transmit the SFD</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">    It then took 45 us to trigger UWB_TX_DONE</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">    It then took 49 us to return</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Current CPU vs UWB time: 30012695 vs 30012694 = -1 us</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Some arbitrary 8-bit event identifiers:</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        TX_EVENT <span class="op">=</span> <span class="bn">0x12</span><span class="op">,</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        BUTTON_EVENT <span class="op">=</span> <span class="bn">0x23</span><span class="op">,</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Data containers that we&#39;ll use to calculate latencies:</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    TxTimestampNtf txResult<span class="op">;</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> txDoneMarker<span class="op">;</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> returnMarker<span class="op">;</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> scheduleMarker<span class="op">;</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// These are Interrupt Service Routines or interrupt handlers:</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> scheduleTx<span class="op">()</span> <span class="op">{</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>      scheduleMarker <span class="op">=</span> micros<span class="op">();</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>      UWB<span class="op">.</span>startTx<span class="op">(</span>ASAP<span class="op">);</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Previously we set:</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>      <span class="co">//  - attachInterrupt(UWB_TX_DONE, txDoneHandler, 0):</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">//    Interrupt UWB_TX_DONE is triggered before data is read!</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>      <span class="co">//    This can be used to early schedule events or change GPIO.</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>      <span class="co">// </span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>      <span class="co">//  - UWB.onTxUpdate((void*)TX_EVENT, &amp;txResult):</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>      <span class="co">//    When the TX action is fully completed, </span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>      <span class="co">//    triggerEvent(TX_EVENT) is called. TX timestamp will be </span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>      <span class="co">//    stored in container object txResult.</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> txDoneHandler<span class="op">()</span> <span class="op">{</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>      txDoneMarker <span class="op">=</span> micros<span class="op">();</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> buttonHandler<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>      triggerEvent<span class="op">(</span>BUTTON_EVENT<span class="op">);</span></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Setup user (D3 / GPIO4) button and UART:</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>      pinMode<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> INPUT_PULLUP<span class="op">);</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>      attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> buttonHandler<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>      UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Configure UWB interrupts:</span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>      attachInterrupt<span class="op">(</span>UWB_TX_DONE<span class="op">,</span> txDoneHandler<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>      UWB<span class="op">.</span>onTxUpdate<span class="op">((</span><span class="dt">void</span><span class="op">*)</span>TX_EVENT<span class="op">,</span> <span class="op">&amp;</span>txResult<span class="op">);</span></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>      Timer<span class="op">.</span>every<span class="op">(</span><span class="dv">1000</span><span class="op">,</span> scheduleTx<span class="op">);</span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint32_t</span> eventId <span class="op">=</span> waitForEvent<span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// Wait for a triggerEvent()</span></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>      <span class="cf">switch</span> <span class="op">(</span>eventId<span class="op">)</span> <span class="op">{</span> </span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> TX_EVENT<span class="op">:</span> <span class="op">{</span></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>          returnMarker <span class="op">=</span> micros<span class="op">();</span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>          <span class="dt">uint32_t</span> txTimestamp_us <span class="op">=</span> TICKS_TO_MICROS<span class="op">(</span>txResult<span class="op">.</span>txTimestamp<span class="op">);</span></span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>          <span class="dt">int32_t</span> dt1 <span class="op">=</span> txTimestamp_us <span class="op">-</span> scheduleMarker<span class="op">;</span></span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>          <span class="dt">int32_t</span> dt2 <span class="op">=</span> txDoneMarker <span class="op">-</span> txTimestamp_us<span class="op">;</span></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>          <span class="dt">int32_t</span> dt3 <span class="op">=</span> returnMarker <span class="op">-</span> txDoneMarker<span class="op">;</span></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>          <span class="co">// How many microseconds (us) passed between scheduling and </span></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>          <span class="co">// transmitting the Start of Frame Delimiter (SFD)?</span></span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;It took </span><span class="sc">%i</span><span class="st"> us to transmit the SFD</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> dt1<span class="op">);</span></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>          <span class="co">// How many microseconds passed between transmitting the SFD </span></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>          <span class="co">// and receiving the UWB_TX_DONE interrupt?</span></span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;It then took </span><span class="sc">%i</span><span class="st"> us to trigger UWB_TX_DONE</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> dt2<span class="op">);</span></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>          <span class="co">// How many microseconds passed between the UWB_TX_DONE interrupt</span></span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>          <span class="co">// and returing to the application?</span></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;It then took </span><span class="sc">%i</span><span class="st"> us to return</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> dt3<span class="op">);</span></span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>          <span class="co">// How well are the CPU clock and Radio Circuitry clock in sync?</span></span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>          <span class="dt">uint32_t</span> t_1 <span class="op">=</span> micros<span class="op">();</span></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>          <span class="dt">uint32_t</span> t_2 <span class="op">=</span> TICKS_TO_MICROS<span class="op">(*</span>ticks<span class="op">());</span></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Current CPU vs UWB time: </span><span class="sc">%i</span><span class="st"> vs </span><span class="sc">%i</span><span class="st"> = </span><span class="sc">%i</span><span class="st"> us</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> \</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>          t_1<span class="op">,</span> t_2<span class="op">,</span> t_2 <span class="op">-</span> t_1<span class="op">);</span></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> BUTTON_EVENT<span class="op">:</span> <span class="op">{</span></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Button Pressed</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="example-clock-speeds">example-clock-speeds</h3>
<p>For creating awareness of the different clock speeds that are being
used.</p>
<p>The SFM10 runs at various clock speeds depending on the situation.
For example, when the radio circuitry is not running, the OL23D0 will
run on a power-friendly internal oscillator with a frequency of about
38.4 MHz. When the radio is running, the additional XTAL (typically
55.2MHz) is used for the CPU clock and an internal fractional PLL
circuit is used to boost this up to about 64GHz for the UWB clock. The
CPU versus UWB clock speed ratio is not constant and converting one into
the other is not straightforward.</p>
<p><img src="figures/examples/example-clock-speeds/drawing.png" /></p>
<p>Conveniently, we have tried to hide this complexity for you by
introducing functions like micros() and ticks() that take into account
all conversion oddities. Nevertheless, it is good to be aware of the
various clock frequencies that are involved because, especially around
these speed jumps, you may want to include extra delays or
re-initialisations of buses to avoid unexpected behavior.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span> <span class="co">// wake up at ~38.4Mhz </span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Time = </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> micros<span class="op">());</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>      UWB<span class="op">.</span>begin<span class="op">();</span> <span class="co">// use XTAL ~55.2Mhz for CPU</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">// and start ~64MHz timestamp unit</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint32_t</span> t1 <span class="op">=</span> micros<span class="op">();</span> <span class="co">// capture CPU time </span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">// and capture timestamp unit time:</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint32_t</span> t2 <span class="op">=</span> TICKS_TO_MICROS<span class="op">(*</span>ticks<span class="op">());</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">%i</span><span class="st"> vs </span><span class="sc">%i</span><span class="st"> us</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> t1<span class="op">,</span> t2<span class="op">);</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">10</span><span class="op">);</span> <span class="co">// Allow UART to print</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>      UWB<span class="op">.</span>end<span class="op">();</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Now sleep...</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">2</span><span class="op">);</span> <span class="co">// Allow UART to print</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>      EnterPowerModeCmd cmd <span class="op">=</span> <span class="op">{</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>powerMode <span class="op">=</span> DEEP_POWER_DOWN<span class="op">,</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>wakeUpPin <span class="op">=</span> PIN_CS1<span class="op">,</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>wakeUpTime <span class="op">=</span> millis<span class="op">()</span> <span class="op">+</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>      <span class="op">};</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>      UWB<span class="op">.</span>enterPowerMode<span class="op">(&amp;</span>cmd<span class="op">);</span> <span class="co">// start 32Khz oscillator </span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="example-radar">example-radar</h3>
<p>Demonstrating how to setup single-device radar functionality.</p>
<p>The OL23D0 is able to transmit and receive at the same time, which is
called loopback. This allows to perform self-calibration with regard to
the antenna delay, which must be compensated for when caluclating time
of flight (i.e., distances). However, the loopback functionality can
also be used to create radar. The strongest pulse in the channel impulse
response (CIR) is the direct reflection on the UWB antenna. The
subsequent samples are reflections from the surroundings (e.g. walls,
ceiling, desk etc.).</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Define the radar range:</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define MAX_DISTANCE_M </span><span class="dv">5</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// CIR will have samples of roughly 30cm:</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define CIR_SAMPLE_CNT </span><span class="op">((</span>MAX_DISTANCE_M<span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="dv">3</span><span class="op">))</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Some arbitrary (8bit) event identifier: </span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define LOOPBACK_DONE </span><span class="op">(</span><span class="bn">0x08</span><span class="op">)</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Our data container:</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    CirNtf cirBuf<span class="op">;</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We start UART and UWB configuration:</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We change the CIR settings to our region of interest:</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        SetConfigurationCmd config<span class="op">;</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        SetConfiguration_setDefaults<span class="op">(&amp;</span>config<span class="op">);</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Our first sample will represent 0m distance:</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>        config<span class="op">.</span>channelImpulseResponseStart <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>        config<span class="op">.</span>channelImpulseResponseLength <span class="op">=</span> CIR_SAMPLE_CNT<span class="op">;</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>setConfiguration<span class="op">(&amp;</span>config<span class="op">);</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We start the UWB ciruitry:</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Using onRxUpdate we configure where to store the CIR:</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onRxUpdate<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="op">&amp;</span>cirBuf<span class="op">);</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Using onLoopbackUpdate we say it should trigger</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>        <span class="co">// LOOPBACK_DONE when loopback is complete:</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onLoopbackUpdate<span class="op">((</span><span class="dt">void</span><span class="op">*)</span>LOOPBACK_DONE<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We print the table header: time, followed by </span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">// alternating real and imaginary numbers:</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;  time, &quot;</span><span class="op">,</span> millis<span class="op">());</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">uint16_t</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> CIR_SAMPLE_CNT<span class="op">*</span><span class="dv">2</span><span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>k <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot; r</span><span class="sc">%02i</span><span class="st">, &quot;</span><span class="op">,</span> k<span class="op">/</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot; i</span><span class="sc">%02i</span><span class="st">, &quot;</span><span class="op">,</span> k<span class="op">/</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> </span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Start the first loopback:</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>startLoopback<span class="op">(</span>ASAP<span class="op">);</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Wait, then print the channel impulse response:</span></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>waitForEvent<span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="op">==</span> LOOPBACK_DONE<span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">%6u</span><span class="st">, &quot;</span><span class="op">,</span> millis<span class="op">());</span></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">uint16_t</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> CIR_SAMPLE_CNT<span class="op">*</span><span class="dv">2</span><span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">%4i</span><span class="st">, &quot;</span><span class="op">,</span> cirBuf<span class="op">.</span>cirData<span class="op">[</span>k<span class="op">]);</span></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> </span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> </span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>startLoopback<span class="op">(</span>ASAP<span class="op">);</span></span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a><span class="co">      time,  r00,  i00,  r01,  i01,  r02,  i02,  r03,  i03, ...</span></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a><span class="co">        22,  316,  148,  260,  106,   38,    2, -150,  -78, ...</span></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a><span class="co">       140,  314,  149,  258,  106,   37,    1, -150,  -78, ...</span></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a><span class="co">       257,  311,  147,  255,  107,   35,    5, -150,  -74, ...</span></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a><span class="co">       374,  314,  147,  258,  105,   37,    3, -150,  -75, ...</span></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a><span class="co">       491,  315,  149,  259,  107,   37,    2, -150,  -78, ...</span></span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a><span class="co">       608,  316,  148,  257,  105,   36,    2, -149,  -76, ...</span></span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a><span class="co">       725,  313,  147,  257,  105,   36,    2, -150,  -77, ...</span></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a><span class="co">       842,  314,  148,  257,  106,   36,    3, -151,  -75, ...</span></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h1 id="general-user-application-api">General User Application API</h1>
<h2 id="general-error-codes">General Error Codes</h2>
<p>In case the user application could not be started, the <a
href="#errno"><code>errno</code></a> will be printen via a UART string
(115200 baud rate) as ‘Could not start user application: Errno 0x…’</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x000001</td>
<td
style="text-align: left;">E_USER_APPLICATION_PRIMARY__VERSION_OUTDATED:
User application has too low version number. Make sure your
user-application.h matches the uwb library version.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x000002</td>
<td
style="text-align: left;">E_USER_APPLICATION_PRIMARY__VERSION_TOO_HIGH:
User application has too high version number. Make sure your
user-application.h matches the uwb library version.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x000003</td>
<td
style="text-align: left;">E_USER_APPLICATION_PRIMARY__VALIDATION_FAILED:
A user application is present, but activation failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x000004</td>
<td
style="text-align: left;">E_USER_APPLICATION_PRIMARY__UNKNOWN_STATUS: A
user application is present, but its status flag has an unknown
value.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x000005</td>
<td
style="text-align: left;">E_USER_APPLICATION_PRIMARY__APP_INVALIDATED: A
user application is present, but it is invalidated, possibly after
reflashing the Primary Firmware.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x000006</td>
<td style="text-align: left;">E_USER_APPLICATION_PRIMARY__NO_VALID_APP:
Flash is touched, but there is no valid user application detected.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x000007</td>
<td style="text-align: left;">E_USER_APPLICATION_PRIMARY__NO_APP_FOUND:
No user application detected.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x000008</td>
<td
style="text-align: left;">E_USER_APPLICATION_PRIMARY__NO_VALID_STACK:
Current UWB stack is not valid.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x000009</td>
<td
style="text-align: left;">E_USER_APPLICATION_PRIMARY__STACK_OVERFLOW:
The processor stack pointer is outside the valid stack space.</td>
</tr>
</tbody>
</table>
<h2 id="power">Power</h2>
<p>Device reset and power modes. This family of functions has seven
functions defined.</p>
<h3 id="getresetreason"><code>getResetReason()</code></h3>
<p><strong>Prototype</strong>:
<code>uint8_t getResetReason( void )</code></p>
<p><strong>Description</strong>: Indicates the cause of the last
reset.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>                        </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Reset reason = &quot;</span><span class="op">);</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>getResetReason<span class="op">())</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> POWER_ON<span class="op">:</span>              Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;POWER_ON&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> RESET_PIN<span class="op">:</span>             Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;RESET_PIN&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> DPD_RESET_PIN<span class="op">:</span>         Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;DPD_RESET_PIN&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> HPD_RESET_PIN<span class="op">:</span>         Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;HPD_RESET_PIN&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> HPD_WAKE_UP_PIN<span class="op">:</span>       Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;HPD_WAKE_UP_PIN&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> SOFTWARE_RESET<span class="op">:</span>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;SOFTWARE_RESET&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> FAIL_BIAS_BANDGAP_VDD<span class="op">:</span> Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;FAIL_BIAS_BANDGAP_VDD&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> FAIL_CPU_VDD<span class="op">:</span>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;FAIL_CPU_VDD&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> BROWNOUT_CPU<span class="op">:</span>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;BROWNOUT_CPU&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> FAIL_PFLASH_VDD<span class="op">:</span>       Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;FAIL_PFLASH_VDD&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> FAIL_BUF_LOW_VDD<span class="op">:</span>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;FAIL_BUF_LOW_VDD&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> WATCHDOG<span class="op">:</span>              Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;WATCHDOG&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> FAIL_STATE_CHANGE<span class="op">:</span>     Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;FAIL_STATE_CHANGE&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> WUP_TIMER<span class="op">:</span>             Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;WUP_TIMER&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> WUP_SNAPSHOT<span class="op">:</span>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;WUP_SNAPSHOT&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> DPD_GPIO<span class="op">:</span>              Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;DPD_GPIO&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">default</span><span class="op">:</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="reset"><code>reset()</code></h3>
<p><strong>Prototype</strong>: <code>void reset( void )</code></p>
<p><strong>Description</strong>: Resets the device. All global variables
will be cleared, except for the one stored in the Persistent
Register.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;t=</span><span class="sc">%u</span><span class="st">: Boot!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> millis<span class="op">());</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        reset<span class="op">();</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// This line is never reached</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* example output:</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">    t=1: Boot!</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">    t=1: Boot!</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">    t=1: Boot!</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">    t=1: Boot!</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3
id="sleeptime-pin-pinedge"><code>sleep(time, pin, pinEdge)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal sleep( uint32_t time, uint16_t pin, uint8_t pinEdge )</code></p>
<p><strong>Description</strong>: Puts the chip into a low power state to
save energy (deep power down).</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">time</td>
<td style="text-align: left;">(uint32_t) Wake-up time in ms. Non-zero
only allowed in Deep Power Down mode. This configures the wake-up timer
with the given value.</td>
</tr>
<tr class="even">
<td style="text-align: left;">pin</td>
<td style="text-align: left;">(uint16_t) Wake-up pin configuration.
Please note that at least one wake up source has to be configured. If no
wake up source is configured a parameter error will be returned.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pinEdge</td>
<td style="text-align: left;">(uint8_t) Configures the edge of the wake
up pin signal. 0 = falling, 1 = rising edge.</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;t=</span><span class="sc">%u</span><span class="st">: Boot!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> millis<span class="op">());</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">10</span><span class="op">);</span> <span class="co">// allow Serial.print() to finish</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        sleep<span class="op">(</span><span class="dv">1000</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span> <span class="co">// Go to power saving mode until t=1000</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// This line is never reached</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* example output:</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">    t=1: Boot!</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co">    t=1: Boot!</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co">    t=1: Boot!</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co">    t=1: Boot!</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;t=</span><span class="sc">%u</span><span class="st">: Boot!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> millis<span class="op">());</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">10</span><span class="op">);</span> <span class="co">// allow Serial.print() to finish</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Go to power saving mode until User Button is pressed:</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        sleep<span class="op">(</span><span class="dv">0</span><span class="op">,</span> PIN_USER_BUTTON<span class="op">,</span> FALLING<span class="op">);</span>     </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// This line is never reached</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Error Codes: </strong> In case of an error,
<code>sleep()</code> will set <a href="#errno"><code>errno</code></a> to
one of the following error codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x010301</td>
<td style="text-align: left;">E_POWER_SLEEP__NO_TIME_ALLOWED: With hard
power down, no timer is available for wake up. Set wake up time to
0.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x010302</td>
<td style="text-align: left;">E_POWER_SLEEP__FALLING_ONLY: With hard
power down, possible pins for wake up are D8, RX and TX, only falling
edge is allowed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x010303</td>
<td style="text-align: left;">E_POWER_SLEEP__NO_WAKEUP_SOURCE: At least
one wake up source must be specified.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x010304</td>
<td style="text-align: left;">E_POWER_SLEEP__UNKNOWN_SLEEP_MODE: The
provided power mode is invalid.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x010305</td>
<td style="text-align: left;">E_POWER_SLEEP__WAKE_UP_TIME_PASSED: The
wake up time cannot be in the past.</td>
</tr>
</tbody>
</table>
<h3 id="deepsleeppin"><code>deepSleep(pin)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal deepSleep( uint16_t pin )</code></p>
<p><strong>Description</strong>: Puts the chip into the lowest power
state to save energy (hard power down). Only PIN_RX, PIN_TX, and D8
(GPIO0) can be used (FALLING edge only).</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">pin</td>
<td style="text-align: left;">(uint16_t) Wake-up pin configuration.
Please note that at least one wake up source has to be configured. If no
wake up source is configured a parameter error will be returned.</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;t=</span><span class="sc">%u</span><span class="st">: Boot!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> millis<span class="op">());</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">10</span><span class="op">);</span> <span class="co">// allow Serial.print() to finish</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Go to optimal power saving mode until UART is received.</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Only PIN_RX, PIN_TX, and D8 (GPIO0) can be used (FALLING edge only)</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        deepSleep<span class="op">(</span>PIN_RX<span class="op">);</span> </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// This line is never reached</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Error Codes: </strong> In case of an error,
<code>deepSleep()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x010401</td>
<td style="text-align: left;">E_POWER_DEEP_SLEEP__NO_WAKEUP_SOURCE: At
least one wake up source must be specified.</td>
</tr>
</tbody>
</table>
<h3 id="limitcurrentmilliamps"><code>limitCurrent(milliAmps)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal limitCurrent( uint8_t milliAmps )</code></p>
<p><strong>Description</strong>: Limit the current, to improve battery
life. Current Limit can be set between 5 and 20 mA. When using the
SFM10-dev, make sure to desolder the bypass resistor between VBAT and
VBUF.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">milliAmps</td>
<td style="text-align: left;">(uint8_t) A value of 0 disables the
current limiter. It is advised to connect VBuf and VBat when the current
limiter is not used. The value(s) should be between 0 and 20. The
default value is ‘0’.</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>limitCurrent()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x010501</td>
<td style="text-align: left;">E_POWER_LIMIT_CURRENT__OUT_OF_RANGE: Value
is out of range.</td>
</tr>
</tbody>
</table>
<h3 id="persistentread"><code>persistentRead()</code></h3>
<p><strong>Prototype</strong>:
<code>uint32_t persistentRead( void )</code></p>
<p><strong>Description</strong>: When the device is resetted using the
reset pin / button, resetted via software, or awakens from a deep or
hard power down, all data in RAM is cleared. However, there are 4 bytes
of data that persist and survive a reset. This can be read back as a 32
bit value using this function. To store the data, use
<code>peristentWrite()</code>. These 32 bits are cleared only after a
Power-On Reset.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> var1<span class="op">;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> var2<span class="op">;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Boot!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        var2 <span class="op">=</span> persistentRead<span class="op">();</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        var1<span class="op">++;</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>        var2<span class="op">++;</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;var1 = </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> var1<span class="op">);</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;var2 = </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> var2<span class="op">);</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        persistentWrite<span class="op">(</span>var2<span class="op">);</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* example output:</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Boot!</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">    var1 = 1</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co">    var2 = 1</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co">    Boot!</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="co">    var1 = 1</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="co">    var2 = 2</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Boot!</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="co">    var1 = 1</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="co">    var2 = 3</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="persistentwritevalue"><code>persistentWrite(value)</code></h3>
<p><strong>Prototype</strong>:
<code>void persistentWrite( uint32_t value )</code></p>
<p><strong>Description</strong>: When the device is resetted using the
reset pin / button, resetted via software, or awakens from a deep or
hard power down, all data in RAM is cleared. However, there are 4 bytes
of data that persist and survive a reset. This can be set as a 32 bit
value using this function. To read back the data, use
<code>peristentRead()</code>. These 32 bits are cleared only after a
Power-On Reset.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">value</td>
<td style="text-align: left;">(uint32_t) .</td>
</tr>
</tbody>
</table>
<h2 id="digital-io-gpio">Digital I/O (GPIO)</h2>
<p>Basic reading and writing of digital signals with the General Purpose
Input/Output (GPIO) pins. This family of functions has four functions
defined.</p>
<h3 id="pinmodepinmask-mode"><code>pinMode(pinMask, mode)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal pinMode( uint16_t pinMask, uint8_t mode )</code></p>
<p><strong>Description</strong>: Configures the specified GPIO pin to
behave either as an input or an output.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">pinMask</td>
<td style="text-align: left;">(uint16_t) To indicate which pins should
have the specified mode. This should be a 10-bit number with each bit
representing one of the GPIO pins.</td>
</tr>
<tr class="even">
<td style="text-align: left;">mode</td>
<td style="text-align: left;">(uint8_t) Pin Mode can be set to INPUT,
OUTPUT, INPUT_PULLUP, INPUT_PULLDOWN, OUTPUT_LOW, or OUTPUT_HIGH. For
supported values, <a href="#mode">see below</a>.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>pinMode(D8, OUTPUT)</code></td>
<td style="text-align: left;">3 us</td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">97</td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>pinMode(D8, INPUT_PULLDOWN)</code></td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">3 us</td>
<td style="text-align: left;">177</td>
</tr>
<tr class="odd">
<td
style="text-align: left;"><code>pinMode(D8, INPUT_PULLUP)</code></td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">3 us</td>
<td style="text-align: left;">177</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>pinMode(D8, INPUT)</code></td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">3 us</td>
<td style="text-align: left;">177</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span> D1<span class="op">,</span> OUTPUT <span class="op">);</span> <span class="co">// configure GPIO pin D1 as an output</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// pin D1 and D2 as OUTPUT, starting with level set to HIGH:</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span> D1 <span class="op">|</span> D2<span class="op">,</span> OUTPUT <span class="op">|</span> HIGH <span class="op">);</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Parameter Values:</strong></p>
<h5 id="mode">Mode</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(uint8_t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">INPUT (0x00)</td>
<td style="text-align: left;">Digital input without an internal resistor
enabled.</td>
</tr>
<tr class="even">
<td style="text-align: left;">OUTPUT (0x10)</td>
<td style="text-align: left;">Digital output, starting with level set to
LOW.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">INPUT_PULLUP (0x01)</td>
<td style="text-align: left;">Digital input with an internal pullup
resistor enabled.</td>
</tr>
<tr class="even">
<td style="text-align: left;">INPUT_PULLDOWN (0x02)</td>
<td style="text-align: left;">Digital input with an internal pulldown
resistor enabled.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OUTPUT_LOW (0x10)</td>
<td style="text-align: left;">Digital output, starting with level set to
LOW.</td>
</tr>
<tr class="even">
<td style="text-align: left;">OUTPUT_HIGH (0x11)</td>
<td style="text-align: left;">Digital output, starting with level set to
HIGH.</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>pinMode()</code> will set <a href="#errno"><code>errno</code></a>
to one of the following error codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x020101</td>
<td style="text-align: left;">E_GPIO_PIN_MODE__PIN_UNKNOWN: The
specified pin number does not map to a physical gpio pin.</td>
</tr>
</tbody>
</table>
<h3
id="digitalwritepinmask-value"><code>digitalWrite(pinMask, value)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal digitalWrite( uint16_t pinMask, uint8_t value )</code></p>
<p><strong>Description</strong>: Write a HIGH (0x01) or a LOW (0x00)
value to a digital pin. If the pin has been configured as an OUTPUT with
<code>pinMode()</code>, its voltage will be set to the corresponding
value (e.g., 3.3V for HIGH, 0V (ground) for LOW). If the pin is
configured as an INPUT, this function will not have an effect. It is
recommended to set the <code>pinMode()</code> to INPUT_PULLUP to enable
the internal pull-up resistor or INPUT_PULLDOWN to enable the internal
pull-down resistor.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">pinMask</td>
<td style="text-align: left;">(uint16_t) To indicate which pins should
be set. This should be a 10-bit number with each bit representing one of
the GPIO pins.</td>
</tr>
<tr class="even">
<td style="text-align: left;">value</td>
<td style="text-align: left;">(uint8_t) HIGH or LOW. For supported
values, <a href="#value">see below</a>.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>digitalWrite(D1, HIGH)</code></td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">89</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>digitalWrite(D1, LOW)</code></td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">89</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>PIN_LED_R<span class="op">,</span> OUTPUT<span class="op">);</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        digitalWrite<span class="op">(</span>PIN_LED_R<span class="op">,</span> LOW<span class="op">);</span> <span class="co">// set voltage at P10 to 0V</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span> <span class="co">// wait one second</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        digitalWrite<span class="op">(</span>PIN_LED_R<span class="op">,</span> HIGH<span class="op">);</span> <span class="co">// set voltage at P10 to 3.3V</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint16_t</span> pinMask <span class="op">=</span> PIN_LED_R <span class="op">|</span> PIN_LED_G<span class="op">;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// identical to: pinMask = GPIO8 | GPIO9;</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// or: pinMask = D1 | D2;</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>pinMask<span class="op">,</span> OUTPUT<span class="op">);</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        digitalWrite<span class="op">(</span>pinMask<span class="op">,</span> LOW<span class="op">);</span> </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        digitalWrite<span class="op">(</span>pinMask<span class="op">,</span> HIGH<span class="op">);</span> </span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Parameter Values:</strong></p>
<h5 id="value">Value</h5>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(uint8_t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LOW (0x00)</td>
<td style="text-align: left;">Logical 0.</td>
</tr>
<tr class="even">
<td style="text-align: left;">HIGH (0x01)</td>
<td style="text-align: left;">Logical 1.</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>digitalWrite()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x020201</td>
<td style="text-align: left;">E_GPIO_DIGITAL_WRITE__PIN_UNKNOWN: The
specified pin number does not map to a physical GPIO pin.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x020202</td>
<td style="text-align: left;">E_GPIO_DIGITAL_WRITE__PIN_IS_INPUT: The
specified pin is configured as an output. Use <code>pinMode()</code> to
make it an INPUT and optionally activate pullup or pulldown
resistors.</td>
</tr>
</tbody>
</table>
<h3 id="digitalreadpinmask"><code>digitalRead(pinMask)</code></h3>
<p><strong>Prototype</strong>:
<code>uint8_t digitalRead( uint16_t pinMask )</code></p>
<p><strong>Description</strong>: Reads the value from a specified
digital pin. The result will be either <code>HIGH</code> or
<code>LOW</code>.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">pinMask</td>
<td style="text-align: left;">(uint16_t) To indicate which pin should be
read.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td
style="text-align: left;"><code>digitalRead(PIN_USER_BUTTON)</code></td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">59</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> INPUT_PULLUP<span class="op">);</span> </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// GPIO4 / D3 maps to User Button on SFM10-DEV</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> value <span class="op">=</span> digitalRead<span class="op">(</span>PIN_USER_BUTTON<span class="op">);</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Value of button = </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> value<span class="op">);</span> </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">100</span><span class="op">);</span> <span class="co">// wait 0.1 second</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Error Codes: </strong> In case of an error,
<code>digitalRead()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x020301</td>
<td style="text-align: left;">E_GPIO_DIGITAL_READ__PIN_UNKNOWN: The
specified pin number does not map to a physical GPIO pin.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x020302</td>
<td style="text-align: left;">E_GPIO_DIGITAL_READ__PIN_IS_OUTPUT: The
specified pin number is configured as an output.</td>
</tr>
</tbody>
</table>
<h3 id="analogreadchannel"><code>analogRead(channel)</code></h3>
<p><strong>Prototype</strong>:
<code>int32_t analogRead( uint8_t channel )</code></p>
<p><strong>Description</strong>: Reads the value from the specified
analog pin. On the SFM10 boards, all pins are connected internally that
allows you to read supply voltages and temperatures.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">channel</td>
<td style="text-align: left;">(uint8_t) To indicate which measure you
want. For supported values, <a href="#channel">see below</a>.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>analogRead(VDD_IO)</code></td>
<td style="text-align: left;">115 us</td>
<td style="text-align: left;">80 us</td>
<td style="text-align: left;">4404</td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>analogRead(INT_TEMPERATURE)</code></td>
<td style="text-align: left;">102 us</td>
<td style="text-align: left;">71 us</td>
<td style="text-align: left;">3913</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> voltage <span class="op">=</span> analogRead<span class="op">(</span>VDD_IO<span class="op">);</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> temp <span class="op">=</span> analogRead<span class="op">(</span>INT_TEMPERATURE<span class="op">);</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;GPIO VDD measures </span><span class="sc">%u</span><span class="st"> millivolts &quot;</span><span class="op">,</span> voltage<span class="op">);</span> </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;and the chip temperature reads &quot;</span><span class="op">);</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">%u</span><span class="st">.</span><span class="sc">%03u</span><span class="st"> degrees Celcius</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> temp<span class="op">/</span><span class="dv">1000</span><span class="op">,</span> temp<span class="op">%</span><span class="dv">1000</span><span class="op">);</span> </span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>        </span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">    GPIO VDD measures 3083 millivolts and the chip temperature reads 23.112 degrees Celcius</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span>            </span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Parameter Values:</strong></p>
<h5 id="channel">Channel</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(uint8_t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">VDD_BUF (0)</td>
<td style="text-align: left;">Voltage at VDD BUF (VBUF) pin in
millivolts.</td>
</tr>
<tr class="even">
<td style="text-align: left;">VDD_GLOB (1)</td>
<td style="text-align: left;">Voltage at VDD GLOB pin in
millivolts.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VDD_DIG (2)</td>
<td style="text-align: left;">Voltage at VDD DIG pin in millivolts.</td>
</tr>
<tr class="even">
<td style="text-align: left;">VDD_IO (3)</td>
<td style="text-align: left;">Voltage at VDD IO pin in millivolts.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VDD_NTC_P (4)</td>
<td style="text-align: left;">Voltage at positive pin of external NTC,
in millivolts.</td>
</tr>
<tr class="even">
<td style="text-align: left;">VDD_NTC_N (5)</td>
<td style="text-align: left;">Voltage at the negative pin of external
NTC, in millivolts.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EXT_TEMPERATURE (6)</td>
<td style="text-align: left;">Temperature of external NTC, as a raw
calibrated ADC reading (10 bit).</td>
</tr>
<tr class="even">
<td style="text-align: left;">INT_TEMPERATURE (7)</td>
<td style="text-align: left;">Temperature of internal NTC, in
millidegrees.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CALIBRATE_ADC (8)</td>
<td style="text-align: left;">To perform recalibration of the internal
ADC.</td>
</tr>
<tr class="even">
<td style="text-align: left;">EXT_TEMPERATURE_RAW (0X16)</td>
<td style="text-align: left;">Temperature of external NTC as a raw and
uncalibrated ADC value.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">INT_TEMPERATURE_RAW (0X17)</td>
<td style="text-align: left;">Temperature of internal NTC as a raw and
uncalibrated ADC value.</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>analogRead()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x020401</td>
<td style="text-align: left;">E_GPIO_ANALOG_READ__NOT_READY: The ADC is
not yet ready.</td>
</tr>
</tbody>
</table>
<h2 id="timing-functions">Timing functions</h2>
<p>This family of functions has seven functions defined.</p>
<h3 id="millis"><code>millis()</code></h3>
<p><strong>Prototype</strong>: <code>uint32_t millis( void )</code></p>
<p><strong>Description</strong>: Returns the number of milliseconds
passed since the module board began running the current program. This
number will overflow (go back to zero) after approximately 50 days.</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>millis()</code></td>
<td style="text-align: left;">11 us</td>
<td style="text-align: left;">8 us</td>
<td style="text-align: left;">416</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> previous_time <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> current_time <span class="op">=</span> millis<span class="op">();</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Loop interval = </span><span class="sc">%u</span><span class="st"> ms</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> current_time <span class="op">-</span> previous_time<span class="op">);</span> </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        previous_time <span class="op">=</span> current_time<span class="op">;</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="micros"><code>micros()</code></h3>
<p><strong>Prototype</strong>: <code>uint32_t micros( void )</code></p>
<p><strong>Description</strong>: Returns the number of microseconds
since the module board began running the current program. This number
will overflow (go back to zero) after approximately one hour and 11
minutes.</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>micros()</code></td>
<td style="text-align: left;">7 us</td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">256</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> t <span class="op">=</span> micros<span class="op">();</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Microseconds since boot = </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> t<span class="op">);</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="micros64"><code>micros64()</code></h3>
<p><strong>Prototype</strong>:
<code>uint64_t* micros64( void )</code></p>
<p><strong>Description</strong>: Returns a pointer to the number of
microseconds since the module board began running the current program.
This number will overflow (go back to zero) after approximately 0.6
million years.</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>micros64()</code></td>
<td style="text-align: left;">7 us</td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">273</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint64_t</span> t <span class="op">=</span> <span class="op">*</span>micros64<span class="op">();</span> <span class="co">// use * notation to get the value</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Microseconds since boot = &quot;</span><span class="op">);</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>printInt64<span class="op">(</span>t<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot; (0x</span><span class="sc">%08X%08X</span><span class="st">)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)(</span>t <span class="op">&gt;&gt;</span><span class="dv">32</span><span class="op">),</span> <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)(</span>t<span class="op">));</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Microseconds since boot = 2474 (0x00000000000009AA)</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Microseconds since boot = 1009028 (0x00000000000F6584)</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Microseconds since boot = 2015582 (0x00000000001EC15E)</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Microseconds since boot = 3022137 (0x00000000002E1D39)</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="ticks"><code>ticks()</code></h3>
<p><strong>Prototype</strong>: <code>uint64_t* ticks( void )</code></p>
<p><strong>Description</strong>: Returns pointer to current UWB
timestamp, which runs at 128*499.2 ticks per microsecond. This number
will overflow (go back to zero) after approximately 9 years.</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>ticks()</code></td>
<td style="text-align: left;">12 us</td>
<td style="text-align: left;">8 us</td>
<td style="text-align: left;">456</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span> <span class="co">// Start UWB circuitry</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint64_t</span> us <span class="op">=</span> <span class="op">*</span>micros64<span class="op">();</span> <span class="co">// microseconds since boot</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint64_t</span> tcks <span class="op">=</span> <span class="op">*</span>ticks<span class="op">();</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint64_t</span> ticks2us <span class="op">=</span> TICKS_TO_MICROS<span class="op">(</span>tcks<span class="op">);</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>printInt64<span class="op">(</span>tcks<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot; ticks since boot. This equals </span><span class="sc">%u</span><span class="st">us (CPU) &quot;</span><span class="op">,</span> <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>us<span class="op">);</span> </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;/ </span><span class="sc">%u</span><span class="st">us (UWB).</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>ticks2us<span class="op">);</span> </span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co">    319848448 ticks since boot. This equals 5005us (CPU) / 5005us (UWB).</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co">    64600838656 ticks since boot. This equals 1011005us (CPU) / 1011005us (UWB).</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co">    128945725440 ticks since boot. This equals 2018006us (CPU) / 2018005us (UWB).</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="co">    193290606592 ticks since boot. This equals 3025005us (CPU) / 3025005us (UWB).</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="delaytimems"><code>delay(timeMs)</code></h3>
<p><strong>Prototype</strong>:
<code>void delay( uint32_t timeMs )</code></p>
<p><strong>Description</strong>: Pauses / blocks the program for the
amount of time (in milliseconds) specified by the parameter
<code>timeMs</code>. During this period, the UWB subsystem could
continue operation or could decide to temporarily transition into a
sleep mode to save power, depending on the current tasks. Certain things
do go on while the <code>delay()</code> function is being executed,
because the delay function does not disable interrupts.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">timeMs</td>
<td style="text-align: left;">(uint32_t) Amount of time in
milliseconds.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>delay(0)</code></td>
<td style="text-align: left;">8 us</td>
<td style="text-align: left;">6 us</td>
<td style="text-align: left;">315</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> t1 <span class="op">=</span> millis<span class="op">();</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">1234</span><span class="op">);</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> t2 <span class="op">=</span> millis<span class="op">();</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;t2-t1 = </span><span class="sc">%u</span><span class="st"> milliseconds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> t2<span class="op">-</span>t1<span class="op">);</span> </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co">    t2-t1 = 1235 milliseconds</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co">    t2-t1 = 1235 milliseconds</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co">    t2-t1 = 1235 milliseconds</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="delaymicrosecondstime"><code>delayMicroseconds(time)</code></h3>
<p><strong>Prototype</strong>:
<code>void delayMicroseconds( uint32_t time )</code></p>
<p><strong>Description</strong>: Pauses / blocks the program for the
amount of time (in microseconds) specified by the parameter. See
<code>delay()</code>.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">time</td>
<td style="text-align: left;">(uint32_t) Amount of time in
microseconds.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>delayMicroseconds(0)</code></td>
<td style="text-align: left;">8 us</td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">303</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> t1 <span class="op">=</span> micros<span class="op">();</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>        delayMicroseconds<span class="op">(</span><span class="dv">1200</span><span class="op">);</span> <span class="co">// halt process for 1200 us</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> t2 <span class="op">=</span> micros<span class="op">();</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> t3 <span class="op">=</span> micros<span class="op">();</span> <span class="co">// t3-t2 = execution time of micros()</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Halted for </span><span class="sc">%u</span><span class="st"> us.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">(</span>t2 <span class="op">-</span> t1<span class="op">)</span> <span class="op">-</span> <span class="op">(</span>t3 <span class="op">-</span> t2<span class="op">));</span> </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Halted for 1200 us.</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Halted for 1205 us.</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Halted for 1202 us.</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Halted for 1202 us.</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3
id="getxtalppbadc_ext_temperature"><code>getXtalPpb(adc_ext_temperature)</code></h3>
<p><strong>Prototype</strong>:
<code>int32_t getXtalPpb( int32_t adc_ext_temperature )</code></p>
<p><strong>Description</strong>: Returns frequency deviation of the
crystal corresponding to the measured temperature.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">adc_ext_temperature</td>
<td style="text-align: left;">(int32_t) . For supported values, <a
href="#adc-ext-temperature">see below</a>.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td
style="text-align: left;"><code>getXtalPpb(FROM_TEMPERATURE)</code></td>
<td style="text-align: left;">309 us</td>
<td style="text-align: left;">215 us</td>
<td style="text-align: left;">11870</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span>                                </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>        SetConfigurationCmd cfg<span class="op">;</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        SetConfiguration_setDefaults<span class="op">(&amp;</span>cfg<span class="op">);</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        cfg<span class="op">.</span>ppb <span class="op">=</span> getXtalPpb<span class="op">(</span>FROM_TEMPERATURE<span class="op">);</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>        ASSERT<span class="op">(</span>UWB<span class="op">.</span>setConfiguration<span class="op">(&amp;</span>cfg<span class="op">),</span> SUCCESS<span class="op">);</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>        ASSERT<span class="op">(</span>UWB<span class="op">.</span>begin<span class="op">(),</span> SUCCESS<span class="op">);</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Parameter Values:</strong></p>
<h5 id="adc_ext_temperature">Adc_ext_temperature</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(int32_t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FROM_TEMPERATURE (0)</td>
<td style="text-align: left;">Will use the calibrated ADC reading of the
XTAL NTC. Identical to <code>analogRead(EXT_TEMPERATURE)</code>.</td>
</tr>
</tbody>
</table>
<h2 id="timer-class">Timer class</h2>
<p>This family of functions has twelve functions defined.</p>
<h3
id="timer.setwatchdogtimeoutms"><code>Timer.setWatchdog(timeoutMs)</code></h3>
<p><strong>Prototype</strong>:
<code>void Timer.setWatchdog( uint32_t timeoutMs )</code></p>
<p><strong>Description</strong>: Refresh the watchdog timeout per passed
milliseconds. This function has to be periodically called before the
timeout time expires, in order to prevent the watchdog from triggering a
reset. However, at startup the watchdog is disabled per default.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">timeoutMs</td>
<td style="text-align: left;">(uint32_t) Timeout count in milliseconds.
Timeout count of 0 is equivalent to disabling the watchdog. The watchdog
is driven with an input clock of 1.2MHz independent of the configured
system clock. A watchdog tick is 1ms. Units are [ms].</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Started</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>setWatchdog<span class="op">(</span> <span class="dv">1000</span> <span class="op">);</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="timer.kickwatchdog"><code>Timer.kickWatchdog()</code></h3>
<p><strong>Prototype</strong>:
<code>void Timer.kickWatchdog( void )</code></p>
<p><strong>Description</strong>: Set the watchdog counter register back
to the value of <code>Timer.setWatchdog()</code>.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Started</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>setWatchdog<span class="op">(</span> <span class="dv">1000</span> <span class="op">);</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> INPUT_PULLUP<span class="op">);</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>digitalRead<span class="op">(</span>PIN_USER_BUTTON<span class="op">)</span> <span class="op">==</span> LOW<span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Kick Watchdog</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>            Timer<span class="op">.</span>kickWatchdog<span class="op">();</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>            delay<span class="op">(</span><span class="dv">500</span><span class="op">);</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="co">    Kick Watchdog</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Kick Watchdog</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Kick Watchdog</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="co">    Kick Watchdog</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="timer.begin"><code>Timer.begin()</code></h3>
<p><strong>Prototype</strong>: <code>void Timer.begin( void )</code></p>
<p><strong>Description</strong>: Starts the global timer class.</p>
<h3
id="timer.attimems-function"><code>Timer.at(timeMs, function)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal Timer.at( uint32_t timeMs, void (*isr)(void) )</code></p>
<p><strong>Description</strong>: Schedules a function call at the given
time, expressed in milliseconds passed since the module board began
running the current program (refer <code>millis()</code>). In contrast
to the other Timer functions, up to 8 timestamps / functions can be
queued. To empty the queue preemptively, call Timer.end().</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">timeMs</td>
<td style="text-align: left;">(uint32_t) Amount of time in milliseconds.
Units are [ms].</td>
</tr>
<tr class="even">
<td style="text-align: left;">function</td>
<td style="text-align: left;">(void (*isr)(void)) The function that is
called at the specified time. This function must take no parameters and
return nothing. In case your isr function only need to call
<code>triggerEvent()</code>, instead of passing the function pointer cou
can simply pass a 16-bit value and <code>triggerEvent()</code> will
called internally with the 16-bit value as <code>eventId</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Timer.at(3000, loop)</code></td>
<td style="text-align: left;">13 us</td>
<td style="text-align: left;">9 us</td>
<td style="text-align: left;">512</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> foo_1<span class="op">()</span> <span class="op">{</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> t <span class="op">=</span> millis<span class="op">();</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;1: Arrived here at t = </span><span class="sc">%u</span><span class="st"> ms.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> t<span class="op">);</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> foo_2<span class="op">()</span> <span class="op">{</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> t <span class="op">=</span> millis<span class="op">();</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;2: Arrived here at t = </span><span class="sc">%u</span><span class="st"> ms.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> t<span class="op">);</span> </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>at<span class="op">(</span><span class="dv">1500</span><span class="op">,</span> foo_2<span class="op">);</span> <span class="co">// schedule foo_2() at 1500ms</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>at<span class="op">(</span><span class="dv">200</span><span class="op">,</span> foo_1<span class="op">);</span>  <span class="co">// schedule foo_1() at 200ms</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co">    1: Arrived here at t = 200 ms.</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="co">    2: Arrived here at t = 1502 ms.</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Error Codes: </strong> In case of an error, <code>at()</code>
will set <a href="#errno"><code>errno</code></a> to one of the following
error codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x040401</td>
<td style="text-align: left;">E_TIMER_AT__QUEUE_FULL: Cannot schedule
another event because the queue is maxed out.</td>
</tr>
</tbody>
</table>
<h3
id="timer.atmicrosecondstimeus-function"><code>Timer.atMicroseconds(timeUs, function)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal Timer.atMicroseconds( uint64_t timeUs, void (*isr)(void) )</code></p>
<p><strong>Description</strong>: Similar to <code>Timer.at()</code>
except the given time is in microseconds instead of milliseconds.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">timeUs</td>
<td style="text-align: left;">(uint64_t) Amount of time in milliseconds.
Units are [us].</td>
</tr>
<tr class="even">
<td style="text-align: left;">function</td>
<td style="text-align: left;">(void (*isr)(void)) The function that is
called at the specified time. This function must take no parameters and
return nothing. In case your isr function only need to call
<code>triggerEvent()</code>, instead of passing the function pointer cou
can simply pass a 16-bit value and <code>triggerEvent()</code> will
called internally with the 16-bit value as <code>eventId</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td
style="text-align: left;"><code>Timer.atMicroseconds(3000000, loop)</code></td>
<td style="text-align: left;">13 us</td>
<td style="text-align: left;">9 us</td>
<td style="text-align: left;">502</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> foo<span class="op">()</span> <span class="op">{</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;foo() called at t=</span><span class="sc">%u</span><span class="st"> us</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> micros<span class="op">());</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>atMicroseconds<span class="op">(</span><span class="dv">1000000</span><span class="op">,</span> foo<span class="op">);</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Error Codes: </strong> In case of an error,
<code>atMicroseconds()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x040501</td>
<td style="text-align: left;">E_TIMER_AT_MICROSECONDS__OVERFLOW: Cannot
schedule because the period between now (see micros()) and the provided
time is too long.</td>
</tr>
</tbody>
</table>
<h3
id="timer.attickstimeticks-function"><code>Timer.atTicks(timeTicks, function)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal Timer.atTicks( uint64_t timeTicks, void (*isr)(void) )</code></p>
<p><strong>Description</strong>: Similar to <code>Timer.at()</code>
except the given time is in ticks instead of milliseconds. However, the
granularity is bound to the XTAL (typically 55.2 MHz). Only a single
event (including Timer.atMicroseconds()) can be scheduled at a time.
.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">timeTicks</td>
<td style="text-align: left;">(uint64_t) Amount of time in ticks
(running at 63.8976 GHz, thus 15.65 picoseconds per tick). For supported
values, <a href="#time-ticks">see below</a>.</td>
</tr>
<tr class="even">
<td style="text-align: left;">function</td>
<td style="text-align: left;">(void (*isr)(void)) The function that is
called at the specified time. This function must take no parameters and
return nothing. In case your isr function only need to call
<code>triggerEvent()</code>, instead of passing the function pointer cou
can simply pass a 16-bit value and <code>triggerEvent()</code> will
called internally with the 16-bit value as <code>eventId</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td
style="text-align: left;"><code>Timer.atTicks(63897600000, loop)</code></td>
<td style="text-align: left;">13 us</td>
<td style="text-align: left;">9 us</td>
<td style="text-align: left;">493</td>
</tr>
</tbody>
</table>
<p><strong>Parameter Values:</strong></p>
<h5 id="time-ticks">Time ticks</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(uint64_t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ASAP ((NULL))</td>
<td style="text-align: left;">To indicate that an action must be
executed as soon as possible.</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>atTicks()</code> will set <a href="#errno"><code>errno</code></a>
to one of the following error codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x040601</td>
<td style="text-align: left;">E_TIMER_AT_TICKS__OVERFLOW: Cannot
schedule because the period between now (see micros()) and the provided
time is too long.</td>
</tr>
</tbody>
</table>
<h3 id="timer.atcount"><code>Timer.atCount()</code></h3>
<p><strong>Prototype</strong>:
<code>uint8_t Timer.atCount( void )</code></p>
<p><strong>Description</strong>: To read the number of currently
scheduled using the Timer.at… function(s).</p>
<h3
id="timer.everytimems-function"><code>Timer.every(timeMs, function)</code></h3>
<p><strong>Prototype</strong>:
<code>void Timer.every( uint32_t timeMs, void (*isr)(void) )</code></p>
<p><strong>Description</strong>: Schedules a call to the given function
at a given constant interval, expressed in milliseconds.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">timeMs</td>
<td style="text-align: left;">(uint32_t) Amount of time in milliseconds.
Units are [ms].</td>
</tr>
<tr class="even">
<td style="text-align: left;">function</td>
<td style="text-align: left;">(void (*isr)(void)) The function that is
called at the specified time. This function must take no parameters and
return nothing. In case your isr function only need to call
<code>triggerEvent()</code>, instead of passing the function pointer cou
can simply pass a 16-bit value and <code>triggerEvent()</code> will
called internally with the 16-bit value as <code>eventId</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Timer.every(3000, loop)</code></td>
<td style="text-align: left;">9 us</td>
<td style="text-align: left;">6 us</td>
<td style="text-align: left;">342</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> foo<span class="op">()</span> <span class="op">{</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;foo() called at t=</span><span class="sc">%u</span><span class="st"> us</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> micros<span class="op">());</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>every<span class="op">(</span><span class="dv">1000</span><span class="op">,</span> foo<span class="op">);</span> <span class="co">// call foo() once every second, </span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>                           <span class="co">// independent of loop()</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3
id="timer.everymicrosecondstimeus-function"><code>Timer.everyMicroseconds(timeUs, function)</code></h3>
<p><strong>Prototype</strong>:
<code>void Timer.everyMicroseconds( uint32_t timeUs, void (*isr)(void) )</code></p>
<p><strong>Description</strong>: Similar to <code>Timer.every()</code>
except the given time is in microseconds instead of milliseconds.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">timeUs</td>
<td style="text-align: left;">(uint32_t) Amount of time in milliseconds.
Units are [us].</td>
</tr>
<tr class="even">
<td style="text-align: left;">function</td>
<td style="text-align: left;">(void (*isr)(void)) The function that is
called at the specified time. This function must take no parameters and
return nothing. In case your isr function only need to call
<code>triggerEvent()</code>, instead of passing the function pointer cou
can simply pass a 16-bit value and <code>triggerEvent()</code> will
called internally with the 16-bit value as <code>eventId</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td
style="text-align: left;"><code>Timer.everyMicroseconds(3000000, loop)</code></td>
<td style="text-align: left;">9 us</td>
<td style="text-align: left;">6 us</td>
<td style="text-align: left;">329</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> foo<span class="op">()</span> <span class="op">{</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;foo() called at t=</span><span class="sc">%u</span><span class="st"> us</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> micros<span class="op">());</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>everyMicroseconds<span class="op">(</span><span class="dv">100500</span><span class="op">,</span> foo<span class="op">);</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="timer.end"><code>Timer.end()</code></h3>
<p><strong>Prototype</strong>: <code>void Timer.end( void )</code></p>
<p><strong>Description</strong>: Stops and resets the global timer
class.</p>
<h3 id="timer.clearoneshots"><code>Timer.clearOneShots()</code></h3>
<p><strong>Prototype</strong>:
<code>void Timer.clearOneShots( void )</code></p>
<p><strong>Description</strong>: Clears the currently scheduled using
the Timer.at… function(s).</p>
<h3 id="timer.clearperiodic"><code>Timer.clearPeriodic()</code></h3>
<p><strong>Prototype</strong>:
<code>void Timer.clearPeriodic( void )</code></p>
<p><strong>Description</strong>: Clears the currently scheduled using
the Timer.every… function(s).</p>
<h2 id="interrupts">Interrupts</h2>
<p>Interrupts can be used to make the application event-driven which can
help to solve timing problems. There can be many sources for interrupts
varying from simply asserting a GPIO pin to error conditions within the
processor that require immediate attention. This family of functions has
eight functions defined.</p>
<h3
id="attachinterruptsource-function-mode"><code>attachInterrupt(source, function, mode)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal attachInterrupt( uint16_t source, void (*isr)(void), int8_t mode )</code></p>
<p><strong>Description</strong>: Sets a function to be called when a
specific interrupt occurs. This can be a GPIO pin that changes state,
for example to detect a button press, or the reception of bytes over
UART.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">source</td>
<td style="text-align: left;">(uint16_t) Specifies the type of
interrupt, which could be for example a specific GPIO pin, or the
reception on a UWB message. For example,
<code>attachInterrupt( PIN_USER_BUTTON), isr, RISING)</code> calls isr()
every time pin 10 goes from low to high. Note that for a given source
only one isr() can be attached. Thus, it is not possible to have both
FALLING and RISING interrupts for the same GPIO pin. For supported
values, <a href="#source">see below</a>.</td>
</tr>
<tr class="even">
<td style="text-align: left;">function</td>
<td style="text-align: left;">(void (*isr)(void)) The ISR (the interrupt
service routine) is called when the interrupt occurs. This function must
take no parameters and return nothing. In case your isr function only
need to call <code>triggerEvent()</code>, instead of passing the
function pointer cou can simply pass a 16-bit value and
<code>triggerEvent()</code> will called internally with the 16-bit value
as <code>eventId</code>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mode</td>
<td style="text-align: left;">(int8_t) Defines when the interrupt should
be triggered. For example on the RISING edge of a GPIO pin. For
supported values, <a href="#mode">see below</a>.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table style="width:100%;">
<colgroup>
<col style="width: 14%" />
<col style="width: 28%" />
<col style="width: 28%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td
style="text-align: left;"><code>attachInterrupt(PIN_USER_BUTTON, loop, FALLING)</code></td>
<td style="text-align: left;">6 us</td>
<td style="text-align: left;">4 us</td>
<td style="text-align: left;">227</td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>attachInterrupt(UWB_RX_SFD, loop, 0)</code></td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">91</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> foo<span class="op">()</span> <span class="op">{</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;button pressed!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> INPUT_PULLUP<span class="op">);</span> <span class="co">// setup button pin</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> foo<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><img src="figures/attachInterrupts_uwb.png" /> <em>Example of some
UWB interrupts to detect the reception of a message before
<code>onRxUpdate()</code> is called.</em></p>
<p><strong>Parameter Values:</strong></p>
<h5 id="source">Source</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(uint16_t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ERROR_INTERRUPT (0x1000)</td>
<td style="text-align: left;">The provided callback function will be
executed every time an error occurred during the execution of a non-UWB
API function.</td>
</tr>
<tr class="even">
<td style="text-align: left;">GPIO_INTERRUPT (0x2000)</td>
<td style="text-align: left;">The ISR will be executed every time a GPIO
interrupt is generated, irrespective of the pin number. To add a pin to
the pool of interrupt pins, use
<code>attachInterrupt( PIN_USER_BUTTON, pin_isr, mode)</code>. If in the
latter case pin_isr is set to NULL, only the isr() of GPIO_INTERRUPT is
executed. If not NULL, pin_isr() is executed before the isr() of
<code>GPIO_INTERRUPT</code>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SERIAL_INTERRUPT (0x3000)</td>
<td style="text-align: left;">The ISR will be executed every time
byte(s) areavailable from the Serial port.</td>
</tr>
<tr class="even">
<td style="text-align: left;">SPI_TRANSFER_COMPLETE (0x4000)</td>
<td style="text-align: left;">The ISR will be executed every time a SPI
transfer was successful. That is, the predetermined number of bytes have
been transfered (see length parameter). Note that when this interrupt is
active, the <code>SPI.transfer()</code> will not be a blocking call
anymore.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SPI_TRANSFER_ASSERT (0x5000)</td>
<td style="text-align: left;">The ISR will be executed every time a SPI
transfer is started because the host asserted the Slave Select line
(only applicable when in SPI slave mode).</td>
</tr>
<tr class="even">
<td style="text-align: left;">SPI_TRANSFER_DEASSERT (0x6000)</td>
<td style="text-align: left;">The ISR will be executed every time a SPI
transfer is stopped because the host deasserted the Slave Select line
(only applicable when in SPI slave mode).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UWB_TX_DONE (0x7000)</td>
<td style="text-align: left;">Triggers when TX has completed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">UWB_RX_SFD (0x8000)</td>
<td style="text-align: left;">Triggers when the Start of Frame Delimiter
(SFD) is received. THE SFD is positioned between the SYNC (preamble)
part and the PHR part. The SFD part is used for time-stamping which is
useful for ranging.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UWB_RX_PHR (0x9000)</td>
<td style="text-align: left;">Triggers when the PHR is received. PHR
stands for Physical Layer Header. It provides information to the
receiver about the transmitted payload and other useful physical layer
information.</td>
</tr>
<tr class="even">
<td style="text-align: left;">UWB_RX_START (0xA000)</td>
<td style="text-align: left;">Triggers when RX has started.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UWB_RX_EOF (0xB000)</td>
<td style="text-align: left;">Triggers when the End of Frame (EOF) is
detected.</td>
</tr>
<tr class="even">
<td style="text-align: left;">UWB_VBUF_LOW (0xC000)</td>
<td style="text-align: left;">Triggers when the the voltage of VBUF is
too low. Adjust current limiter or add capacitance to resolve this.</td>
</tr>
</tbody>
</table>
<h5 id="mode-1">Mode</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(int8_t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FALLING (0x00)</td>
<td style="text-align: left;">Trigger when the pin goes from high to
low. This applies to GPIO interrupts only.</td>
</tr>
<tr class="even">
<td style="text-align: left;">RISING (0x01)</td>
<td style="text-align: left;">Trigger when the pin goes from low to
high. This applies to GPIO interrupts only.</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>attachInterrupt()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x050101</td>
<td style="text-align: left;">E_INTERRUPT_ATTACH_INTERRUPT__WRONG_NUM:
The specified type of interrupt is not valid.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x050102</td>
<td style="text-align: left;">E_INTERRUPT_ATTACH_INTERRUPT__GPIO_OUTPUT:
The specified GPIO pin is configured as an output. Use
<code>pinMode()</code> to make it an input first.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x050103</td>
<td style="text-align: left;">E_INTERRUPT_ATTACH_INTERRUPT__TOO_MANY:
Too many interrupts are scheduled. Consider removing unused ones via
<code>detachInterrupt()</code>.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x050104</td>
<td style="text-align: left;">E_INTERRUPT_ATTACH_INTERRUPT__WRONG_MODE:
The specified mode is not supported.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x050105</td>
<td style="text-align: left;">E_INTERRUPT_ATTACH_INTERRUPT__PIN_CLAIMED:
The specified GPIO pin has an ISR attached.</td>
</tr>
</tbody>
</table>
<h3 id="detachinterruptsource"><code>detachInterrupt(source)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal detachInterrupt( uint16_t source )</code></p>
<p><strong>Description</strong>: Turn the given interrupt off.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">source</td>
<td style="text-align: left;">(uint16_t) Specifies the type of
interrupt, which could be for example a specific GPIO pin, or the
reception of a UWB message.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td
style="text-align: left;"><code>detachInterrupt(PIN_USER_BUTTON)</code></td>
<td style="text-align: left;">3 us</td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">114</td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>detachInterrupt(UWB_RX_SFD)</code></td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">80</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> foo_1<span class="op">()</span> <span class="op">{</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;1: button pressed!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> foo_2<span class="op">()</span> <span class="op">{</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;2: button pressed!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> INPUT_PULLUP<span class="op">);</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> foo_1<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">4000</span><span class="op">);</span> <span class="co">// after 4 seconds, we change button functionality:</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>        detachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">);</span> <span class="co">// detach first</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> foo_2<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Error Codes: </strong> In case of an error,
<code>detachInterrupt()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x050201</td>
<td style="text-align: left;">E_INTERRUPT_DETACH_INTERRUPT__WRONG_NUM:
The specified type of interrupt is not valid.</td>
</tr>
</tbody>
</table>
<h3 id="nointerrupts"><code>noInterrupts()</code></h3>
<p><strong>Prototype</strong>:
<code>uint32_t noInterrupts( void )</code></p>
<p><strong>Description</strong>: Disables interrupts until interrupts()
is called. Interrupts can slightly disrupt the timing of code and may be
disabled for particularly critical sections of code.</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>noInterrupts()</code></td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">38</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb51"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> foo<span class="op">()</span> <span class="op">{</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;button pressed at </span><span class="sc">%u</span><span class="st"> ms!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> millis<span class="op">());</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> INPUT_PULLUP<span class="op">);</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> foo<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">4000</span><span class="op">);</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> counter <span class="op">=</span> noInterrupts<span class="op">();</span> <span class="co">// disable interrupts around t=4000 </span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* enter critical region. */</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">4000</span><span class="op">);</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        counter <span class="op">=</span> interrupts<span class="op">(</span>counter<span class="op">);</span> <span class="co">// re-enable interrupts around t=8000</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Error Codes: </strong> In case of an error,
<code>noInterrupts()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x050301</td>
<td style="text-align: left;">E_INTERRUPT_NO_INTERRUPTS__WRONG_ORDER:
The counter value passed to noInterrupts was not the latest one.</td>
</tr>
</tbody>
</table>
<h3 id="interruptscounter"><code>interrupts(counter)</code></h3>
<p><strong>Prototype</strong>:
<code>uint32_t interrupts( uint32_t counter )</code></p>
<p><strong>Description</strong>: Re-enables interrupts after they’ve
been disabled by noInterrupts(). Interrupts are enabled by default.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">counter</td>
<td style="text-align: left;">(uint32_t) Value that was last returned by
noInterrupts().</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>interrupts(counter)</code></td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">63</td>
</tr>
</tbody>
</table>
<h3 id="waitforeventtimems"><code>waitForEvent(timeMs)</code></h3>
<p><strong>Prototype</strong>:
<code>uint32_t waitForEvent( uint32_t timeMs )</code></p>
<p><strong>Description</strong>: Blocks the user application (like
<code>delay()</code>) until <code>triggerEvent()</code> is called from
an interrupt service routine. This can be used for example to wait in
your <code>loop()</code> until an interrupt GPIO pin is triggered, or a
UWB packet is received.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">timeMs</td>
<td style="text-align: left;">(uint32_t) As a safety mechanism, when
<code>triggerEvent()</code> is not called within the given timeout, the
function returns 0x0 to indicate a timeout has occurred. A timeout value
of 0 means that no timeout is used. Units are [ms].</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb52"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define BUTTON_PRESS_EVENT </span><span class="bn">0x1000</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> foo<span class="op">()</span> <span class="op">{</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>        triggerEvent<span class="op">(</span>BUTTON_PRESS_EVENT<span class="op">);</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> INPUT_PULLUP<span class="op">);</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> foo<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> eventMask <span class="op">=</span> waitForEvent<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>eventMask <span class="op">==</span> EVENT_TIMEOUT<span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;No event happened within the specified time</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">((</span>eventMask <span class="op">&amp;</span> BUTTON_PRESS_EVENT<span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;A button is called&quot;</span><span class="op">);</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot; and we are in a derived service routine!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> </span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb53"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define BUTTON_PRESS_EVENT </span><span class="bn">0x1000</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define TIMER_EVENT </span><span class="bn">0x100</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>        pinMode<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> INPUT_PULLUP<span class="op">);</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>PIN_USER_BUTTON<span class="op">,</span> BUTTON_PRESS_EVENT<span class="op">,</span> FALLING<span class="op">);</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>        Timer<span class="op">.</span>every<span class="op">(</span><span class="dv">2000</span><span class="op">,</span> TIMER_EVENT<span class="op">);</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> eventMask <span class="op">=</span> waitForEvent<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>eventMask <span class="op">==</span> EVENT_TIMEOUT<span class="op">)</span> <span class="op">{</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;No event happened within the specified time</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">((</span>eventMask <span class="op">&amp;</span> BUTTON_PRESS_EVENT<span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;A button is called&quot;</span><span class="op">);</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot; and we are in a derived service routine!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> </span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">((</span>eventMask <span class="op">&amp;</span> TIMER_EVENT<span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Timer event fired&quot;</span><span class="op">);</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot; and we are in a derived service routine!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> </span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="triggereventeventmask"><code>triggerEvent(eventMask)</code></h3>
<p><strong>Prototype</strong>:
<code>void triggerEvent( uint32_t eventMask )</code></p>
<p><strong>Description</strong>: See waitForEvents().</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">eventMask</td>
<td style="text-align: left;">(uint32_t) The provided event mask will be
returned by the pending <code>waitForEvent()</code> function. In case
<code>triggerEvent()</code> is called multiple times before
<code>waitForEvent()</code>, the resulting <code>eventMask</code>
returned by <code>waitForEvent()</code> will be the or-ed total. The
value(s) should be between 0x1 and 0xFFFFFFFF. The default value is
‘0x0’. For supported values, <a href="#event-mask">see below</a>.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>triggerEvent(1)</code></td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">39</td>
</tr>
</tbody>
</table>
<p><strong>Parameter Values:</strong></p>
<h5 id="event-mask">Event mask</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(uint32_t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">RX_DONE (0x01)</td>
<td style="text-align: left;">Arbitrarily chosen value to code the
completion of a RX event.</td>
</tr>
<tr class="even">
<td style="text-align: left;">TX_DONE (0x02)</td>
<td style="text-align: left;">Arbitrarily chosen value to code the
completion of a TX event.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EVENT_TIMEOUT (0x0)</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h3 id="cleareventeventmask"><code>clearEvent(eventMask)</code></h3>
<p><strong>Prototype</strong>:
<code>void clearEvent( uint32_t eventMask )</code></p>
<p><strong>Description</strong>: Clear pending event bits before a
waitForEvent() is called. This way you make sure waitForEvent() will not
immediately return when events were triggered prior.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">eventMask</td>
<td style="text-align: left;">(uint32_t) The value(s) should be between
0x1 and 0xFFFFFFFF. The default value is ‘0x0’.</td>
</tr>
</tbody>
</table>
<h3 id="readevents"><code>readEvents()</code></h3>
<p><strong>Prototype</strong>:
<code>uint32_t readEvents( void )</code></p>
<p><strong>Description</strong>: Reads the current event mask value.</p>
<h2 id="uart">UART</h2>
<p>This family of functions has twelve functions defined.</p>
<h3 id="serial.beginbaudrate"><code>Serial.begin(baudRate)</code></h3>
<p><strong>Prototype</strong>:
<code>void Serial.begin( uint32_t baudRate )</code></p>
<p><strong>Description</strong>: Sets the data rate in bits per second
(baud) for serial data transmission and configures the designated RX/TX
pins.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">baudRate</td>
<td style="text-align: left;">(uint32_t) Specify the rate at which bits
are transmitted. Standard baud rates include 110, 300, 600, 1200, 2400,
4800, 9600, 14400, 19200, 38400, 57600, 115200, 128000 and 256000 bits
per second. The default value is ‘115200’.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Serial.begin(115200)</code></td>
<td style="text-align: left;">22 us</td>
<td style="text-align: left;">16 us</td>
<td style="text-align: left;">862</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb54"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span> <span class="co">// start XTAL for stability</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">2000000</span><span class="op">);</span> <span class="co">// some non-standard</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>                          <span class="co">// high speed rate works as well</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="serial.available"><code>Serial.available()</code></h3>
<p><strong>Prototype</strong>:
<code>uint16_t Serial.available( void )</code></p>
<p><strong>Description</strong>: Get the number of bytes (characters)
available for reading from the serial port. This is data that’s already
arrived and stored in the serial receive buffer (which can hold up to
256 bytes).</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Serial.available()</code></td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">53</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb55"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>Serial<span class="op">.</span>available<span class="op">())</span> <span class="op">{</span> <span class="co">// send string via terminal</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">uint8_t</span> len <span class="op">=</span> Serial<span class="op">.</span>available<span class="op">();</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">uint8_t</span> buffer<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>readBytes<span class="op">(</span>buffer<span class="op">,</span> len<span class="op">);</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>            buffer<span class="op">[</span>len<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// terminate string for print</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Received (</span><span class="sc">%u</span><span class="st">): </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> len<span class="op">,</span> buffer<span class="op">);</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>hexDump<span class="op">(</span>buffer<span class="op">,</span> len<span class="op">,</span> <span class="dv">16</span><span class="op">);</span> <span class="co">// show as hex</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="serial.read"><code>Serial.read()</code></h3>
<p><strong>Prototype</strong>:
<code>int16_t Serial.read( void )</code></p>
<p><strong>Description</strong>: Returns the first byte of incoming
serial data available (or -1 if no data is available).</p>
<h3
id="serial.readbytesbuffer-length"><code>Serial.readBytes(buffer, length)</code></h3>
<p><strong>Prototype</strong>:
<code>uint16_t Serial.readBytes( uint8_t* buffer, uint16_t length )</code></p>
<p><strong>Description</strong>: Reads characters from the serial port
into a buffer. The function terminates if the determined length has been
read or a timeout has occurred. <code>Serial.readBytes()</code> returns
the number of characters placed in the buffer. A 0 means no valid data
was found.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">buffer</td>
<td style="text-align: left;">(uint8_t*) The buffer to store the bytes
in.</td>
</tr>
<tr class="even">
<td style="text-align: left;">length</td>
<td style="text-align: left;">(uint16_t) The number of bytes to read.
The value(s) should be between 1 and 256.</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb56"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> buffer<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint16_t</span> len <span class="op">=</span> Serial<span class="op">.</span>readBytes<span class="op">(</span>buffer<span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>len <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>            buffer<span class="op">[</span>len<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Received (</span><span class="sc">%u</span><span class="st">): </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> len<span class="op">,</span> buffer<span class="op">);</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>hexDump<span class="op">(</span>buffer<span class="op">,</span> len<span class="op">,</span> <span class="dv">16</span><span class="op">);</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb57"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define RECEIVED_SERIAL_EVENT </span><span class="op">(</span><span class="bn">0x100</span><span class="op">)</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>SERIAL_INTERRUPT<span class="op">,</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span>RECEIVED_SERIAL_EVENT<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">uint32_t</span> events <span class="op">=</span> readEvents<span class="op">();</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>events <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>                events <span class="op">==</span> waitForEvent<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>events <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;nothing</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>events <span class="op">&amp;</span> RECEIVED_SERIAL_EVENT<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>                delay<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>                <span class="dt">uint8_t</span> buf<span class="op">[</span><span class="dv">256</span><span class="op">];</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>                <span class="dt">uint16_t</span> len <span class="op">=</span> Serial<span class="op">.</span>available<span class="op">();</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>len <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>                    memset<span class="op">(</span>buf<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">));</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>                    Serial<span class="op">.</span>readBytes<span class="op">(</span>buf<span class="op">,</span> len<span class="op">);</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>                    Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Received (</span><span class="sc">%u</span><span class="st">): </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> len<span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>                    Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;In HEX: [ &quot;</span><span class="op">);</span> </span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>                    Serial<span class="op">.</span>hexDump<span class="op">(</span>buf<span class="op">,</span> len<span class="op">,</span> <span class="dv">32</span><span class="op">);</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>                    Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot; ]</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span> </span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3
id="serial.writebuffer-length"><code>Serial.write(buffer, length)</code></h3>
<p><strong>Prototype</strong>:
<code>int Serial.write( const uint8_t* buffer, uint16_t length )</code></p>
<p><strong>Description</strong>: Writes binary data to the serial
port.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">buffer</td>
<td style="text-align: left;">(const uint8_t*) The buffer containing the
bytes to send.</td>
</tr>
<tr class="even">
<td style="text-align: left;">length</td>
<td style="text-align: left;">(uint16_t) The number of bytes to send.
The value(s) should be between 1 and 256.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Serial.write("2\n", 2)</code></td>
<td style="text-align: left;">174 us</td>
<td style="text-align: left;">121 us</td>
<td style="text-align: left;">6687</td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>Serial.write("1000\n", 5)</code></td>
<td style="text-align: left;">434 us</td>
<td style="text-align: left;">302 us</td>
<td style="text-align: left;">16684</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb58"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> buffer<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="bn">0x73</span><span class="op">,</span> <span class="bn">0x79</span><span class="op">,</span> <span class="bn">0x6E</span><span class="op">,</span> <span class="bn">0x63</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x31</span><span class="op">,</span> <span class="bn">0x32</span><span class="op">};</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>write<span class="op">(</span>buffer<span class="op">,</span> <span class="dv">7</span><span class="op">);</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3
id="serial.settimeouttimems"><code>Serial.setTimeout(timeMs)</code></h3>
<p><strong>Prototype</strong>:
<code>void Serial.setTimeout( uint32_t timeMs )</code></p>
<p><strong>Description</strong>: Sets the maximum milliseconds to wait
for serial data.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">timeMs</td>
<td style="text-align: left;">(uint32_t) Units are [ms]. The default
value is ‘100’.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Serial.setTimeout(2000)</code></td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">47</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb59"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>setTimeout<span class="op">(</span><span class="dv">2000</span><span class="op">);</span> <span class="co">// 2 seconds</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> buffer<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint16_t</span> len <span class="op">=</span> Serial<span class="op">.</span>readBytes<span class="op">(</span>buffer<span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>len <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;received nothing within 2 sec</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;received (in hex):</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>hexDump<span class="op">(</span>buffer<span class="op">,</span> len<span class="op">,</span> <span class="dv">16</span><span class="op">);</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3
id="serial.hexdumpbuffer-length-columns"><code>Serial.hexDump(buffer, length, columns)</code></h3>
<p><strong>Prototype</strong>:
<code>void Serial.hexDump( void* buffer, uint16_t length, uint8_t columns )</code></p>
<p><strong>Description</strong>: Prints the given byte array as a HEX
table.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">buffer</td>
<td style="text-align: left;">(void*) The buffer to print.</td>
</tr>
<tr class="even">
<td style="text-align: left;">length</td>
<td style="text-align: left;">(uint16_t) The number of bytes to
print.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">columns</td>
<td style="text-align: left;">(uint8_t) The number of columns in the
table (typically 16).</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb60"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> values<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>            <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">13</span><span class="op">,</span> <span class="dv">14</span><span class="op">,</span> <span class="dv">15</span><span class="op">};</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>hexDump<span class="op">((</span><span class="dt">uint8_t</span><span class="op">*)</span>values<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>values<span class="op">),</span> <span class="dv">16</span><span class="op">);</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co">      00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="serial.print"><code>Serial.print()</code></h3>
<p><strong>Prototype</strong>:
<code>int Serial.print( const char*, ...  )</code></p>
<p><strong>Description</strong>: Prints data to the serial port as
human-readable ASCII text. The C library function
<code>int printf(const char *format, ...)</code> is used here to send
formatted output to stdout. Note that output stays in the UART FIFO
buffer until a newline character is encountered. With a newline
character all the bytes in the UART buffer are sent on the wire (UART
flush). Also a buffer overflow will trigger a UART flush.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">(const char*, …) The string can optionally
contain embedded format tags that are replaced by the values specified
in subsequent additional arguments and formatted as requested. Format
tags prototype is
<code>%[flags][width][.precision][length]specifier</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Serial.print("2\n")</code></td>
<td style="text-align: left;">175 us</td>
<td style="text-align: left;">122 us</td>
<td style="text-align: left;">6719</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Serial.print("1000\n")</code></td>
<td style="text-align: left;">439 us</td>
<td style="text-align: left;">305 us</td>
<td style="text-align: left;">16859</td>
</tr>
<tr class="odd">
<td
style="text-align: left;"><code>Serial.print("%u\n", 1e3)</code></td>
<td style="text-align: left;">702 us</td>
<td style="text-align: left;">488 us</td>
<td style="text-align: left;">26945</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb61"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;FILE: </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="ot">__FILE__</span><span class="op">);</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;CONFIG_LOOP_INTERVAL: </span><span class="sc">%u</span><span class="st"> ms</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> CONFIG_LOOP_INTERVAL<span class="op">);</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="serial.sprint"><code>Serial.sprint(, )</code></h3>
<p><strong>Prototype</strong>:
<code>int Serial.sprint( char *str , const char*, ...  )</code></p>
<p><strong>Description</strong>: The C library function
<code>int sprintf(char *str, const char *format, ...)</code> is used
here. The C Library sprintf() function allows you to create strings with
specified formats, similar to printf(), but instead of printing to the
standard output, it stores the resulting string in a character array
provided by the user.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">(char *str) A pointer to an array of
characters where the resulting string will be stored.</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">(const char*, …) The string can optionally
contain embedded format tags that are replaced by the values specified
in subsequent additional arguments and formatted as requested. Format
tags prototype is
<code>%[flags][width][.precision][length]specifier</code>.</td>
</tr>
</tbody>
</table>
<h3
id="serial.printint64value-buffer"><code>Serial.printInt64(value, buffer)</code></h3>
<p><strong>Prototype</strong>:
<code>int Serial.printInt64( int64_t value, const uint8_t* buffer )</code></p>
<p><strong>Description</strong>: Prints 64-bit value with decimal
notation. Note that the regular <code>Serial.print()</code> has an upper
limit of 32-bit values, hence this function. .</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">value</td>
<td style="text-align: left;">(int64_t) Number to be printed, for
example a 64-bit timestamp value.</td>
</tr>
<tr class="even">
<td style="text-align: left;">buffer</td>
<td style="text-align: left;">(const uint8_t*) Pointer to where the
output should be written to. In case of 0 (NULL), the output will be
sent over UART directly.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Serial.printInt64(1, 0)</code></td>
<td style="text-align: left;">86 us</td>
<td style="text-align: left;">60 us</td>
<td style="text-align: left;">3301</td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>Serial.printInt64(1e3, 0)</code></td>
<td style="text-align: left;">347 us</td>
<td style="text-align: left;">242 us</td>
<td style="text-align: left;">13342</td>
</tr>
<tr class="odd">
<td
style="text-align: left;"><code>Serial.printInt64(3e17, 0)</code></td>
<td style="text-align: left;">1576 us</td>
<td style="text-align: left;">1096 us</td>
<td style="text-align: left;">60509</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb62"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int64_t</span> v <span class="op">=</span> <span class="op">-</span><span class="fl">3e17</span><span class="op">;</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>printInt64<span class="op">(</span>v<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// output: </span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// -300000000000000000</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="serial.printerror"><code>Serial.printError()</code></h3>
<p><strong>Prototype</strong>:
<code>void Serial.printError( void )</code></p>
<p><strong>Description</strong>: Prints the latest errno change, or
ASSERT violation.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb63"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>ERROR_INTERRUPT<span class="op">,</span> Serial<span class="op">.</span>printError<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Trigger &quot;E_GPIO_DIGITAL_WRITE__PIN_IS_INPUT&quot; (0x20202):</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>        digitalWrite<span class="op">(</span>D0<span class="op">,</span> LOW<span class="op">);</span> </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>        ASSERT<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span> <span class="co">// Prints violation of test 5==1</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>        ASSERT<span class="op">(</span>UWB<span class="op">.</span>startTx<span class="op">(</span><span class="dv">0</span><span class="op">),</span> SUCCESS<span class="op">);</span> <span class="co">// startTx will fail without begin()</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Error code 0x20202</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Returned 0x5 at line 9</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Returned 0x73 at line 11</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span>                    </span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="serial.end"><code>Serial.end()</code></h3>
<p><strong>Prototype</strong>: <code>void Serial.end( void )</code></p>
<p><strong>Description</strong>: Disables serial communication, allowing
the RX and TX pins to be used for general input and output. To re-enable
serial communication, call <code>Serial.begin()</code>. Note that when
<code>Serial.end()</code> is called right after
<code>Serial.print(str)</code>, there is a chance that str is printed
only partially.</p>
<h2 id="serial-peripheral-interface-spi">Serial Peripheral Interface
(SPI)</h2>
<p>This family of functions has eight functions defined.</p>
<h3 id="spi.begin"><code>SPI.begin()</code></h3>
<p><strong>Prototype</strong>: <code>void SPI.begin( void )</code></p>
<p><strong>Description</strong>: Initializes the SCK, MISO, and MOSI
pins.</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>SPI.begin()</code></td>
<td style="text-align: left;">7 us</td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">278</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb64"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>        SPI<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3
id="spi.begintransactionsettings"><code>SPI.beginTransaction(settings)</code></h3>
<p><strong>Prototype</strong>:
<code>void SPI.beginTransaction( uint32_t settings )</code></p>
<p><strong>Description</strong>: Initializes the SPI bus using the
defined SPISettings. An SPISettings object is used to configure the SPI
port for your SPI device. All three parameters are combined to a single
SPISettings object using
<code>SPISettings( speedMaximum, bitOrder, dataMode)</code>. For
example,
<code>SPI.beginTransaction( SPISettings(500000, MSBFIRST, SPI_MODE0))</code>.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">settings</td>
<td style="text-align: left;">(SPISettings) Use macro
<code>SPISettings(clock, bitOrder, dataMode)</code>. For supported
values, <a href="#settings">see below</a>.</td>
</tr>
</tbody>
</table>
<p><strong>Parameter Values:</strong></p>
<h5 id="settings">Settings</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(SPISettings)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LSBFIRST (0x00)</td>
<td style="text-align: left;">BitOrder: Sets the order of the bits
shifted out of and into the SPI bus to least-significant bit first
(default).</td>
</tr>
<tr class="even">
<td style="text-align: left;">MSBFIRST (0x01)</td>
<td style="text-align: left;">BitOrder: Sets the order of the bits
shifted out of and into the SPI bus to the most-significant bit
first.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SPI_CPOL (0x08)</td>
<td style="text-align: left;">DataMode: CPOL determines the polarity of
the clock. If CPOL is enabled, the clock’s leading edge is a falling
edge, and the trailing edge is a rising edge.</td>
</tr>
<tr class="even">
<td style="text-align: left;">SPI_CPHA (0x04)</td>
<td style="text-align: left;">DataMode: CPHA determines the timing
(i.e., phase) of the data bits relative to the clock pulses. When CPHA
is enabled, data is sampled on the falling edge and shifted out on the
rising edge.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SPI_MODE0 (0x00)</td>
<td style="text-align: left;">DataMode: Clock leading edge is rising
(CPOL=0) and data are sampled on the leading (first, rising) clock edge
(CPHA=0).</td>
</tr>
<tr class="even">
<td style="text-align: left;">SPI_MODE1 (0x04)</td>
<td style="text-align: left;">DataMode: Clock leading edge is rising
(CPOL=0) and data are sampled on the trailing (second, falling) clock
edge (CPHA=1).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SPI_MODE2 (0x08)</td>
<td style="text-align: left;">DataMode: Clock leading edge is falling
(CPOL=1) and data are sampled on the leading (first, falling) clock edge
(CPHA=0).</td>
</tr>
<tr class="even">
<td style="text-align: left;">SPI_MODE3 (0x0C)</td>
<td style="text-align: left;">DataMode: Clock leading edge is falling
(CPOL=1) and data are sampled on the trailing (second, rising) clock
edge (CPHA=1).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SPI_CS1 (0x40)</td>
<td style="text-align: left;">DataMode: Use CS1 pin for slave
select.</td>
</tr>
<tr class="even">
<td style="text-align: left;">SPI_CS2 (0x80)</td>
<td style="text-align: left;">DataMode: Use CS2 pin for slave
select.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SPI_SLAVE_MODE (0)</td>
<td style="text-align: left;">Clock: Sets clock speed to 0 to use SPI in
slave mode (in which the clock speed is determined by the master
device).</td>
</tr>
<tr class="even">
<td style="text-align: left;">SS_ACTIVE_LOW (0x00)</td>
<td style="text-align: left;">DataMode: Chip Select (or Slave select)
polarity selection. Active low is the default.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SS_ACTIVE_HIGH (0x10)</td>
<td style="text-align: left;">DataMode: Chip Select (or Slave select)
polarity selection.</td>
</tr>
<tr class="even">
<td style="text-align: left;">SS_HOLD_ACTIVE (0x20)</td>
<td style="text-align: left;">DataMode: By default, the Chip Select gets
deactivated when a <code>SPI.transfer()</code> is finished. However, by
setting this flag, the Chip Select is kept in the active state until
<code>SPI.endTransaction()</code> is called.</td>
</tr>
</tbody>
</table>
<h3
id="spi.readrxbuffer-rxlength"><code>SPI.read(rxBuffer, rxLength)</code></h3>
<p><strong>Prototype</strong>:
<code>void SPI.read( uint8_t* rxBuffer, uint16_t rxLength )</code></p>
<p><strong>Description</strong>: Start receive.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">rxBuffer</td>
<td style="text-align: left;">(uint8_t*) Pointer to buffer for incoming
data.</td>
</tr>
<tr class="even">
<td style="text-align: left;">rxLength</td>
<td style="text-align: left;">(uint16_t) Length of data to be received
(number of bytes).</td>
</tr>
</tbody>
</table>
<h3
id="spi.writetxbuffer-txlength"><code>SPI.write(txBuffer, txLength)</code></h3>
<p><strong>Prototype</strong>:
<code>void SPI.write( uint8_t* txBuffer, uint16_t txLength )</code></p>
<p><strong>Description</strong>: Start receive.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">txBuffer</td>
<td style="text-align: left;">(uint8_t*) Pointer to buffer for outgoing
data.</td>
</tr>
<tr class="even">
<td style="text-align: left;">txLength</td>
<td style="text-align: left;">(uint16_t) Length of data to be written
(number of bytes).</td>
</tr>
</tbody>
</table>
<h3
id="spi.transfertxbuffer-rxbuffer-length"><code>SPI.transfer(txBuffer, rxBuffer, length)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal SPI.transfer( uint8_t* txBuffer, uint8_t* rxBuffer, uint16_t length )</code></p>
<p><strong>Description</strong>: Start simultaneous send and
receive.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">txBuffer</td>
<td style="text-align: left;">(uint8_t*) Pointer to buffer for outgoing
data.</td>
</tr>
<tr class="even">
<td style="text-align: left;">rxBuffer</td>
<td style="text-align: left;">(uint8_t*) Pointer to buffer for incoming
data.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">length</td>
<td style="text-align: left;">(uint16_t) Length of data to be
transmitted/received (number of bytes).</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb65"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">uint8_t</span> tx_buf1<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x02</span> <span class="op">};</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">uint8_t</span> tx_buf2<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x04</span> <span class="op">};</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span> <span class="co">// demonstrating MASTER mode</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>        SPI<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// send 0x01 0x02 and 0x03, 0x04 as SPI master,</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// while keeping slave select pin asserted inbetween</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// the transfers</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>        SPI<span class="op">.</span>beginTransaction <span class="op">(</span> </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>          SPISettings<span class="op">(</span><span class="dv">2000000</span><span class="op">,</span> MSBFIRST<span class="op">,</span> SPI_MODE0 <span class="op">|</span> SPI_CS1 <span class="op">|</span> SS_HOLD_ACTIVE<span class="op">)</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span>             </span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// we are not interested in rx, hence NULL:</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>        SPI<span class="op">.</span>transfer<span class="op">(</span>tx_buf1<span class="op">,</span> NULL<span class="op">,</span> <span class="dv">2</span><span class="op">);</span> </span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>        SPI<span class="op">.</span>transfer<span class="op">(</span>tx_buf2<span class="op">,</span> NULL<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>        SPI<span class="op">.</span>endTransaction<span class="op">();</span> <span class="co">// will deassert slave select pin</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>            <span class="co">// which happens not automatically with SPI.transfer </span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>            <span class="co">// here because SS_HOLD_ACTIVE was set</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb66"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">uint8_t</span> tx_buffer<span class="op">[</span><span class="dv">1024</span><span class="op">];</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">uint8_t</span> rx_buffer<span class="op">[</span><span class="dv">1024</span><span class="op">];</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span> <span class="co">// demonstrating SLAVE mode</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>        SPI<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>        SPI<span class="op">.</span>beginTransaction <span class="op">(</span> </span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>            SPISettings<span class="op">(</span>SPI_SLAVE_MODE<span class="op">,</span> MSBFIRST<span class="op">,</span> SPI_MODE0 <span class="op">|</span> SPI_CS1<span class="op">)</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>        tx_buffer<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="bn">0xAB</span><span class="op">;</span> <span class="co">// we transmit one byte for fun</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>        SPI<span class="op">.</span>transfer<span class="op">(</span>tx_buffer<span class="op">,</span> rx_buffer<span class="op">,</span> <span class="dv">4</span><span class="op">);</span> <span class="co">// blocking until</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>                                        <span class="co">// we have received 4 bytes</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Received: &quot;</span><span class="op">);</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>hexDump<span class="op">(</span>rx_buffer<span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">16</span><span class="op">);</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb67"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> transferDone<span class="op">()</span> <span class="op">{</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We get here when a SPI.transfer is done: either the </span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// provided number of bytes are sent/received or, when </span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// in slave mode, the slave select pin is deasserted.</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>        SPI<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// if we attach a SPI_TRANSFER_COMPLETE interrupt </span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// service routine, SPI.transfer() is not blocking anymore</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>SPI_TRANSFER_COMPLETE<span class="op">,</span> transferDone<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Error Codes: </strong> In case of an error,
<code>transfer()</code> will set <a href="#errno"><code>errno</code></a>
to one of the following error codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x070501</td>
<td style="text-align: left;">E_SPI_TRANSFER__BUSY: Indicates that the a
SPI transaction is still being performed.</td>
</tr>
</tbody>
</table>
<h3 id="spi.count"><code>SPI.count()</code></h3>
<p><strong>Prototype</strong>:
<code>uint16_t SPI.count( void )</code></p>
<p><strong>Description</strong>: Returns the number of bytes
received/transmitted during to the current
<code>SPI.transfer</code>.</p>
<h3 id="spi.endtransaction"><code>SPI.endTransaction()</code></h3>
<p><strong>Prototype</strong>:
<code>void SPI.endTransaction( void )</code></p>
<p><strong>Description</strong>: <code>SPI.beginTransaction()</code>
behaves like a locking mechanism to gain the exclusive use of the SPI
bus, and therefore requires <code>SPI.endTransaction()</code> to release
the bus for others to access it.</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>SPI.endTransaction()</code></td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">67</td>
</tr>
</tbody>
</table>
<h3 id="spi.end"><code>SPI.end()</code></h3>
<p><strong>Prototype</strong>: <code>void SPI.end( void )</code></p>
<p><strong>Description</strong>: Stop using the SPI bus as a master.</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>SPI.end()</code></td>
<td style="text-align: left;">3 us</td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">117</td>
</tr>
</tbody>
</table>
<h2 id="two-wire-interface-i2c">Two Wire Interface (I2C)</h2>
<p>This family of functions has four functions defined.</p>
<h3
id="i2c.beginsdapinmask-sclpinmask"><code>I2C.begin(sdaPinMask, sclPinMask)</code></h3>
<p><strong>Prototype</strong>:
<code>void I2C.begin( uint16_t sdaPinMask, uint16_t sclPinMask )</code></p>
<p><strong>Description</strong>: Initializes the module as a (software-)
I2C master.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sdaPinMask</td>
<td style="text-align: left;">(uint16_t) The pin identifier mask for the
SDA (data) pin. Because this is a software-I2C implementation, any free
GPIO pin can be used.</td>
</tr>
<tr class="even">
<td style="text-align: left;">sclPinMask</td>
<td style="text-align: left;">(uint16_t) The pin identifier mask for the
SCL (clock) pin. Because this is a software-I2C implementation, any free
GPIO pin can be used.</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb68"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// initialize I2C with </span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//    D2 = SDA </span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">//    D1 = SCL </span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>begin<span class="op">(</span>D2<span class="op">,</span> D1<span class="op">);</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="i2c.write..."><code>I2C.write(...)</code></h3>
<p><strong>Prototype</strong>:
<code>int8_t I2C.write( uint8_t address, uint8_t* data, uint16_t length, bool stop )</code></p>
<p><strong>Description</strong>: Write the provided byte array to the
target peripheral device.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">address</td>
<td style="text-align: left;">(uint8_t) The 7-bit address of the
slave.</td>
</tr>
<tr class="even">
<td style="text-align: left;">data</td>
<td style="text-align: left;">(uint8_t*) Byte to send.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">length</td>
<td style="text-align: left;">(uint16_t) Size of the data array. Units
are [bytes].</td>
</tr>
<tr class="even">
<td style="text-align: left;">stop</td>
<td style="text-align: left;">(bool) Indicates whether to send a stop
bit at the end of the write (typically set to TRUE).</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb69"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;I2C Scanner</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>begin<span class="op">(</span>D2<span class="op">,</span> D1<span class="op">);</span> <span class="co">// select your SDA and CLK pins      </span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">uint8_t</span> address <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> address <span class="op">&lt;</span> <span class="dv">127</span><span class="op">;</span> address<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>I2C<span class="op">.</span>write<span class="op">(</span>address<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">true</span><span class="op">)</span> <span class="op">==</span> WRITE_RESULT_ACK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Found device at 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> address<span class="op">);</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Finished</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb70"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define AMG88_ADDR </span><span class="bn">0x69</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>begin<span class="op">(</span>D2<span class="op">,</span> D1<span class="op">);</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> buffer<span class="op">[</span><span class="dv">128</span><span class="op">];</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>        buffer<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="bn">0x80</span><span class="op">;</span> <span class="co">// temperature register start</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> result <span class="op">=</span> I2C<span class="op">.</span>write<span class="op">(</span>AMG88_ADDR<span class="op">,</span> buffer<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// check if success:</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>result<span class="op">)</span> <span class="op">{</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> WRITE_RESULT_ACK<span class="op">:</span> </span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;WRITE ACK</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> WRITE_RESULT_NACK<span class="op">:</span> </span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;WRITE NACK</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> WRITE_RESULT_TIMEOUT<span class="op">:</span> </span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;WRITE TIMEOUT</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="i2c.read..."><code>I2C.read(...)</code></h3>
<p><strong>Prototype</strong>:
<code>int16_t I2C.read( uint8_t address, uint8_t* data, uint16_t length, bool stop )</code></p>
<p><strong>Description</strong>: To request bytes from a peripheral
device.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">address</td>
<td style="text-align: left;">(uint8_t) The 7-bit address of the
slave.</td>
</tr>
<tr class="even">
<td style="text-align: left;">data</td>
<td style="text-align: left;">(uint8_t*) Buffer to store the received
bytes.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">length</td>
<td style="text-align: left;">(uint16_t) How many bytes we want to
receive.</td>
</tr>
<tr class="even">
<td style="text-align: left;">stop</td>
<td style="text-align: left;">(bool) True will send a stop message after
the request, releasing the bus. False will continually send a restart
after the request, keeping the connection active.</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb71"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define AMG88_ADDR </span><span class="bn">0x69</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>begin<span class="op">(</span>D2<span class="op">,</span> D1<span class="op">);</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> data<span class="op">[</span><span class="dv">128</span><span class="op">];</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>        data<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="bn">0x80</span><span class="op">;</span> <span class="co">// temperature register start</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>write<span class="op">(</span>AMG88_ADDR<span class="op">,</span> data<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// now request/read the values from that register:</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> result <span class="op">=</span> I2C<span class="op">.</span>read<span class="op">(</span>AMG88_ADDR<span class="op">,</span> data<span class="op">,</span> <span class="dv">128</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// check if success:</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>result<span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> READ_RESULT_ACK<span class="op">:</span> </span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;WRITE ACK</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> READ_RESULT_NACK<span class="op">:</span> </span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;WRITE NACK</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> READ_RESULT_TIMEOUT<span class="op">:</span> </span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>                Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;WRITE TIMEOUT</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb72"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define BMP280_ADDR </span><span class="op">(</span><span class="bn">0x76</span><span class="op">)</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// #define BMP280_ADDR (0x77)</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Registers available on the sensor:</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_DIG_T1 <span class="op">=</span> <span class="bn">0x88</span><span class="op">,</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_DIG_T2 <span class="op">=</span> <span class="bn">0x8A</span><span class="op">,</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_DIG_T3 <span class="op">=</span> <span class="bn">0x8C</span><span class="op">,</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_DIG_P1 <span class="op">=</span> <span class="bn">0x8E</span><span class="op">,</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_DIG_P2 <span class="op">=</span> <span class="bn">0x90</span><span class="op">,</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_DIG_P3 <span class="op">=</span> <span class="bn">0x92</span><span class="op">,</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_DIG_P4 <span class="op">=</span> <span class="bn">0x94</span><span class="op">,</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_DIG_P5 <span class="op">=</span> <span class="bn">0x96</span><span class="op">,</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_DIG_P6 <span class="op">=</span> <span class="bn">0x98</span><span class="op">,</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_DIG_P7 <span class="op">=</span> <span class="bn">0x9A</span><span class="op">,</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_DIG_P8 <span class="op">=</span> <span class="bn">0x9C</span><span class="op">,</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_DIG_P9 <span class="op">=</span> <span class="bn">0x9E</span><span class="op">,</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_CHIPID <span class="op">=</span> <span class="bn">0xD0</span><span class="op">,</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_VERSION <span class="op">=</span> <span class="bn">0xD1</span><span class="op">,</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_SOFTRESET <span class="op">=</span> <span class="bn">0xE0</span><span class="op">,</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_CAL26 <span class="op">=</span> <span class="bn">0xE1</span><span class="op">,</span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_STATUS <span class="op">=</span> <span class="bn">0xF3</span><span class="op">,</span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_CONTROL <span class="op">=</span> <span class="bn">0xF4</span><span class="op">,</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_CONFIG <span class="op">=</span> <span class="bn">0xF5</span><span class="op">,</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_PRESSUREDATA <span class="op">=</span> <span class="bn">0xF7</span><span class="op">,</span></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>    BMP280_REGISTER_TEMPDATA <span class="op">=</span> <span class="bn">0xFA</span><span class="op">,</span></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*!</span></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a><span class="co">    *  Struct to hold calibration data.</span></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint16_t</span> dig_T1<span class="op">;</span> <span class="co">// dig_T1 cal register</span></span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int16_t</span> dig_T2<span class="op">;</span>  <span class="co">//  dig_T2 cal register</span></span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int16_t</span> dig_T3<span class="op">;</span>  <span class="co">// dig_T3 cal register</span></span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint16_t</span> dig_P1<span class="op">;</span> <span class="co">// dig_P1 cal register</span></span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int16_t</span> dig_P2<span class="op">;</span>  <span class="co">// dig_P2 cal register</span></span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int16_t</span> dig_P3<span class="op">;</span>  <span class="co">// dig_P3 cal register</span></span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int16_t</span> dig_P4<span class="op">;</span>  <span class="co">// dig_P4 cal register</span></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int16_t</span> dig_P5<span class="op">;</span>  <span class="co">// dig_P5 cal register</span></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int16_t</span> dig_P6<span class="op">;</span>  <span class="co">// dig_P6 cal register</span></span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int16_t</span> dig_P7<span class="op">;</span>  <span class="co">// dig_P7 cal register</span></span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int16_t</span> dig_P8<span class="op">;</span>  <span class="co">// dig_P8 cal register</span></span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int16_t</span> dig_P9<span class="op">;</span>  <span class="co">// dig_P9 cal register</span></span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> bmp280_calib_data<span class="op">;</span></span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> bmp280_calib_data calib<span class="op">;</span></span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>begin<span class="op">(</span>D2<span class="op">,</span> D1<span class="op">);</span></span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>        <span class="co">// read calibration data</span></span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> buffer<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> BMP280_REGISTER_DIG_T1<span class="op">,</span> <span class="dv">0</span> <span class="op">};</span></span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>write<span class="op">(</span>BMP280_ADDR<span class="op">,</span> buffer<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>read<span class="op">(</span>BMP280_ADDR<span class="op">,</span> <span class="op">(</span><span class="dt">uint8_t</span><span class="op">*)&amp;</span>calib<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>calib<span class="op">),</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">// set sampling</span></span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a>        buffer<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> BMP280_REGISTER_CONFIG<span class="op">;</span></span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> mode <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> tempSampling <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> pressSampling <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> filter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> duration <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-72"><a href="#cb72-72" aria-hidden="true" tabindex="-1"></a>        buffer<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span>duration <span class="op">&lt;&lt;</span> <span class="dv">5</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span>filter <span class="op">&lt;&lt;</span> <span class="dv">2</span><span class="op">)</span> <span class="op">|</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb72-73"><a href="#cb72-73" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>write<span class="op">(</span>BMP280_ADDR<span class="op">,</span> buffer<span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb72-74"><a href="#cb72-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-75"><a href="#cb72-75" aria-hidden="true" tabindex="-1"></a>        buffer<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> BMP280_REGISTER_CONTROL<span class="op">;</span></span>
<span id="cb72-76"><a href="#cb72-76" aria-hidden="true" tabindex="-1"></a>        buffer<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span>tempSampling <span class="op">&lt;&lt;</span> <span class="dv">5</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span>pressSampling <span class="op">&lt;&lt;</span> <span class="dv">2</span><span class="op">)</span> <span class="op">|</span> mode<span class="op">;</span></span>
<span id="cb72-77"><a href="#cb72-77" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>write<span class="op">(</span>BMP280_ADDR<span class="op">,</span> buffer<span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb72-78"><a href="#cb72-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-79"><a href="#cb72-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb72-80"><a href="#cb72-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-81"><a href="#cb72-81" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int32_t</span> correctTemperature<span class="op">(</span><span class="dt">int32_t</span> adc_T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb72-82"><a href="#cb72-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">((</span></span>
<span id="cb72-83"><a href="#cb72-83" aria-hidden="true" tabindex="-1"></a>            <span class="op">(((((</span>adc_T <span class="op">&gt;&gt;</span><span class="dv">7</span><span class="op">)</span> <span class="op">-</span> <span class="op">((</span><span class="dt">int32_t</span><span class="op">)</span>calib<span class="op">.</span>dig_T1 <span class="op">&lt;&lt;</span> <span class="dv">1</span><span class="op">)))</span></span>
<span id="cb72-84"><a href="#cb72-84" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span> <span class="op">((</span><span class="dt">int32_t</span><span class="op">)</span>calib<span class="op">.</span>dig_T2<span class="op">))</span> <span class="op">&gt;&gt;</span><span class="dv">11</span><span class="op">)</span> <span class="op">+</span>  </span>
<span id="cb72-85"><a href="#cb72-85" aria-hidden="true" tabindex="-1"></a>            <span class="op">((((((</span>adc_T <span class="op">&gt;&gt;</span><span class="dv">8</span><span class="op">)</span> <span class="op">-</span> <span class="op">((</span><span class="dt">int32_t</span><span class="op">)</span>calib<span class="op">.</span>dig_T1<span class="op">))</span> <span class="op">*</span> </span>
<span id="cb72-86"><a href="#cb72-86" aria-hidden="true" tabindex="-1"></a>                <span class="op">((</span>adc_T <span class="op">&gt;&gt;</span><span class="dv">8</span><span class="op">)</span> <span class="op">-</span> <span class="op">((</span><span class="dt">int32_t</span><span class="op">)</span>calib<span class="op">.</span>dig_T1<span class="op">)))</span> <span class="op">&gt;&gt;</span><span class="dv">12</span><span class="op">)</span> <span class="op">*</span>  </span>
<span id="cb72-87"><a href="#cb72-87" aria-hidden="true" tabindex="-1"></a>                <span class="op">((</span><span class="dt">int32_t</span><span class="op">)</span>calib<span class="op">.</span>dig_T3<span class="op">))</span> <span class="op">&gt;&gt;</span><span class="dv">14</span><span class="op">)</span></span>
<span id="cb72-88"><a href="#cb72-88" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span> <span class="op">*</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">128</span><span class="op">)</span> <span class="op">&gt;&gt;</span><span class="dv">8</span><span class="op">;</span></span>
<span id="cb72-89"><a href="#cb72-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb72-90"><a href="#cb72-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-91"><a href="#cb72-91" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb72-92"><a href="#cb72-92" aria-hidden="true" tabindex="-1"></a>        <span class="co">// read temp</span></span>
<span id="cb72-93"><a href="#cb72-93" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> buffer<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> BMP280_REGISTER_TEMPDATA<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span> <span class="op">};</span></span>
<span id="cb72-94"><a href="#cb72-94" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> adc_T <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb72-95"><a href="#cb72-95" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>write<span class="op">(</span>BMP280_ADDR<span class="op">,</span> buffer<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb72-96"><a href="#cb72-96" aria-hidden="true" tabindex="-1"></a>        I2C<span class="op">.</span>read<span class="op">(</span>BMP280_ADDR<span class="op">,</span> buffer<span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb72-97"><a href="#cb72-97" aria-hidden="true" tabindex="-1"></a>        adc_T <span class="op">=</span> buffer<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="dv">16</span> <span class="op">|</span> buffer<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="dv">8</span> <span class="op">|</span> buffer<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb72-98"><a href="#cb72-98" aria-hidden="true" tabindex="-1"></a>        <span class="co">// correct reading</span></span>
<span id="cb72-99"><a href="#cb72-99" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int32_t</span> tmp <span class="op">=</span> correctTemperature<span class="op">(</span>adc_T<span class="op">);</span></span>
<span id="cb72-100"><a href="#cb72-100" aria-hidden="true" tabindex="-1"></a>        <span class="co">// print reading</span></span>
<span id="cb72-101"><a href="#cb72-101" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Temp = </span><span class="sc">%i</span><span class="st">.</span><span class="sc">%02u</span><span class="st"> deg</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> tmp<span class="op">/</span><span class="dv">100</span><span class="op">,</span>  tmp<span class="op">%</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb72-102"><a href="#cb72-102" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">500</span><span class="op">);</span></span>
<span id="cb72-103"><a href="#cb72-103" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb72-104"><a href="#cb72-104" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="i2c.end"><code>I2C.end()</code></h3>
<p><strong>Prototype</strong>: <code>void I2C.end( void )</code></p>
<p><strong>Description</strong>: Deinitializs I2C.</p>
<h2 id="numbers">Numbers</h2>
<p>This family of functions has seven functions defined.</p>
<h3 id="getrandommin-max"><code>getRandom(min, max)</code></h3>
<p><strong>Prototype</strong>:
<code>uint32_t getRandom( uint32_t min, uint32_t max )</code></p>
<p><strong>Description</strong>: The random function generates
pseudo-random numbers. Returns a random number between min and
max-1.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">min</td>
<td style="text-align: left;">(uint32_t) Lower bound of the random
value, inclusive (optional).</td>
</tr>
<tr class="even">
<td style="text-align: left;">max</td>
<td style="text-align: left;">(uint32_t) Upper bound of the random
value, exclusive.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>getRandom(0, 0xFFFFFFFF)</code></td>
<td style="text-align: left;">9 us</td>
<td style="text-align: left;">6 us</td>
<td style="text-align: left;">351</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb73"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> value <span class="op">=</span> getRandom<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="bn">0xFFFFFFFF</span><span class="op">);</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Got </span><span class="sc">%u</span><span class="st">&quot;</span><span class="op">,</span> value<span class="op">);</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>        value <span class="op">=</span> getRandom<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="bn">0xFFFFFFFF</span><span class="op">);</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot; and </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> value<span class="op">);</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// we always get the same values</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="randomseedseed"><code>randomSeed(seed)</code></h3>
<p><strong>Prototype</strong>:
<code>void randomSeed( uint32_t seed )</code></p>
<p><strong>Description</strong>: Initializes the pseudo-random number
generator, causing it to start at an arbitrary point in its random
sequence.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">seed</td>
<td style="text-align: left;">(uint32_t) Number to initialize the
pseudo-random sequence. Use <code>randomSeed()</code> to initialize the
random number generator with a fairly random input, such as a timestamp,
<code>analogRead()</code> on an unconnected pin.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>randomSeed(2)</code></td>
<td style="text-align: left;">8 us</td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">291</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb74"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>        randomSeed<span class="op">(</span><span class="dv">2</span><span class="op">);</span> <span class="co">// change position in random sequence</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> values<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>            getRandom<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="bn">0xFFFFFFFF</span><span class="op">),</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>            getRandom<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="bn">0xFFFFFFFF</span><span class="op">),</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Got </span><span class="sc">%u</span><span class="st"> and </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> values<span class="op">[</span><span class="dv">0</span><span class="op">],</span> values<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// still we always get the same values</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="usqrtvalue"><code>usqrt(value)</code></h3>
<p><strong>Prototype</strong>:
<code>uint32_t usqrt( uint32_t value )</code></p>
<p><strong>Description</strong>: Fast integer square root algorithm with
arithmetic rounding of the result. That is, if the real answer would
have a fractional part of 0.5 or greater, the result is rounded up to
the next integer.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">value</td>
<td style="text-align: left;">(uint32_t) Unsigned integer for which to
find the square root.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>usqrt(3)</code></td>
<td style="text-align: left;">7 us</td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">266</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>usqrt(3e3)</code></td>
<td style="text-align: left;">7 us</td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">262</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>usqrt(3e6)</code></td>
<td style="text-align: left;">7 us</td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">262</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>usqrt(3e9)</code></td>
<td style="text-align: left;">7 us</td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">256</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb75"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;usqrt(</span><span class="sc">%u</span><span class="st">) = </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> i<span class="op">,</span> usqrt<span class="op">(</span>i<span class="op">));</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// usqrt(0) = 0</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// usqrt(1) = 1</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// usqrt(2) = 1</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// usqrt(3) = 2</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// usqrt(4) = 2</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// usqrt(5) = 2</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// usqrt(6) = 2</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// usqrt(7) = 3</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// usqrt(8) = 3</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// usqrt(9) = 3</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="getserialnumber"><code>getSerialNumber()</code></h3>
<p><strong>Prototype</strong>:
<code>uint32_t getSerialNumber( void )</code></p>
<p><strong>Description</strong>: Returns unique device serial
number.</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>getSerialNumber()</code></td>
<td style="text-align: left;">7 us</td>
<td style="text-align: left;">5 us</td>
<td style="text-align: left;">275</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb76"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> serialNr <span class="op">=</span> getSerialNumber<span class="op">();</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;My Serial Number = 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> serialNr<span class="op">);</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="co">    My Serial Number = 0xF05BB7C3</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3 id="getcurrentcrc"><code>getCurrentCrc()</code></h3>
<p><strong>Prototype</strong>:
<code>uint32_t getCurrentCrc( void )</code></p>
<p><strong>Description</strong>: Returns the current total crc of the
user application.</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>getCurrentCrc()</code></td>
<td style="text-align: left;">13 us</td>
<td style="text-align: left;">9 us</td>
<td style="text-align: left;">485</td>
</tr>
</tbody>
</table>
<h3 id="getantennadelay"><code>getAntennaDelay()</code></h3>
<p><strong>Prototype</strong>:
<code>uint32_t getAntennaDelay( void )</code></p>
<p><strong>Description</strong>: Returns the stored antenna delay,
measured during production tests.</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>getAntennaDelay()</code></td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">40</td>
</tr>
</tbody>
</table>
<h3 id="gethardwareid"><code>getHardwareId()</code></h3>
<p><strong>Prototype</strong>:
<code>uint32_t getHardwareId( void )</code></p>
<p><strong>Description</strong>: Returns the harware identifier.</p>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>getHardwareId()</code></td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">1 us</td>
<td style="text-align: left;">41</td>
</tr>
</tbody>
</table>
<h2 id="cryptography">Cryptography</h2>
<p>This family of functions has nine functions defined.</p>
<h3 id="crypto.begin"><code>Crypto.begin()</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal Crypto.begin( void )</code></p>
<p><strong>Description</strong>: Powers up the minimal hardware blocks
required to use the cryptographic subsystem.</p>
<p><strong>Error Codes: </strong> In case of an error,
<code>begin()</code> will set <a href="#errno"><code>errno</code></a> to
one of the following error codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x0A0101</td>
<td style="text-align: left;">E_CRYPTO_BEGIN__FAILED: Couldn’t power up
the crypto subsystem. Check the power connections and power source.</td>
</tr>
</tbody>
</table>
<h3
id="crypto.randombytesdestination-size"><code>Crypto.randomBytes(destination, size)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal Crypto.randomBytes( uint8_t *const destination, uint32_t size )</code></p>
<p><strong>Description</strong>: This function fills a memory region
with random data from a high-quality random number generator. The
underlying random number generator is a combination of a PRNG, and an
analog entropy source. Reseeding of the PRNG from the analog entropy
source is handled automatically by the API function.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">destination</td>
<td style="text-align: left;">(uint8_t *const) Points to the start of
the memory region to be filled.</td>
</tr>
<tr class="even">
<td style="text-align: left;">size</td>
<td style="text-align: left;">(uint32_t) Is the size of the memory
region to be filled (in bytes).</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td
style="text-align: left;"><code>Crypto.randomBytes(buf1, 8)</code></td>
<td style="text-align: left;">106 us</td>
<td style="text-align: left;">73 us</td>
<td style="text-align: left;">4057</td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>Crypto.randomBytes(buf2, 64)</code></td>
<td style="text-align: left;">212 us</td>
<td style="text-align: left;">147 us</td>
<td style="text-align: left;">8126</td>
</tr>
<tr class="odd">
<td
style="text-align: left;"><code>Crypto.randomBytes(buf3, 256)</code></td>
<td style="text-align: left;">404 us</td>
<td style="text-align: left;">281 us</td>
<td style="text-align: left;">15517</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb77"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">Started</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>        Crypto<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> values<span class="op">[</span><span class="dv">16</span><span class="op">];</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>        Crypto<span class="op">.</span>randomBytes<span class="op">((</span><span class="dt">uint8_t</span><span class="op">*)</span>values<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>values<span class="op">));</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>hexDump<span class="op">((</span><span class="dt">uint8_t</span><span class="op">*)</span>values<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>values<span class="op">),</span> <span class="dv">16</span><span class="op">);</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="co">      6c cf a6 1b 0b c1 bc f0 13 85 f2 0d 7a 8b 4a 8c</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="co">      c0 46 4c b3 3b 79 d3 b6 64 43 d9 98 45 4e f1 c4</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="co">      7f 8b e9 98 85 59 fc 6b 30 fc 78 53 cf 55 30 52</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a><span class="co">      05 d2 b2 87 1c bb bc 52 f1 97 2c 1f 1d 39 5b 41</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a><span class="co">      ec c8 ef 7e 7e aa 67 14 d2 e3 44 0f dd 25 76 6f</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a><span class="co">      7c 5d 98 17 e4 71 84 b6 c5 64 e3 a8 3a 2a 95 81</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a><span class="co">      f9 e9 82 d3 2b e3 a3 3e ac 08 dd ae 0f d1 4a b9</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a><span class="co">      43 05 76 f7 2c 8b 7d c5 f0 71 9c 28 e7 c5 c4 55</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a><span class="co">    Started</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a><span class="co">      d7 6b 85 35 fe 58 30 7f 38 c5 3a 06 f9 9b cb 79</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a><span class="co">      26 46 fe 00 d5 fd 14 e2 26 d6 0c 9c f0 91 a8 2f</span></span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a><span class="co">      87 39 cf 91 5e 1f e5 f6 d0 d4 08 bf 83 b1 87 27</span></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a><span class="co">      0c 60 a4 47 41 06 2e 7a 02 54 87 df 72 fa 83 8e</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Error Codes: </strong> In case of an error,
<code>randomBytes()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x0A0201</td>
<td style="text-align: left;">E_CRYPTO_RANDOM_BYTES__BUSY: Indicates
that the security subsystem was currently busy performing cryptographic
operations and, therefore, could not process the operation.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0A0202</td>
<td style="text-align: left;">E_CRYPTO_RANDOM_BYTES__GENERAL_FAILURE:
Indicates that the random number generator failed due to an unspecified
internal error condition.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x0A0203</td>
<td style="text-align: left;">E_CRYPTO_RANDOM_BYTES__NOT_BEGAN: The
cryptographic subsystem has not powered up. Call
<code>Crypto.begin()</code> first.</td>
</tr>
</tbody>
</table>
<h3 id="crypto.configcrc..."><code>Crypto.configCrc(...)</code></h3>
<p><strong>Prototype</strong>:
<code>void Crypto.configCrc( uint32_t poly, uint32_t init, uint8_t reflect, uint32_t xorOut )</code></p>
<p><strong>Description</strong>: A cyclic redundancy check (CRC) is an
error-detecting code commonly used in digital networks and storage
devices to detect accidental changes to digital data. There are many
variants, but they all use polynomial division. With the
<code>configCrc()</code> function, the parameters can be set in order to
obtain a specific variant. The order of parameters here matches most
online CRC calculators, for example at www.crccalc.com.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">poly</td>
<td style="text-align: left;">(uint32_t) CRC polynomial value. The
default value is ‘0x04C11DB7’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">init</td>
<td style="text-align: left;">(uint32_t) CRC initial value. The default
value is ‘0xFFFFFFFF’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">reflect</td>
<td style="text-align: left;">(uint8_t) If 0 (false), MSB first is used
as an CRC input data bit order. If 1, bits are swapped around its center
and the output is swapped back. The default value is ‘1’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">xorOut</td>
<td style="text-align: left;">(uint32_t) The value to be XORed with the
final register value. The default value is ‘0xFFFFFFFF’.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table style="width:100%;">
<colgroup>
<col style="width: 14%" />
<col style="width: 28%" />
<col style="width: 28%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td
style="text-align: left;"><code>Crypto.configCrc(0x4C11DB7, 0xFFFFFFFF, true, 0xFFFFFFFF)</code></td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">2 us</td>
<td style="text-align: left;">94</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb78"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>        Crypto<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> data<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> <span class="bn">0x12</span><span class="op">,</span> <span class="bn">0x34</span><span class="op">,</span> <span class="bn">0x56</span><span class="op">,</span> <span class="bn">0x78</span> <span class="op">};</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Input: &quot;</span><span class="op">);</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>hexDump<span class="op">(</span>data<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>data<span class="op">),</span> <span class="dv">16</span><span class="op">);</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// standard CRC-32 (default)</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>        Crypto<span class="op">.</span>configCrc<span class="op">(</span><span class="bn">0x4C11DB7</span><span class="op">,</span> <span class="bn">0xFFFFFFFF</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="bn">0xFFFFFFFF</span><span class="op">);</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;CRC-32 = 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> \</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>            Crypto<span class="op">.</span>calcCrc<span class="op">(</span>data<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>data<span class="op">)));</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// CRC-32/MPEG-2</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>        Crypto<span class="op">.</span>configCrc<span class="op">(</span><span class="bn">0x4C11DB7</span><span class="op">,</span> <span class="bn">0xFFFFFFFF</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="bn">0x00000000</span><span class="op">);</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;MPEG-2 = 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> \</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>            Crypto<span class="op">.</span>calcCrc<span class="op">(</span>data<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>data<span class="op">)));</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// standard CRC-8 (note the bitshift in Poly and result)</span></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>        Crypto<span class="op">.</span>configCrc<span class="op">(</span><span class="bn">0x07</span> <span class="op">&lt;&lt;</span> <span class="dv">24</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">);</span></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;CRC-8 = 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> \</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>            Crypto<span class="op">.</span>calcCrc<span class="op">(</span>data<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>data<span class="op">))</span> <span class="op">&gt;&gt;</span> <span class="dv">24</span><span class="op">);</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">// CRC-8/MAXIM (note the bitshift in Poly but not in result)</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>        Crypto<span class="op">.</span>configCrc<span class="op">(</span><span class="bn">0x31</span> <span class="op">&lt;&lt;</span> <span class="dv">24</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">);</span></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;MAXIM-8 = 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> \</span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>            Crypto<span class="op">.</span>calcCrc<span class="op">(</span>data<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>data<span class="op">)));</span></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// CRC-16/XMODEM (note the bitshift in Poly and result)</span></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>        Crypto<span class="op">.</span>configCrc<span class="op">(</span><span class="bn">0x1021</span> <span class="op">&lt;&lt;</span> <span class="dv">16</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">);</span></span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;XMODEM-16 = 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> \</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a>            Crypto<span class="op">.</span>calcCrc<span class="op">(</span>data<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>data<span class="op">))</span> <span class="op">&gt;&gt;</span> <span class="dv">16</span><span class="op">);</span></span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">// CRC-16/KERMIT (note bitshift in Poly only)</span></span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a>        Crypto<span class="op">.</span>configCrc<span class="op">(</span><span class="bn">0x1021</span> <span class="op">&lt;&lt;</span> <span class="dv">16</span><span class="op">,</span> <span class="bn">0x00000000</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="bn">0x00000000</span><span class="op">);</span></span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;KERMIT-16 = 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> \</span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a>            Crypto<span class="op">.</span>calcCrc<span class="op">(</span>data<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>data<span class="op">)));</span></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<h3
id="crypto.calccrcsource-length"><code>Crypto.calcCrc(source, length)</code></h3>
<p><strong>Prototype</strong>:
<code>uint32_t Crypto.calcCrc( uint8_t* source, uint32_t length )</code></p>
<p><strong>Description</strong>: Calculate a CRC-32 checksum with given
parameters over an application-visible (source) memory region.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">source</td>
<td style="text-align: left;">(uint8_t*) Location of data.</td>
</tr>
<tr class="even">
<td style="text-align: left;">length</td>
<td style="text-align: left;">(uint32_t) Length of the input data in
bytes.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Crypto.calcCrc(data, 8)</code></td>
<td style="text-align: left;">22 us</td>
<td style="text-align: left;">15 us</td>
<td style="text-align: left;">835</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Crypto.calcCrc(data, 64)</code></td>
<td style="text-align: left;">28 us</td>
<td style="text-align: left;">19 us</td>
<td style="text-align: left;">1058</td>
</tr>
<tr class="odd">
<td
style="text-align: left;"><code>Crypto.calcCrc(data, 256)</code></td>
<td style="text-align: left;">46 us</td>
<td style="text-align: left;">32 us</td>
<td style="text-align: left;">1770</td>
</tr>
</tbody>
</table>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb79"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>        Crypto<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint8_t</span> data<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> <span class="bn">0x12</span><span class="op">,</span> <span class="bn">0x34</span><span class="op">,</span> <span class="bn">0x56</span><span class="op">,</span> <span class="bn">0x78</span> <span class="op">};</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// standard CRC-32 (default):</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> crc <span class="op">=</span> Crypto<span class="op">.</span>calcCrc<span class="op">(</span>data<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>data<span class="op">));</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Input: &quot;</span><span class="op">);</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>hexDump<span class="op">(</span>data<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>data<span class="op">),</span> <span class="dv">16</span><span class="op">);</span>                    </span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;CRC-32 = 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> crc<span class="op">);</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Error Codes: </strong> In case of an error,
<code>calcCrc()</code> will set <a href="#errno"><code>errno</code></a>
to one of the following error codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x0A0401</td>
<td style="text-align: left;">E_CRYPTO_CALC_CRC__READ: Indicates that
the CRC calculation was terminated prematurely due to read error on the
input data. This typically indicates that an attempt was made to
calculate a CRC over a flash memory region containing erased or
corrupted flash pages.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0A0402</td>
<td style="text-align: left;">E_CRYPTO_CALC_CRC__BAD_PARAM: Indicates
that an invalid parameter was passed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x0A0403</td>
<td style="text-align: left;">E_CRYPTO_CALC_CRC__UNDEFINED: Invalid
data.</td>
</tr>
</tbody>
</table>
<h3
id="crypto.configencryption..."><code>Crypto.configEncryption(...)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal Crypto.configEncryption( uint8_t* keyValue, uint8_t keyLength, uint16_t algorithm, uint8_t* ivValue, uint8_t ivLength, uint8_t cipherMode, uint8_t* aadValue, uint8_t aadLength )</code></p>
<p><strong>Description</strong>: Provide the parameters of the
encryption operation, including the encryption key, the mode of
operation, and the initialization value (if needed).</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">keyValue</td>
<td style="text-align: left;">(uint8_t*) Raw user-provided key.</td>
</tr>
<tr class="even">
<td style="text-align: left;">keyLength</td>
<td style="text-align: left;">(uint8_t) Length of the provided key value
(number of bytes).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">algorithm</td>
<td style="text-align: left;">(uint16_t) The underlying cryptographic
algorithm. For supported values, <a href="#algorithm">see
below</a>.</td>
</tr>
<tr class="even">
<td style="text-align: left;">ivValue</td>
<td style="text-align: left;">(uint8_t*) Initialization Vector (IV). The
interpretation of this field depends on the mode of operation selected
using the mode field. For cipher modes that do not use an IV (MODE_ECB)
this field must be set as a zero sized input data buffer, with NULL data
pointer. The data is not copied to a buffer, so make sure the pointer
still points to valid data at the time Crypto.encrypt() is
executed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ivLength</td>
<td style="text-align: left;">(uint8_t) Length of the provided IV value
(number of bytes).</td>
</tr>
<tr class="even">
<td style="text-align: left;">cipherMode</td>
<td style="text-align: left;">(uint8_t) Mode of operation for the
cipher. This field selects the mode of operation to be used by cipher.
The interpretation of the iv field depends on the selected mode of
operation. For supported values, <a href="#cipher-mode">see
below</a>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aadValue</td>
<td style="text-align: left;">(uint8_t*) Additional Authenticated Data
(AAD). The interpretation of this field depends on the mode of operation
selected using the mode field. It is only used by authenticated
encryption (AE) cipher modes. This field must be set as a zero size
input data buffer, with NULL data pointer, if an unauthenticated cipher
mode (eg. MODE_ECB, MODE_CTR, MODE_CBC) is used. The data is not copied
to a buffer, so make sure the pointer still points to valid data at the
time Crypto.encrypt() is executed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">aadLength</td>
<td style="text-align: left;">(uint8_t) Length of the provided AAD value
(number of bytes).</td>
</tr>
</tbody>
</table>
<p><strong>Parameter Values:</strong></p>
<h5 id="algorithm">Algorithm</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(uint16_t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AES_128 (0x0101)</td>
<td
style="text-align: left;"><em>CONFIG_ENCRYPTION_ALGORITHM_AES_128</em>.
Algorithm identifier of the AES-128 algorithm.</td>
</tr>
<tr class="even">
<td style="text-align: left;">AES_256 (0x0102)</td>
<td
style="text-align: left;"><em>CONFIG_ENCRYPTION_ALGORITHM_AES_256</em>.
Algorithm identifier of the AES-256 algorithm.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ECC_NIST_P256 (0x0201)</td>
<td
style="text-align: left;"><em>CONFIG_ENCRYPTION_ALGORITHM_ECC_NIST_P256</em>.
Algorithm identifier of the ECC algorithm over NIST P-256 curve.</td>
</tr>
<tr class="even">
<td style="text-align: left;">ECC_NIST_P384 (0x0202)</td>
<td
style="text-align: left;"><em>CONFIG_ENCRYPTION_ALGORITHM_ECC_NIST_P384</em>.
Algorithm identifier of the ECC algorithm over NIST P-384 curve.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ECC_NIST_P521 (0x0203)</td>
<td
style="text-align: left;"><em>CONFIG_ENCRYPTION_ALGORITHM_ECC_NIST_P521</em>.
Algorithm identifier of the ECC algorithm over NIST P-521 curve.</td>
</tr>
</tbody>
</table>
<h5 id="cipher-mode">Cipher mode</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(uint8_t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ECB (0x01)</td>
<td
style="text-align: left;"><em>CONFIG_ENCRYPTION_CIPHER_MODE_ECB</em>.
Electronic Codebook Mode (ECB). ECB mode encryption and decryption is
performed without any cipher padding. It is the sole responsibility of
the user to implement padding (if needed). For this mode of operation
the size of the plaintext and the size of the ciphertext are always the
same. This mode can only process ciphertext and/or plaintext sizes that
are an even multiple of the underlying cipher’s block size.</td>
</tr>
<tr class="even">
<td style="text-align: left;">CTR (0x02)</td>
<td
style="text-align: left;"><em>CONFIG_ENCRYPTION_CIPHER_MODE_CTR</em>.
Counter Mode (CTR). CTR mode encryption and decryption is performed
without any cipher padding. For this mode of operation the size of the
plaintext buffer and the size of the ciphertext buffer are always the
same. For this mode of operation the size of the ciphertext and/or
plaintext can be an arbitrary byte size; it does not have to be an even
multiple of the underlying cipher’s block size. <span class="citation"
data-cites="note">@note</span> This mode of operation requires an
initial nonce value for the counter. The nonce value is passed via the
IV field of the cipher parameter structure.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CBC (0x03)</td>
<td
style="text-align: left;"><em>CONFIG_ENCRYPTION_CIPHER_MODE_CBC</em>.
Cipher Block Chaining Mode (CBC) with PKCS#7 padding. For this mode of
operation the size of the ciphertext buffer can be up to one cipher
block larger than the size of the plaintext buffer. The implementation
automatically applies/removes PKCS#7 padding from the
plaintext/ciphertext. There are no restrictions on the size of the
(unpadded) plaintext; the ciphertext size is always an even multiple of
the underlying block cipher’s size. <span class="citation"
data-cites="note">@note</span> This mode of operation requires an
Initialization Vector (IV) of exactly one cipher block. <span
class="citation" data-cites="note">@note</span> When decrypting PKCS#7
padded ciphertexts particular precautions have to be taken to avoid
inadvertent creation of padding oracle vulnerabilities. Ciphertexts that
have been encrypted with PKCS#7 padding should ONLY be decrypted AFTER
they have been authenticated.</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCM (0x04)</td>
<td
style="text-align: left;"><em>CONFIG_ENCRYPTION_CIPHER_MODE_CCM</em>.
Counter-Mode with CBC-MAC (CCM). For this mode of operation the size of
the plaintext buffer and the size of the ciphertext buffer are always
the same. For this mode of operation the size of the ciphertext and/or
plaintext can be an arbitrary byte size; it does not have to be an even
multiple of the underlying cipher’s block size. <span class="citation"
data-cites="note">@note</span> This mode of operation requires an
initial nonce value for the counter. The nonce value is passed via the
IV field of the cipher parameter structure. <span class="citation"
data-cites="note">@note</span> This mode of operation produces/uses an
authentication tag. The size of the authentication tag can be any of 4,
6, 8, 10, 12, 14, or 16 bytes.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CBC_NO_PADDING (0x05)</td>
<td
style="text-align: left;"><em>CONFIG_ENCRYPTION_CIPHER_MODE_CBC_NO_PADDING</em>.
Cipher Block Chaining Mode (CBC) without padding. CBC mode encryption
and decryption is performed without any cipher padding. It is the sole
responsibility of the user to implement padding (if needed). For this
mode of operation the size of the plaintext and the size of the
ciphertext are always the same. This mode can only process ciphertext
and/or plaintext sizes that are an even multiple of the underlying
cipher’s block size. <span class="citation"
data-cites="note">@note</span> This mode of operation requires an
Initialization Vector (IV) of exactly one cipher block.</td>
</tr>
<tr class="even">
<td style="text-align: left;">EAX (0x06)</td>
<td
style="text-align: left;"><em>CONFIG_ENCRYPTION_CIPHER_MODE_EAX</em>.
EAX mode (encrypt-then-authenticate-then-translate) is a mode of
operation for cryptographic block ciphers. It is an Authenticated
Encryption with Associated Data (AEAD) algorithm designed to
simultaneously provide both authentication and privacy of the message
(authenticated encryption) with a two-pass scheme, one pass for
achieving privacy and one for authenticity for each block.</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>configEncryption()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x0A0501</td>
<td style="text-align: left;">E_CRYPTO_CONFIG_ENCRYPTION__BUSY:
Indicates that the security subsystem was currently busy performing
cryptographic operations and, therefore, could not process the import
key operation.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0A0502</td>
<td style="text-align: left;">E_CRYPTO_CONFIG_ENCRYPTION__BAD_PARAMETER:
Indicates that at least one of the parameters of this function were
invalid.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x0A0503</td>
<td style="text-align: left;">E_CRYPTO_CONFIG_ENCRYPTION__NOT_PERMITTED:
Indicates that the raw key import operation is not allowed for the
requested key and/or the current platform state.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0A0504</td>
<td style="text-align: left;">E_CRYPTO_CONFIG_ENCRYPTION__GENERAL_ERROR:
Indicates that the import key operation failed due to an unspecified
internal error condition. No further error information is provided, in
order to minimize the amount of information that is exposed to potential
attackers.</td>
</tr>
</tbody>
</table>
<h3
id="crypto.configdecryption..."><code>Crypto.configDecryption(...)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal Crypto.configDecryption( uint8_t* keyValue, uint8_t keyLength, uint16_t algorithm, uint8_t* ivValue, uint8_t ivLength, uint8_t cipherMode, uint8_t* aadValue, uint8_t aadLength )</code></p>
<p><strong>Description</strong>: Provide the parameters of the
decryption operation, including the encryption key, the mode of
operation, and the initialization value (if needed).</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">keyValue</td>
<td style="text-align: left;">(uint8_t*) Raw user-provided key.</td>
</tr>
<tr class="even">
<td style="text-align: left;">keyLength</td>
<td style="text-align: left;">(uint8_t) Length of the provided key value
(number of bytes).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">algorithm</td>
<td style="text-align: left;">(uint16_t) The underlying cryptographic
algorithm. For supported values, <a href="#algorithm">see
below</a>.</td>
</tr>
<tr class="even">
<td style="text-align: left;">ivValue</td>
<td style="text-align: left;">(uint8_t*) Initialization Vector (IV). The
interpretation of this field depends on the mode of operation selected
using the mode field. For cipher modes that do not use an IV (MODE_ECB)
this field must be set as a zero sized input data buffer, with NULL data
pointer. The data is not copied to a buffer, so make sure the pointer
still points to valid data at the time Crypto.encrypt() is
executed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ivLength</td>
<td style="text-align: left;">(uint8_t) Length of the provided IV value
(number of bytes).</td>
</tr>
<tr class="even">
<td style="text-align: left;">cipherMode</td>
<td style="text-align: left;">(uint8_t) Mode of operation for the
cipher. This field selects the mode of operation to be used by cipher.
The interpretation of the iv field depends on the selected mode of
operation. For supported values, <a href="#cipher-mode">see
below</a>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aadValue</td>
<td style="text-align: left;">(uint8_t*) Additional Authenticated Data
(AAD). The interpretation of this field depends on the mode of operation
selected using the mode field. It is only used by authenticated
encryption (AE) cipher modes. This field must be set as a zero size
input data buffer, with NULL data pointer, if an unauthenticated cipher
mode (eg. MODE_ECB, MODE_CTR, MODE_CBC) is used. The data is not copied
to a buffer, so make sure the pointer still points to valid data at the
time Crypto.encrypt() is executed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">aadLength</td>
<td style="text-align: left;">(uint8_t) Length of the provided AAD value
(number of bytes).</td>
</tr>
</tbody>
</table>
<p><strong>Parameter Values:</strong></p>
<h5 id="algorithm-1">Algorithm</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(uint16_t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AES_128 (0x0101)</td>
<td
style="text-align: left;"><em>CONFIG_DECRYPTION_ALGORITHM_AES_128</em>.
Algorithm identifier of the AES-128 algorithm.</td>
</tr>
<tr class="even">
<td style="text-align: left;">AES_256 (0x0102)</td>
<td
style="text-align: left;"><em>CONFIG_DECRYPTION_ALGORITHM_AES_256</em>.
Algorithm identifier of the AES-256 algorithm.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ECC_NIST_P256 (0x0201)</td>
<td
style="text-align: left;"><em>CONFIG_DECRYPTION_ALGORITHM_ECC_NIST_P256</em>.
Algorithm identifier of the ECC algorithm over NIST P-256 curve.</td>
</tr>
<tr class="even">
<td style="text-align: left;">ECC_NIST_P384 (0x0202)</td>
<td
style="text-align: left;"><em>CONFIG_DECRYPTION_ALGORITHM_ECC_NIST_P384</em>.
Algorithm identifier of the ECC algorithm over NIST P-384 curve.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ECC_NIST_P521 (0x0203)</td>
<td
style="text-align: left;"><em>CONFIG_DECRYPTION_ALGORITHM_ECC_NIST_P521</em>.
Algorithm identifier of the ECC algorithm over NIST P-521 curve.</td>
</tr>
</tbody>
</table>
<h5 id="cipher-mode-1">Cipher mode</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(uint8_t)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ECB (0x01)</td>
<td
style="text-align: left;"><em>CONFIG_DECRYPTION_CIPHER_MODE_ECB</em>.
Electronic Codebook Mode (ECB). ECB mode encryption and decryption is
performed without any cipher padding. It is the sole responsibility of
the user to implement padding (if needed). For this mode of operation
the size of the plaintext and the size of the ciphertext are always the
same. This mode can only process ciphertext and/or plaintext sizes that
are an even multiple of the underlying cipher’s block size.</td>
</tr>
<tr class="even">
<td style="text-align: left;">CTR (0x02)</td>
<td
style="text-align: left;"><em>CONFIG_DECRYPTION_CIPHER_MODE_CTR</em>.
Counter Mode (CTR). CTR mode encryption and decryption is performed
without any cipher padding. For this mode of operation the size of the
plaintext buffer and the size of the ciphertext buffer are always the
same. For this mode of operation the size of the ciphertext and/or
plaintext can be an arbitrary byte size; it does not have to be an even
multiple of the underlying cipher’s block size. <span class="citation"
data-cites="note">@note</span> This mode of operation requires an
initial nonce value for the counter. The nonce value is passed via the
IV field of the cipher parameter structure.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CBC (0x03)</td>
<td
style="text-align: left;"><em>CONFIG_DECRYPTION_CIPHER_MODE_CBC</em>.
Cipher Block Chaining Mode (CBC) with PKCS#7 padding. For this mode of
operation the size of the ciphertext buffer can be up to one cipher
block larger than the size of the plaintext buffer. The implementation
automatically applies/removes PKCS#7 padding from the
plaintext/ciphertext. There are no restrictions on the size of the
(unpadded) plaintext; the ciphertext size is always an even multiple of
the underlying block cipher’s size. <span class="citation"
data-cites="note">@note</span> This mode of operation requires an
Initialization Vector (IV) of exactly one cipher block. <span
class="citation" data-cites="note">@note</span> When decrypting PKCS#7
padded ciphertexts particular precautions have to be taken to avoid
inadvertent creation of padding oracle vulnerabilities. Ciphertexts that
have been encrypted with PKCS#7 padding should ONLY be decrypted AFTER
they have been authenticated.</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCM (0x04)</td>
<td
style="text-align: left;"><em>CONFIG_DECRYPTION_CIPHER_MODE_CCM</em>.
Counter-Mode with CBC-MAC (CCM). For this mode of operation the size of
the plaintext buffer and the size of the ciphertext buffer are always
the same. For this mode of operation the size of the ciphertext and/or
plaintext can be an arbitrary byte size; it does not have to be an even
multiple of the underlying cipher’s block size. <span class="citation"
data-cites="note">@note</span> This mode of operation requires an
initial nonce value for the counter. The nonce value is passed via the
IV field of the cipher parameter structure. <span class="citation"
data-cites="note">@note</span> This mode of operation produces/uses an
authentication tag. The size of the authentication tag can be any of 4,
6, 8, 10, 12, 14, or 16 bytes.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CBC_NO_PADDING (0x05)</td>
<td
style="text-align: left;"><em>CONFIG_DECRYPTION_CIPHER_MODE_CBC_NO_PADDING</em>.
Cipher Block Chaining Mode (CBC) without padding. CBC mode encryption
and decryption is performed without any cipher padding. It is the sole
responsibility of the user to implement padding (if needed). For this
mode of operation the size of the plaintext and the size of the
ciphertext are always the same. This mode can only process ciphertext
and/or plaintext sizes that are an even multiple of the underlying
cipher’s block size. <span class="citation"
data-cites="note">@note</span> This mode of operation requires an
Initialization Vector (IV) of exactly one cipher block.</td>
</tr>
<tr class="even">
<td style="text-align: left;">EAX (0x06)</td>
<td
style="text-align: left;"><em>CONFIG_DECRYPTION_CIPHER_MODE_EAX</em>.
EAX mode (encrypt-then-authenticate-then-translate) is a mode of
operation for cryptographic block ciphers. It is an Authenticated
Encryption with Associated Data (AEAD) algorithm designed to
simultaneously provide both authentication and privacy of the message
(authenticated encryption) with a two-pass scheme, one pass for
achieving privacy and one for authenticity for each block.</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>configDecryption()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x0A0601</td>
<td style="text-align: left;">E_CRYPTO_CONFIG_DECRYPTION__BUSY:
Indicates that the security subsystem was currently busy performing
cryptographic operations and, therefore, could not process the import
key operation.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0A0602</td>
<td style="text-align: left;">E_CRYPTO_CONFIG_DECRYPTION__BAD_PARAMETER:
Indicates that at least one of the parameters of this function were
invalid.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x0A0603</td>
<td style="text-align: left;">E_CRYPTO_CONFIG_DECRYPTION__NOT_PERMITTED:
Indicates that the raw key import operation is not allowed for the
requested key and/or the current platform state.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0A0604</td>
<td style="text-align: left;">E_CRYPTO_CONFIG_DECRYPTION__GENERAL_ERROR:
Indicates that the import key operation failed due to an unspecified
internal error condition. No further error information is provided, in
order to minimize the amount of information that is exposed to potential
attackers.</td>
</tr>
</tbody>
</table>
<h3 id="crypto.encrypt..."><code>Crypto.encrypt(...)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal Crypto.encrypt( uint8_t* source, uint16_t length, uint8_t* destination, uint32_t* authenticationTag )</code></p>
<p><strong>Description</strong>: Encrypts a contiguous region of
memory.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">source</td>
<td style="text-align: left;">(uint8_t*) Location of data to
encrypt.</td>
</tr>
<tr class="even">
<td style="text-align: left;">length</td>
<td style="text-align: left;">(uint16_t) Length of the input data in
bytes.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">destination</td>
<td style="text-align: left;">(uint8_t*) Location where the encrypted
data should be written to.</td>
</tr>
<tr class="even">
<td style="text-align: left;">authenticationTag</td>
<td style="text-align: left;">(uint32_t*) Output for the encrypted
authentication tag generated by authenticated encryption modes (cipher
mode CCM only). This parameter is only required for authenticated
encryption modes, and may be omitted (NULL) otherwise.</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>encrypt()</code> will set <a href="#errno"><code>errno</code></a>
to one of the following error codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x0A0701</td>
<td style="text-align: left;">E_CRYPTO_ENCRYPT__BUSY: Indicates that the
security subsystem was currently busy performing cryptographic
operations and, therefore, could not process the import key
operation.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0A0702</td>
<td style="text-align: left;">E_CRYPTO_ENCRYPT__BAD_PARAMETER: Indicates
that at least one of the parameters of this function were invalid.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x0A0703</td>
<td style="text-align: left;">E_CRYPTO_ENCRYPT__NOT_PERMITTED: Indicates
that the raw key import operation is not allowed for the requested key
and/or the current platform state.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0A0704</td>
<td style="text-align: left;">E_CRYPTO_ENCRYPT__GENERAL_ERROR: Indicates
that the import key operation failed due to an unspecified internal
error condition. No further error information is provided, in order to
minimize the amount of information that is exposed to potential
attackers.</td>
</tr>
</tbody>
</table>
<h3 id="crypto.decrypt..."><code>Crypto.decrypt(...)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal Crypto.decrypt( uint8_t* source, uint16_t length, uint8_t* destination, uint32_t* authenticationTag )</code></p>
<p><strong>Description</strong>: Decrypts a contiguous region of
memory.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">source</td>
<td style="text-align: left;">(uint8_t*) Location of data to
decrypt.</td>
</tr>
<tr class="even">
<td style="text-align: left;">length</td>
<td style="text-align: left;">(uint16_t) Length of the input data in
bytes.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">destination</td>
<td style="text-align: left;">(uint8_t*) Location where the decrypted
data should be written to.</td>
</tr>
<tr class="even">
<td style="text-align: left;">authenticationTag</td>
<td style="text-align: left;">(uint32_t*) The encrypted authentication
tag generated by authenticated encryption modes (cipher mode CCM only).
This parameter is only required for authenticated encryption modes, and
may be omitted (NULL) otherwise.</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>decrypt()</code> will set <a href="#errno"><code>errno</code></a>
to one of the following error codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x0A0801</td>
<td style="text-align: left;">E_CRYPTO_DECRYPT__VERIFICATION_FAILED: Is
reported by authenticated cipher suites, such AES in CCM mode, if
verification of the authentication tag failed. This error indicates that
the integrity of the provided ciphertext (and/or its authentication tag)
has been compromised and, therefore, that the ciphertext is not
trustworthy.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0A0802</td>
<td style="text-align: left;">E_CRYPTO_DECRYPT__BUSY: Indicates that the
security subsystem was currently busy performing cryptographic
operations and, therefore, could not process the import key
operation.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x0A0803</td>
<td style="text-align: left;">E_CRYPTO_DECRYPT__BAD_PARAMETER: Indicates
that at least one of the parameters of this function were invalid.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0A0804</td>
<td style="text-align: left;">E_CRYPTO_DECRYPT__NOT_PERMITTED: Indicates
that the raw key import operation is not allowed for the requested key
and/or the current platform state.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x0A0805</td>
<td style="text-align: left;">E_CRYPTO_DECRYPT__GENERAL_ERROR: Indicates
that the import key operation failed due to an unspecified internal
error condition. No further error information is provided, in order to
minimize the amount of information that is exposed to potential
attackers.</td>
</tr>
</tbody>
</table>
<h3 id="crypto.end"><code>Crypto.end()</code></h3>
<p><strong>Prototype</strong>: <code>void Crypto.end( void )</code></p>
<p><strong>Description</strong>: Powers down hardware blocks that are
required by the cryptographic subsystem.</p>
<h2 id="eeprom">EEPROM</h2>
<p>EEPROM is a memory whose values are kept when the board is powered
off (like a tiny hard drive). Here, 1024 bytes of flash are reserved for
this functionality, creating an emulated EEPROM. This family of
functions has four functions defined.</p>
<h3 id="eeprom.readaddress"><code>EEPROM.read(address)</code></h3>
<p><strong>Prototype</strong>:
<code>uint8_t EEPROM.read( uint16_t address )</code></p>
<p><strong>Description</strong>: Reads a byte from the EEPROM.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">address</td>
<td style="text-align: left;">(uint16_t) The location to read from,
starting from 0.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>EEPROM.read(0)</code></td>
<td style="text-align: left;">15 us</td>
<td style="text-align: left;">10 us</td>
<td style="text-align: left;">558</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>read()</code> will set <a href="#errno"><code>errno</code></a> to
one of the following error codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x0B0101</td>
<td style="text-align: left;">E_EEPROM_READ__OUT_OF_RANGE: The target
address is out of range.</td>
</tr>
</tbody>
</table>
<h3
id="eeprom.writeaddress-value"><code>EEPROM.write(address, value)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal EEPROM.write( uint16_t address, uint8_t value )</code></p>
<p><strong>Description</strong>: Reads a byte from the EEPROM.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">address</td>
<td style="text-align: left;">(uint16_t) The location to read from,
starting from 0.</td>
</tr>
<tr class="even">
<td style="text-align: left;">value</td>
<td style="text-align: left;">(uint8_t) The value to be stored in that
location (byte).</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>EEPROM.write(0, 0x33)</code></td>
<td style="text-align: left;">3229 us</td>
<td style="text-align: left;">2246 us</td>
<td style="text-align: left;">124002</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>write()</code> will set <a href="#errno"><code>errno</code></a> to
one of the following error codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x0B0201</td>
<td style="text-align: left;">E_EEPROM_WRITE__FAILED: General flash
write error.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0B0202</td>
<td style="text-align: left;">E_EEPROM_WRITE__OUT_OF_RANGE: The target
address is out of range.</td>
</tr>
</tbody>
</table>
<h3
id="eeprom.readbytesbuffer-address-length"><code>EEPROM.readBytes(buffer, address, length)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal EEPROM.readBytes( uint8_t* buffer, uint16_t address, uint16_t length )</code></p>
<p><strong>Description</strong>: Reads bytes from the EEPROM.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">buffer</td>
<td style="text-align: left;">(uint8_t*) The buffer to store the bytes
in.</td>
</tr>
<tr class="even">
<td style="text-align: left;">address</td>
<td style="text-align: left;">(uint16_t) The location to read from,
starting from 0.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">length</td>
<td style="text-align: left;">(uint16_t) The number of bytes to read.
The value(s) should be between 1 and 1023.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td
style="text-align: left;"><code>EEPROM.readBytes(buf, 0, 8)</code></td>
<td style="text-align: left;">14 us</td>
<td style="text-align: left;">10 us</td>
<td style="text-align: left;">548</td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>EEPROM.readBytes(buf, 0, 256)</code></td>
<td style="text-align: left;">28 us</td>
<td style="text-align: left;">20 us</td>
<td style="text-align: left;">1084</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>readBytes()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x0B0301</td>
<td style="text-align: left;">E_EEPROM_READ_BYTES__FAILED: Reading
failed, possibly because no data is stored at the target address.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0B0302</td>
<td style="text-align: left;">E_EEPROM_READ_BYTES__OUT_OF_RANGE: The
target address is out of range.</td>
</tr>
</tbody>
</table>
<h3
id="eeprom.writebytesbuffer-address-length"><code>EEPROM.writeBytes(buffer, address, length)</code></h3>
<p><strong>Prototype</strong>:
<code>ErrnoVal EEPROM.writeBytes( uint8_t* buffer, uint16_t address, uint16_t length )</code></p>
<p><strong>Description</strong>: Writes bytes to the EEPROM.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">buffer</td>
<td style="text-align: left;">(uint8_t*) The buffer to store the bytes
in.</td>
</tr>
<tr class="even">
<td style="text-align: left;">address</td>
<td style="text-align: left;">(uint16_t) The location to read from,
starting from 0.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">length</td>
<td style="text-align: left;">(uint16_t) The number of bytes to read.
The value(s) should be between 1 and 1023.</td>
</tr>
</tbody>
</table>
<p><strong>Execution Time</strong>:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Call</th>
<th style="text-align: left;">Duration</th>
<th style="text-align: left;">Session active</th>
<th style="text-align: left;">Cycles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td
style="text-align: left;"><code>EEPROM.writeBytes(buf, 0, 8)</code></td>
<td style="text-align: left;">3227 us</td>
<td style="text-align: left;">2245 us</td>
<td style="text-align: left;">123919</td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>EEPROM.writeBytes(buf, 0, 256)</code></td>
<td style="text-align: left;">3298 us</td>
<td style="text-align: left;">2295 us</td>
<td style="text-align: left;">126662</td>
</tr>
</tbody>
</table>
<p><strong>Error Codes: </strong> In case of an error,
<code>writeBytes()</code> will set <a
href="#errno"><code>errno</code></a> to one of the following error
codes:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">0x0B0401</td>
<td style="text-align: left;">E_EEPROM_WRITE_BYTES__FAILED: General
flash write error.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x0B0402</td>
<td style="text-align: left;">E_EEPROM_WRITE_BYTES__OUT_OF_RANGE: The
target address is out of range.</td>
</tr>
</tbody>
</table>
<h1 id="ultra-wideband-control-api">Ultra-wideband Control API</h1>
<p>The UWB Command Interface (UCI) enables communication with the
Ultra-wideband subsystem (UWBS).</p>
<p>When using the SFM10 as a slave module, the UCI defines the transport
layer, independent from the physical connection. A UCI message will
always start with a four-bytes header that defines the type and length
of the consecutive payload. Please refer to the document
“phy-uci-api.html” for documentation on the UCI packet format and the
current Phy implementation and serialization.</p>
<p>Three types of UCI messages are defined: A Command message (CMD),
which provides instructions to the UWBS, a Response message (RSP) that
is always a (direct) response following a command, and a notification
message (NTF) that informs about some state which can occur at any
time.</p>
<p>Within a User Application that runs on the SFM10, all UCI functions
are directly accessible without an intermediate transport layer. Hence,
a four-byte header is always omitted. The return value of a function
indicates the success of the command. In case a function returns output,
for example <code>UWB.getDeviceInfo()</code>, it will use a
user-provided structure pointer. You can subscribe to notification
messages using the <code>UWB.on..()</code> functions in which you
provide a callback function and provide the data containers that should
be used.</p>
<p>To make the SFM10 a UCI slave, please see the uci-over-uart and
uci-over-spi User Application examples. They basically add a UCI header
to outgoing messages and use some header interpretation logic for
incoming messages (refer “phy-uci-api.html”).</p>
<h2 id="device">Device</h2>
<h3
id="uwb.ondevicestatusupdatecallback-devicestatus"><code>UWB.onDeviceStatusUpdate(callback, deviceStatus)</code></h3>
<p><strong>Prototype</strong>:
<code>void onDeviceStatusUpdate(void (*function)(void), DeviceStatusNtf* deviceStatus)</code></p>
<p><strong>Description</strong>: To set a callback function (interrupt
service routine) to create fast event-driven procedures and to provide a
data container to store the notification payload for when an update is
ready regarding DEVICE_STATUS. This is the primary method to receive
DEVICE_STATUS notifications from the UWB subsystem. In case you are not
interested in the notification payload, you can pass a NULL pointer.
Note that directly after calling onDeviceStatusUpdate(), the current
state will be notified.</p>
<p><img src="figures/UCI%20Device%20State%20Machine.png" /> <em>UCI
Device State Machine</em></p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb80"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    DeviceStatusNtf deviceStatusNtf<span class="op">;</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> deviceNtf<span class="op">()</span> <span class="op">{</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;deviceState = 0x</span><span class="sc">%X</span><span class="st">, reason = 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> \</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>          deviceStatusNtf<span class="op">.</span>deviceState<span class="op">,</span> deviceStatusNtf<span class="op">.</span>deviceStateReason<span class="op">);</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onDeviceStatusUpdate<span class="op">(</span>deviceNtf<span class="op">,</span> <span class="op">&amp;</span>deviceStatusNtf<span class="op">);</span> <span class="co">// deviceNtf called</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span> <span class="co">// device status update, deviceNtf called</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>end<span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// device status update, deviceNtf called</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="co">    deviceState = 0x1, reason = 0x2</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="co">    deviceState = 0x2, reason = 0x11</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="co">    deviceState = 0x1, reason = 0x10</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">function</td>
<td style="text-align: left;">The function to be called when the
notification occurs must take no parameters and return nothing. This
function must perform very quickly to avoid slowing down or stopping the
operation of the device. Therefore, if some process needs to be executed
when this event occurs, it is recommended to use the
<code>triggerEvent()</code> method within the callback function, in
combination with <code>waitForEvent()</code> elsewhere. In case your isr
function only need to call <code>triggerEvent()</code>, instead of
passing the function pointer cou can simply pass a 16-bit value and
<code>triggerEvent()</code> will called internally with the 16-bit value
as <code>eventId</code>.</td>
</tr>
<tr class="even">
<td style="text-align: left;">deviceStatus</td>
<td style="text-align: left;">(DeviceStatusNtf* ) Pointer to a
deviceStatusNtf container. To notify about the current state of the
Ultra-wideband subsystem (UWBS). The UWBS shall generate a notification
whenever there is an update in the UWBS state</td>
</tr>
<tr class="odd">
<td style="text-align: left;">deviceStatus-&gt;uciStatus</td>
<td style="text-align: left;">A generic UCI status code. The value of
0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
<tr class="even">
<td style="text-align: left;">deviceStatus-&gt;deviceState</td>
<td style="text-align: left;">After the device has powered up and UWB is
initialized, the Device State is set to DEVICE_STATE_READY. Please see
the <a href="#device-state">Device state table</a> below.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">deviceStatus-&gt;deviceStateReason</td>
<td style="text-align: left;">Indicates the cause of the state change.
Please see the <a href="#device-state-reason">Device state reason
table</a> below.</td>
</tr>
</tbody>
</table>
<h5 id="device-state">Device state</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(enum)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">READY (0x01)</td>
<td style="text-align: left;">UWB is initialized and ready to begin.
This state is the first state after power ON. In this state, the device
shall accept all Device and Configuration commands.</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACTIVE (0x02)</td>
<td style="text-align: left;">UWB circuitry is activated. In this state,
the device shall accept all commands except for specific changes in UWB
configuration.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ERROR (0xFF)</td>
<td style="text-align: left;">An unrecoverable error occurred. A reset
is required.</td>
</tr>
</tbody>
</table>
<h5 id="device-state-reason">Device state reason</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">(enum)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">POWER_ON (0x1)</td>
<td style="text-align: left;">Power on reset was the reason for the
reboot.</td>
</tr>
<tr class="even">
<td style="text-align: left;">RESET_PIN (0x2)</td>
<td style="text-align: left;">Reset pin was the reason for the
reboot.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DPD_RESET_PIN (0x3)</td>
<td style="text-align: left;">Reset pin during deep power down was the
reason for the reboot.</td>
</tr>
<tr class="even">
<td style="text-align: left;">HPD_RESET_PIN (0x4)</td>
<td style="text-align: left;">Reset pin during hard power down was the
reason for the reboot.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HPD_WUP_PIN (0x5)</td>
<td style="text-align: left;">Wake up pin during hard power down was the
reason for the reboot.</td>
</tr>
<tr class="even">
<td style="text-align: left;">SOFTWARE_RESET (0x6)</td>
<td style="text-align: left;">Software master reset was the reason for
the reboot.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FAIL_VDD_BIAS_BANDGAP (0x7)</td>
<td style="text-align: left;">Reset caused by power failure on the bias
bandgap.</td>
</tr>
<tr class="even">
<td style="text-align: left;">FAIL_VDD_CPU_RET (0x8)</td>
<td style="text-align: left;">Reset caused by power failure on the CPU
retention power domain.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BROWNOUT_CPU_RET (0x9)</td>
<td style="text-align: left;">Reset caused by brownout on the CPU
retention power domain.</td>
</tr>
<tr class="even">
<td style="text-align: left;">FAIL_VDD_PFLASH (0xA)</td>
<td style="text-align: left;">Power failure on the non-volatile power
domain was the reason for the reboot.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FAIL_VDD_BUF_LOW (0xB)</td>
<td style="text-align: left;">Power failure on the buffer power domain
was the reason for the reboot.</td>
</tr>
<tr class="even">
<td style="text-align: left;">WATCHDOG (0xC)</td>
<td style="text-align: left;">Reset caused by the watchdog timer.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FAILED_STATE_CHANGE (0xD)</td>
<td style="text-align: left;">Failed state change request was the reason
for the reboot.</td>
</tr>
<tr class="even">
<td style="text-align: left;">WUP_TIMER (0xE)</td>
<td style="text-align: left;">Wake-up timer from deep power down was the
reason for the reboot.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WUP_SNAPSHOT (0xF)</td>
<td style="text-align: left;">Snapshot activity from deep power down was
the reason for the reboot.</td>
</tr>
<tr class="even">
<td style="text-align: left;">NO_ACTIVE_SESSIONS (0x10)</td>
<td style="text-align: left;">The Device State moved from ACTIVE to
READY because there are no active sessions anymore.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SESSION_ACTIVE (0x11)</td>
<td style="text-align: left;">The UWBS moved from READY to ACTIVE Device
State because one or more ranging sessions are activated.</td>
</tr>
<tr class="even">
<td style="text-align: left;">DPD_GPIO (0x21)</td>
<td style="text-align: left;">Wake up gpio event during hard power down
was the reason for the reboot.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">INVALID_STS_CONFIG (0x24)</td>
<td style="text-align: left;">The Scrambled Timestamp Sequence (STS) is
not configured correctly.</td>
</tr>
</tbody>
</table>
<h3 id="uwb.resetdevice"><code>UWB.resetDevice()</code></h3>
<p><strong>Prototype</strong>: <code>UciStatus resetDevice()</code></p>
<p><strong>Description</strong>: Request for device reset.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb81"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Hi</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>resetDevice<span class="op">();</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* example output:</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Hi</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Hi</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Hi</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.getdeviceinfooutput"><code>UWB.getDeviceInfo(output)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus getDeviceInfo(GetDeviceInfoRsp* output)</code></p>
<p><strong>Description</strong>: To get the UWBS device information.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb82"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define PRINT_HEX</span><span class="op">(</span>name<span class="op">)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>Serial<span class="op">.</span>print<span class="op">(</span><span class="pp">#</span>name<span class="pp"> </span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">= 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span><span class="pp"> </span>info<span class="op">.</span>name<span class="op">);</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define PRINT_UINT</span><span class="op">(</span>name<span class="op">)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>Serial<span class="op">.</span>print<span class="op">(</span><span class="pp">#</span>name<span class="pp"> </span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">= </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span><span class="pp"> </span>info<span class="op">.</span>name<span class="op">);</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define PRINT_VERSION</span><span class="op">(</span>name<span class="op">)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>Serial<span class="op">.</span>print<span class="op">(</span><span class="pp">#</span>name<span class="pp"> </span><span class="st">&quot;Version</span><span class="sc">\t</span><span class="st">= </span><span class="sc">%u</span><span class="st">.</span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>info<span class="op">.</span>name<span class="pp"> ## </span>MajorVersion<span class="op">,</span><span class="pp"> </span>info<span class="op">.</span>name<span class="pp"> ## </span>MinorVersion<span class="op">);</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>        GetDeviceInfoRsp info<span class="op">;</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>getDeviceInfo<span class="op">(&amp;</span>info<span class="op">);</span>  </span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>        PRINT_UINT<span class="op">(</span>uciStatus<span class="op">)</span>            </span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>        PRINT_HEX<span class="op">(</span>serialNumber<span class="op">)</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>        PRINT_VERSION<span class="op">(</span>app<span class="op">)</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>        PRINT_VERSION<span class="op">(</span>phy<span class="op">)</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>        PRINT_VERSION<span class="op">(</span>chip<span class="op">)</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>        PRINT_VERSION<span class="op">(</span>rom<span class="op">)</span></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>        PRINT_VERSION<span class="op">(</span>baseband<span class="op">)</span></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>        PRINT_VERSION<span class="op">(</span>dsp<span class="op">)</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* example output:</span></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a><span class="co">    uciStatus       = 0</span></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a><span class="co">    uciVersion      = 1.16</span></span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a><span class="co">    macVersion      = 1.48</span></span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a><span class="co">    phyVersion      = 1.48</span></span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a><span class="co">    testVersion     = 0.0</span></span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a><span class="co">    vsiLength       = 10</span></span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a><span class="co">    serialNumber    = 0xF05BB7FD</span></span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a><span class="co">    appVersion      = 0.3</span></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a><span class="co">    chipVersion     = 22.15</span></span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a><span class="co">    romVersion      = 4.0</span></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a><span class="co">    basebandVersion = 2.23</span></span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a><span class="co">    dspVersion      = 2.20</span></span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
<tr class="even">
<td style="text-align: left;">phyMajorVersion</td>
<td style="text-align: left;">(hex8) Major number of the PHY
specification version.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">phyMinorVersion</td>
<td style="text-align: left;">(hex8) Minor number of the PHY version.
.</td>
</tr>
<tr class="even">
<td style="text-align: left;">serialNumber</td>
<td style="text-align: left;">(hex32) Unique device identifier.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">appMajorVersion</td>
<td style="text-align: left;">(hex8) Major number of the application
version.</td>
</tr>
<tr class="even">
<td style="text-align: left;">appMinorVersion</td>
<td style="text-align: left;">(hex8) Minor number of the application
version. The bit0-bit3 represents the Patch version and bit4-bit7
represents the Minor version.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">chipMajorVersion</td>
<td style="text-align: left;">(hex8) Silicon Product identifier (major
byte).</td>
</tr>
<tr class="even">
<td style="text-align: left;">chipMinorVersion</td>
<td style="text-align: left;">(hex8) Silicon Typecheck identifier (major
byte).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">romMajorVersion</td>
<td style="text-align: left;">(hex8) Major number of the ROM functions
version.</td>
</tr>
<tr class="even">
<td style="text-align: left;">romMinorVersion</td>
<td style="text-align: left;">(hex8) Minor number of the ROM functions
version. The bit0-bit3 represents the Patch version and bit4-bit7
represents the Minor version.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">basebandMajorVersion</td>
<td style="text-align: left;">(hex8) Major number of the Baseband
version.</td>
</tr>
<tr class="even">
<td style="text-align: left;">basebandMinorVersion</td>
<td style="text-align: left;">(hex8) Minor number of the Baseband
version.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dspMajorVersion</td>
<td style="text-align: left;">(hex8) Major number of the DSP
version.</td>
</tr>
<tr class="even">
<td style="text-align: left;">dspMinorVersion</td>
<td style="text-align: left;">(hex8) Minor number of the DSP
version.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.enterpowermodeinput"><code>UWB.enterPowerMode(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus enterPowerMode(EnterPowerModeCmd* input)</code></p>
<p><strong>Description</strong>: This command puts the IC into a low
power state to save energy.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb83"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Boot!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">10</span><span class="op">);</span> <span class="co">// wait for Serial.print to finish</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>        EnterPowerModeCmd cmd <span class="op">=</span> <span class="op">{</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>powerMode <span class="op">=</span> DEEP_POWER_DOWN<span class="op">,</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>wakeUpPin <span class="op">=</span> WUP_RX_FALLING <span class="op">|</span> WUP_D3_FALLING<span class="op">,</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>wakeUpTime <span class="op">=</span> millis<span class="op">()</span> <span class="op">+</span> <span class="dv">5000</span><span class="op">,</span> <span class="co">// wake up after 5 seconds</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>        UciStatus retCode <span class="op">=</span> UWB<span class="op">.</span>enterPowerMode<span class="op">(&amp;</span>cmd<span class="op">);</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>retCode <span class="op">!=</span> UCI_STATUS_SUCCESS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;enterPowerMode failed: </span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> retCode<span class="op">);</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;This line is never reached</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Device boots after UART is received (RX)</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">// OR when the User Button is pressed (D3)</span></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// OR when 5000 ms have passed</span></span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">wakeUpTime</td>
<td style="text-align: left;">(uint32) Wake-up time in ms. Non-zero only
allowed in Power Mode 0x8, 0x9 and 0xA. This configures the wake-up
timer with the given value.</td>
</tr>
<tr class="even">
<td style="text-align: left;">wakeUpPin</td>
<td style="text-align: left;">(uint32) Wake-up pin configuration. Please
note that at least one wake up source has to be configured. If no wake
up source is configured a parameter error will be returned.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">powerMode</td>
<td style="text-align: left;">(0x01&lt;=enum&lt;=0x1A) The Power Mode
determines the low power state, which will be entered by this command.
Please see the <a href="#power-mode">Power mode table</a> below.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.setpersistentreginput"><code>UWB.setPersistentReg(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus setPersistentReg(SetPersistentRegCmd* input)</code></p>
<p><strong>Description</strong>: To retain 32 bits of data in RAM that
survive a device reset. When the device is resetted using the reset pin
/ button, resetted via software, or awakens from a deep or hard power
down, all data in RAM is cleared. However, there are 4 bytes of data
that persist and survive a reset. This can be set as a 32 bit value
using this function. To read back the data, use getPeristentReg(). These
32 bits are cleared only after a Power-On Reset.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb84"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> value <span class="op">=</span> <span class="bn">0x12345678</span><span class="op">;</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>setPersistentReg<span class="op">((</span>SetPersistentRegCmd<span class="op">*)&amp;</span>value<span class="op">);</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">value</td>
<td style="text-align: left;">(uint32) User-defined value that should
survive a (warm) reset.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.getpersistentregoutput"><code>UWB.getPersistentReg(output)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus getPersistentReg(GetPersistentRegRsp* output)</code></p>
<p><strong>Description</strong>: To read back the 32 bits in RAM that
survive a reset. See <code>setPersistentReg()</code>.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb85"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>      GetPersistentRegRsp retrieved<span class="op">;</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>      UWB<span class="op">.</span>getPersistentReg<span class="op">(&amp;</span>retrieved<span class="op">);</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Retrieved 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> retrieved<span class="op">.</span>value<span class="op">);</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint32_t</span> value <span class="op">=</span> retrieved<span class="op">.</span>value <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>      UWB<span class="op">.</span>setPersistentReg<span class="op">((</span>SetPersistentRegCmd<span class="op">*)&amp;</span>value<span class="op">);</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
<tr class="even">
<td style="text-align: left;">value</td>
<td style="text-align: left;">(uint32) User-defined value that should
survive a (warm) reset.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.otaupdatereceiveinput"><code>UWB.otaUpdateReceive(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus otaUpdateReceive(OtaUpdateReceiveCmd* input)</code></p>
<p><strong>Description</strong>: Receive over the air update
packets.</p>
<p>Over-the-air (OTA) updates are a mechanism for remotely updating
SFM10 devices with new user application firmware. OTA updates allow your
smart appliance to download new firmware over the course of its lifetime
without connecting it to a PC.</p>
<p>o update a device remotely, the device must first be instructed to
start OTAU from within the active user application. How to do this?
After any successful RX, the macro <code>IS_OTAU(payloadPtr)</code> can
be used to detect the presence of OTAU. It will return a 1 if the
payload that is passed matches the OTAU format and targets the user
application version (<code>CONFIG_APP_VERSION</code>). Then, within your
main event loop you can call <code>UWB.otaUpdateReceive()</code> from
within the active user application. More simply, you could use
<code>GET_OTAU()</code> to start fetching the update packets after
<code>IS_OTAU()</code> was true.</p>
<p>After calling <code>UWB.otaUpdateReceive()</code>, the application
pauses, starts RX using the default radio settings, and listens for
packets with the specific OTAU packet format.</p>
<p>The OTAU packet format consists of a 16 bytes header that includes
the API version and total CRC, and a 512 bytes payload that includes a
piece (‘page’) of the new user application firmware.</p>
<p>After a page is received, it is written to flash and the current
(i.e. old) user application is flagged as invalid. Once all pages have
been received, and the total CRC is correct, OTAU stops and the new user
application is booted. In case the total CRC does not match, OTAU is
restarted.</p>
<p>When no OTAU packet is received within the specified timeout after
<code>otaUpdateReceive()</code> was called, OTAU stops and the current
user application continues where it was left off.</p>
<p>hen you flash a new user application via otau.py the UWB library
starts running a small program to distribute the application packets.
The FW itself is not executed or evaluated. This means that the UWB
library does not check what value for Serial.begin is used anywhere
inside the user application code; instead the output strings like “tx 1
/ 37” are printed with the default 115200 baud rate.</p>
<p>te that a user application only works within the same SDK version. To
update the SDK remotely, we will deliver a SDK OTAU tool (starting from
v1.2.0).</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb86"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1) Upload this application to a SFM10 device, as normally done.</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2) Disconnect it from the PC and power it with for example a power bank.</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3) Make a change in the application, e.g. change ``PIN_LED_G`` into ``PIN_LED_R``.</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 4) Take a second SFM10 device for OTAU distribution and connect it to the PC.</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 5) in file .vscode/tasks.json near the end change the line:</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">//     &quot;../${config:sourceFiles}/upload.py&quot;,</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// into:</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">//     &quot;../${config:sourceFiles}/otau.py&quot;,</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 6) Press F5 (or Ctrl+Shift+B). Within 2 seconds the initial SFM10 device will adopt the changes.</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>      pinMode<span class="op">(</span>PIN_LED_G<span class="op">,</span> OUTPUT_HIGH<span class="op">);</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>    PayloadNtf rxPacket<span class="op">;</span></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> tLastChecked <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>      digitalWrite<span class="op">(</span>PIN_LED_G<span class="op">,</span> LOW<span class="op">);</span></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">200</span><span class="op">);</span></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>      digitalWrite<span class="op">(</span>PIN_LED_G<span class="op">,</span> HIGH<span class="op">);</span></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint32_t</span> tNow <span class="op">=</span> millis<span class="op">();</span></span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>tNow <span class="op">-</span> tLastChecked <span class="op">&gt;</span><span class="dv">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onRxUpdate<span class="op">(</span> RX_DONE<span class="op">,</span> NULL<span class="op">,</span> <span class="op">&amp;</span>rxPacket<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">OtaPacket_t</span><span class="op">),</span> NULL<span class="op">,</span> NULL <span class="op">);</span></span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>startRx<span class="op">(</span>ASAP<span class="op">);</span></span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">((</span>waitForEvent<span class="op">(</span><span class="dv">25</span><span class="op">)</span> <span class="op">&amp;</span> RX_DONE<span class="op">)</span> <span class="op">&amp;&amp;</span> IS_OTAU<span class="op">(&amp;</span>rxPacket<span class="op">))</span> <span class="op">{</span></span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a>          GET_OTAU<span class="op">();</span></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>end<span class="op">();</span></span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>        tLastChecked <span class="op">=</span> tNow<span class="op">;</span></span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">appVersion</td>
<td style="text-align: left;">(uint32) Only OTA update packets
transmitted with a matching app version value will be downloaded by the
receiver. The default value is ‘0x0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">totalCrc</td>
<td style="text-align: left;">(uint32) The CRC over the total binary,
including zero padding. Only OTA update packets with a matching CRC will
be downloaded. This allows distribution of multiple firmware versions in
parallel. In case a 0 is passed, no selection is made based on a
predetermined CRC; instead the first OTA update packet that is received
will drive the selection of the remaining packets. The default value is
‘0x0’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">timeoutSeconds</td>
<td style="text-align: left;">(uint32) To stop when no single OTAU is
downloaded within the specified time, after which the user application
continues where it was left off. When 0 is provided, no timeout is set.
The default value is ‘0’.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.otaupdatetransmitinput"><code>UWB.otaUpdateTransmit(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus otaUpdateTransmit(OtaUpdateTransmitCmd* input)</code></p>
<p><strong>Description</strong>: Transmit over the air update
packets.</p>
<p>In the future this function could be used to distribute firmware
during the exectution of an (other) user application. For now, see
<code>otaUpdateReceive</code> on how to distribute firmware over the
air.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">appVersion</td>
<td style="text-align: left;">(uint32) Only OTA update packets
transmitted with a matching app version value will be downloaded by the
receiver. The default value is ‘0x0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">repeatCount</td>
<td style="text-align: left;">(uint32) To specify how many times the
distribution off all firmware packets must be repeated before the
function terminates. A value of 0 indicates indefinitely; firmware
distrubution is stopped only via a device reset (which can be scheduled
using <code>Timers.at(.., reset)</code>). The default value is ‘0’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fileStartPointer</td>
<td style="text-align: left;">(uint32) Memory location of the
to-be-distributed user application binary.</td>
</tr>
<tr class="even">
<td style="text-align: left;">pageCount</td>
<td style="text-align: left;">(uint8) Length of the to-be-distributed
user application binary as a multiple pof 512 bytes. When the last part
has a size less then 512, zeros must be padded to make it 512
bytes.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h2 id="configuration">Configuration</h2>
<p>The UWB radio can be configured before <code>UWB.begin()</code> is
called.</p>
<h3
id="uwb.setconfigurationinput"><code>UWB.setConfiguration(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus setConfiguration(SetConfigurationCmd* input)</code></p>
<p><strong>Description</strong>: To set the UWBS device
configurations.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb87"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;UWB Started</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>        SetConfigurationCmd config<span class="op">;</span>    </span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Alternatively, use UWB.getConfiguration(&amp;config):</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>        SetConfiguration_setDefaults<span class="op">(&amp;</span>config<span class="op">);</span> <span class="co">// fill in defaults</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>        config<span class="op">.</span>currentLimit <span class="op">=</span> <span class="dv">5</span><span class="op">;</span> <span class="co">// enable current limiter</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>        ASSERT<span class="op">(</span>UWB<span class="op">.</span>setConfiguration<span class="op">(&amp;</span>config<span class="op">),</span> SUCCESS<span class="op">);</span> <span class="co">// pass</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>startRx<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Changing Radio settings during an action will trigger an </span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">//  Operation not allowed error:</span></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>        config<span class="op">.</span>channelFrequency <span class="op">=</span> UWB_CHANNEL_9<span class="op">;</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>        config<span class="op">.</span>txPower <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>        ASSERT<span class="op">(</span>UWB<span class="op">.</span>setConfiguration<span class="op">(&amp;</span>config<span class="op">),</span> SUCCESS<span class="op">);</span>  </span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>end<span class="op">();</span></span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">// When we restart UWB, the settings that failed previously become effective</span></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>getConfiguration<span class="op">(&amp;</span>config<span class="op">);</span></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Now the radio is running at </span><span class="sc">%u</span><span class="st"> kHz</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> config<span class="op">.</span>channelFrequency<span class="op">);</span></span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>startRx<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* example output:</span></span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a><span class="co">    UWB Started</span></span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a><span class="co">    Returned 0xB8 at line 41</span></span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a><span class="co">    Now the radio is running at 7987200 kHz</span></span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">rfu</td>
<td style="text-align: left;">(uint8) Reserved for future use. The
default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">enableXtalOut</td>
<td style="text-align: left;">(hex8&lt;=1) To provide the clock
generated from the crystal at the XTAL out pin when the Session is
ACTIVE. With this functionality it is possible to supply other devices
with a clock signal. The default value is ‘1’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">currentLimit</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=20) Current Limit between
5 and 20 mA. A value of 0 disables the current limiter. The default
value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">enablePASignal</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=1) Output gating signal
for an optional external Power Amplifier (PA) at GPIO8. The default
value is ‘0’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scheduleTimeCheck</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=1) Indicates whether the
timestamps passed with <code>startTx()</code> or <code>startRx()</code>
should be checked for validity. If the provided timestamp cannot be met,
or it lies more than 5 seconds in the future, the startTx or startRx
will return an error. Disabling this check results in slightly faster
code. The default value is ‘1’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">channelFrequency</td>
<td style="text-align: left;">(6400000&lt;=uint32&lt;=8000000) Nominal
frequency of operation on UWB. Units are [Khz]. The default value is
‘UWB_CHANNEL_5’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ppb</td>
<td style="text-align: left;">(int32) Parts per billion (ppb) frequency
deviation of the crystal corresponding to the measured temperature.
Supported range: -256000 to +256000. The default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">keyHash</td>
<td style="text-align: left;">(bytes) The salted hash used for
configuring the STS.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">stsIdx</td>
<td style="text-align: left;">(uint32) 0x00000000 - 0xFFFFFFFF … The
starting STS index to be used. The default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">stsKeyIdx</td>
<td style="text-align: left;">(uint8) This is a user-selected key index
used to store the imported key in a table of key handles. This key index
can then be referenced by other commands. Eight key slots are available.
UWB.importKey() is mandatory to store a key first. In case no STS or no
specific key is prefered, set the value to 0xFF and the default key (all
zeros) will be imported automatically. The default value is ‘0xFF’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">txRadioCfg</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=15) The index indicating
radio and frame configuration to be used for the receive mode (TX). The
default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">txSyncCode</td>
<td style="text-align: left;">(0x00&lt;=uint8&lt;=51) Selects the SYNC
code configuration for the RX/TX action in the ranging action. 0x00
means to use the sync code defined by the radio setting. 9 - 32 for the
(pre-stored) IEEE compliant SYNC code index. 33 - 51 for the
(pre-stored) proprietary SYNC code index. The default value is ‘0’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">txPower</td>
<td style="text-align: left;">(-48&lt;=int8&lt;=120) TX power. Range:
-12 dBm to +30 dBm with 0.25 dBm resolution. When going over +14 dBm
(value 57 and up), one should consider the regulatory limits. It should
be used only with the shorter frames ( smaller than 1 ms). Note that the
regulatory limits are specified in average power per millisecond. For
every 3 dB that you add, the output power doubles. The default value is
‘56’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">txRangingEnabled</td>
<td style="text-align: left;">(0x00&lt;=uint8&lt;=0x01) Depending on the
radio setting the PHR might contain the information if ranging is
enabled. This parameter is written to the PHR for those settings. 0x00
Ranging disabled; 0x01 Ranging enabled. The default value is ‘1’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">txStsIdxIncrement</td>
<td style="text-align: left;">(int8) Selects the offset to apply to the
STS index expected for the RX or TX action to be performed. The STS
index will be incremented by that offset number. In case there is no STS
used for this frame or the STS is configured to be constant, this
parameter is ignored. The default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">txPayloadCipher</td>
<td style="text-align: left;">(uint8&lt;=0xFF) Payload cipher key handle
index (default: 0xFF, disabled). 0x00-0x07 Enables UWB payload cipher
and value is index of key handle to be used for ciphering operations.
Please note that if UWB payload ciphering is enabled then
encryption/decryption key must be configured in advance and UWB payload
size is restricted to 95 bytes. 0x08-0xFF Disables UWB payload
ciphering. The default value is ‘0xFF’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rxRadioCfg</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=15) The index indicating
radio and frame configuration to be used for the receive mode (RX). The
default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">rxSyncCode</td>
<td style="text-align: left;">(0x00&lt;=uint8&lt;=43) Selects the SYNC
code configuration for the RX/TX action in the ranging action. 0x00
means to use the sync code defined by the radio setting. 9 - 32 for the
(pre-stored) IEEE compliant SYNC code index. 33 - 51 for the
(pre-stored) proprietary SYNC code index. The default value is ‘0’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rxRangingEnabled</td>
<td style="text-align: left;">(0x00&lt;=uint8&lt;=0x01) Depending on the
radio setting the PHR might contain the information if ranging is
enabled. This parameter is written to the PHR for those settings. 0x00
Ranging disabled; 0x01 Ranging enabled. The default value is ‘1’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">rxStsIdxIncrement</td>
<td style="text-align: left;">(int8) Selects the offset to apply to the
STS index expected for the RX or TX action to be performed. The STS
index will be incremented by that offset number. In case there is no STS
used for this frame or the STS is configured to be constant, this
parameter is ignored. The default value is ‘0’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rxPayloadCipher</td>
<td style="text-align: left;">(uint8&lt;=0xFF) Payload cipher key handle
index (default: 0xFF, disabled). 0x00-0x07 Enables UWB payload cipher
and value is index of key handle to be used for ciphering operations.
Please note that if UWB payload ciphering is enabled then
encryption/decryption key must be configured in advance and UWB payload
size is restricted to 95 bytes. 0x08-0xFF Disables UWB payload
ciphering. The default value is ‘0xFF’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">nbInterferenceCancelation</td>
<td style="text-align: left;">(0x00&lt;=enum&lt;=0x02) Defines Narrow
Band Interference Cancellation (NBIC) feature status. The default value
is ‘0x00’. Please see the <a href="#nb-interference-cancelation">Nb
interference cancelation table</a> below.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">channelImpulseResponseStart</td>
<td style="text-align: left;">(-500&lt;=int16&lt;=470) Number of samples
before the Timestamp pulse (First path index) to be included in the CIR
notification. 0 means the first sample is at the First path index. Units
are [samples]. The default value is ‘-16’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">channelImpulseResponseLength</td>
<td style="text-align: left;">(uint8) Total number of samples to be
included in the CIR notification. Units are [samples]. The default value
is ‘32’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rxSecurityLevel</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=176) The first path
security level allows to make a trade-off between security and
sensitivity. A higher value increases security while it also results in
sensitivity loss. The default value is ‘64’.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.getconfigurationoutput"><code>UWB.getConfiguration(output)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus getConfiguration(GetConfigurationRsp* output)</code></p>
<p><strong>Description</strong>: To get the UWBS device
configurations.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb88"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>      GetConfigurationRsp config<span class="op">;</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>      UWB<span class="op">.</span>getConfiguration<span class="op">(&amp;</span>config<span class="op">);</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;channelFrequency = </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> config<span class="op">.</span>channelFrequency<span class="op">);</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* example output:</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="co">    channelFrequency = 6489600</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
<tr class="even">
<td style="text-align: left;">enableXtalOut</td>
<td style="text-align: left;">(hex8&lt;=1) To provide the clock
generated from the crystal at the XTAL out pin when the Session is
ACTIVE. With this functionality it is possible to supply other devices
with a clock signal. The default value is ‘1’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">currentLimit</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=20) Current Limit between
5 and 20 mA. A value of 0 disables the current limiter. The default
value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">enablePASignal</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=1) Output gating signal
for an optional external Power Amplifier (PA) at GPIO8. The default
value is ‘0’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scheduleTimeCheck</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=1) Indicates whether the
timestamps passed with <code>startTx()</code> or <code>startRx()</code>
should be checked for validity. If the provided timestamp cannot be met,
or it lies more than 5 seconds in the future, the startTx or startRx
will return an error. Disabling this check results in slightly faster
code. The default value is ‘1’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">channelFrequency</td>
<td style="text-align: left;">(6400000&lt;=uint32&lt;=8000000) Nominal
frequency of operation on UWB. Units are [Khz]. The default value is
‘UWB_CHANNEL_5’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ppb</td>
<td style="text-align: left;">(int32) Parts per billion (ppb) frequency
deviation of the crystal corresponding to the measured temperature.
Supported range: -256000 to +256000. The default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">keyHash</td>
<td style="text-align: left;">(bytes) The salted hash used for
configuring the STS.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">stsIdx</td>
<td style="text-align: left;">(uint32) 0x00000000 - 0xFFFFFFFF … The
starting STS index to be used. The default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">stsKeyIdx</td>
<td style="text-align: left;">(uint8) This is a user-selected key index
used to store the imported key in a table of key handles. This key index
can then be referenced by other commands. Eight key slots are available.
UWB.importKey() is mandatory to store a key first. In case no STS or no
specific key is prefered, set the value to 0xFF and the default key (all
zeros) will be imported automatically. The default value is ‘0xFF’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">txRadioCfg</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=15) The index indicating
radio and frame configuration to be used for the receive mode (TX). The
default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">txSyncCode</td>
<td style="text-align: left;">(0x00&lt;=uint8&lt;=51) Selects the SYNC
code configuration for the RX/TX action in the ranging action. 0x00
means to use the sync code defined by the radio setting. 9 - 32 for the
(pre-stored) IEEE compliant SYNC code index. 33 - 51 for the
(pre-stored) proprietary SYNC code index. The default value is ‘0’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">txPower</td>
<td style="text-align: left;">(-48&lt;=int8&lt;=120) TX power. Range:
-12 dBm to +30 dBm with 0.25 dBm resolution. When going over +14 dBm
(value 57 and up), one should consider the regulatory limits. It should
be used only with the shorter frames ( smaller than 1 ms). Note that the
regulatory limits are specified in average power per millisecond. For
every 3 dB that you add, the output power doubles. The default value is
‘56’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">txRangingEnabled</td>
<td style="text-align: left;">(0x00&lt;=uint8&lt;=0x01) Depending on the
radio setting the PHR might contain the information if ranging is
enabled. This parameter is written to the PHR for those settings. 0x00
Ranging disabled; 0x01 Ranging enabled. The default value is ‘1’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">txStsIdxIncrement</td>
<td style="text-align: left;">(int8) Selects the offset to apply to the
STS index expected for the RX or TX action to be performed. The STS
index will be incremented by that offset number. In case there is no STS
used for this frame or the STS is configured to be constant, this
parameter is ignored. The default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">txPayloadCipher</td>
<td style="text-align: left;">(uint8&lt;=0xFF) Payload cipher key handle
index (default: 0xFF, disabled). 0x00-0x07 Enables UWB payload cipher
and value is index of key handle to be used for ciphering operations.
Please note that if UWB payload ciphering is enabled then
encryption/decryption key must be configured in advance and UWB payload
size is restricted to 95 bytes. 0x08-0xFF Disables UWB payload
ciphering. The default value is ‘0xFF’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rxRadioCfg</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=15) The index indicating
radio and frame configuration to be used for the receive mode (RX). The
default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">rxSyncCode</td>
<td style="text-align: left;">(0x00&lt;=uint8&lt;=43) Selects the SYNC
code configuration for the RX/TX action in the ranging action. 0x00
means to use the sync code defined by the radio setting. 9 - 32 for the
(pre-stored) IEEE compliant SYNC code index. 33 - 51 for the
(pre-stored) proprietary SYNC code index. The default value is ‘0’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rxRangingEnabled</td>
<td style="text-align: left;">(0x00&lt;=uint8&lt;=0x01) Depending on the
radio setting the PHR might contain the information if ranging is
enabled. This parameter is written to the PHR for those settings. 0x00
Ranging disabled; 0x01 Ranging enabled. The default value is ‘1’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">rxStsIdxIncrement</td>
<td style="text-align: left;">(int8) Selects the offset to apply to the
STS index expected for the RX or TX action to be performed. The STS
index will be incremented by that offset number. In case there is no STS
used for this frame or the STS is configured to be constant, this
parameter is ignored. The default value is ‘0’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rxPayloadCipher</td>
<td style="text-align: left;">(uint8&lt;=0xFF) Payload cipher key handle
index (default: 0xFF, disabled). 0x00-0x07 Enables UWB payload cipher
and value is index of key handle to be used for ciphering operations.
Please note that if UWB payload ciphering is enabled then
encryption/decryption key must be configured in advance and UWB payload
size is restricted to 95 bytes. 0x08-0xFF Disables UWB payload
ciphering. The default value is ‘0xFF’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">nbInterferenceCancelation</td>
<td style="text-align: left;">(0x00&lt;=enum&lt;=0x02) Defines Narrow
Band Interference Cancellation (NBIC) feature status. The default value
is ‘0x00’. Please see the <a href="#nb-interference-cancelation">Nb
interference cancelation table</a> below.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">channelImpulseResponseStart</td>
<td style="text-align: left;">(-500&lt;=int16&lt;=470) Number of samples
before the Timestamp pulse (First path index) to be included in the CIR
notification. 0 means the first sample is at the First path index. Units
are [samples]. The default value is ‘-16’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">channelImpulseResponseLength</td>
<td style="text-align: left;">(uint8) Total number of samples to be
included in the CIR notification. Units are [samples]. The default value
is ‘32’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rxSecurityLevel</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=176) The first path
security level allows to make a trade-off between security and
sensitivity. A higher value increases security while it also results in
sensitivity loss. The default value is ‘64’.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.storerxradioconfiginput"><code>UWB.storeRxRadioConfig(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus storeRxRadioConfig(StoreRxRadioConfigCmd* input)</code></p>
<p><strong>Description</strong>: Stores RX radio settings in secure
flash. The index parameter specifies the index of the radio
configuration to be stored.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb89"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> StoreRxRadioConfigCmd rx <span class="op">=</span> <span class="op">{</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>rxRadioCfg <span class="op">=</span> <span class="dv">6</span><span class="op">,</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>radioCfgData <span class="op">=</span> <span class="op">{</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x88</span><span class="op">,</span> <span class="bn">0x13</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x05</span><span class="op">,</span> <span class="bn">0x10</span><span class="op">,</span> <span class="bn">0x14</span><span class="op">,</span> <span class="bn">0x74</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0x7F</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x80</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x56</span><span class="op">,</span> <span class="bn">0x45</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x7C</span><span class="op">,</span> <span class="bn">0x1C</span><span class="op">,</span> <span class="bn">0x40</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x05</span><span class="op">,</span> <span class="bn">0x35</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x7E</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x8F</span><span class="op">,</span> <span class="bn">0x98</span><span class="op">,</span> <span class="bn">0x19</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x70</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x10</span><span class="op">,</span> <span class="bn">0x10</span><span class="op">,</span> <span class="bn">0x14</span><span class="op">,</span> <span class="bn">0x0C</span><span class="op">,</span> <span class="bn">0xC4</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x26</span><span class="op">,</span> <span class="bn">0x54</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x0C</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x1C</span><span class="op">,</span> <span class="bn">0x07</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x1C</span><span class="op">,</span> <span class="bn">0x07</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x7E</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x19</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x19</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x07</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x0F</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x2E</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x10</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x10</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x10</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x50</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x60</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x38</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x0A</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x22</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x09</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x11</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x0F</span><span class="op">,</span> <span class="bn">0x07</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x0F</span><span class="op">,</span> <span class="bn">0x0F</span><span class="op">,</span> <span class="bn">0x05</span><span class="op">,</span> <span class="bn">0x07</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x09</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x11</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x31</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x05</span><span class="op">,</span> <span class="bn">0x07</span><span class="op">,</span> <span class="bn">0x09</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x88</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x9A</span><span class="op">,</span> <span class="bn">0x10</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x07</span><span class="op">,</span> <span class="bn">0x10</span><span class="op">,</span> <span class="bn">0x0E</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x33</span><span class="op">,</span> <span class="bn">0x0A</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x6F</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x29</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xFE</span><span class="op">,</span> <span class="bn">0x21</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x24</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x26</span><span class="op">,</span> <span class="bn">0x0C</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x0C</span><span class="op">,</span> <span class="bn">0x05</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0x59</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x20</span><span class="op">,</span> <span class="bn">0x11</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x07</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x4A</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x30</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x2F</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x0A</span><span class="op">,</span> <span class="bn">0x18</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0x48</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x21</span><span class="op">,</span> <span class="bn">0x80</span><span class="op">,</span> <span class="bn">0x98</span><span class="op">,</span> <span class="bn">0x58</span><span class="op">,</span> <span class="bn">0x10</span><span class="op">,</span> <span class="bn">0x78</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x42</span><span class="op">,</span> <span class="bn">0x80</span><span class="op">,</span> <span class="bn">0x50</span><span class="op">,</span> <span class="bn">0x0E</span><span class="op">,</span> <span class="bn">0x19</span><span class="op">,</span> <span class="bn">0x54</span><span class="op">,</span> <span class="bn">0x4B</span><span class="op">,</span> <span class="bn">0xCA</span><span class="op">,</span> <span class="bn">0x13</span><span class="op">,</span> <span class="bn">0x2B</span><span class="op">,</span> <span class="bn">0xFC</span><span class="op">,</span> <span class="bn">0xDD</span><span class="op">,</span> <span class="bn">0x5E</span><span class="op">,</span> <span class="bn">0x34</span><span class="op">,</span> <span class="bn">0x7D</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x66</span><span class="op">,</span> <span class="bn">0xE3</span><span class="op">,</span> <span class="bn">0x5C</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xEE</span><span class="op">,</span> <span class="bn">0x28</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x7F</span><span class="op">,</span> <span class="bn">0x7F</span><span class="op">,</span> <span class="bn">0x7F</span><span class="op">,</span> <span class="bn">0x7F</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x10</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x5E</span><span class="op">,</span> <span class="bn">0x0F</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0xC2</span><span class="op">,</span> <span class="bn">0xD3</span><span class="op">,</span> <span class="bn">0xA4</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x96</span><span class="op">,</span> <span class="bn">0x35</span><span class="op">,</span> <span class="bn">0x79</span><span class="op">,</span> <span class="bn">0x19</span><span class="op">,</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x14</span><span class="op">,</span> <span class="bn">0x37</span><span class="op">,</span> <span class="bn">0x0C</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0xAC</span><span class="op">,</span> <span class="bn">0xDA</span><span class="op">,</span> <span class="bn">0xDD</span><span class="op">,</span> <span class="bn">0x37</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x79</span><span class="op">,</span> <span class="bn">0x1F</span><span class="op">,</span> <span class="bn">0x0F</span><span class="op">,</span> <span class="bn">0x72</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0x2C</span><span class="op">,</span> <span class="bn">0xF5</span><span class="op">,</span> <span class="bn">0x32</span><span class="op">,</span> <span class="bn">0xAC</span><span class="op">,</span> <span class="bn">0xDA</span><span class="op">,</span> <span class="bn">0xDD</span><span class="op">,</span> <span class="bn">0x37</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x1C</span><span class="op">,</span> <span class="bn">0xFE</span><span class="op">,</span> <span class="bn">0xF8</span><span class="op">,</span> <span class="bn">0x07</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x70</span><span class="op">,</span> <span class="bn">0x47</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x2C</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x00</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>        UciStatus retCode<span class="op">;</span></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>        retCode <span class="op">=</span> UWB<span class="op">.</span>storeRxRadioConfig<span class="op">(&amp;</span>rx<span class="op">);</span></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>retCode <span class="op">!=</span> UCI_STATUS_SUCCESS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;storeRxRadioConfig failed: 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> retCode<span class="op">);</span></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;storeRxRadioConfig success</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">rxRadioCfg</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=15) The index indicating
radio and frame configuration to be used for the receive mode (RX). The
default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">radioCfgData</td>
<td style="text-align: left;">(bytes)</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.storetxradioconfiginput"><code>UWB.storeTxRadioConfig(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus storeTxRadioConfig(StoreTxRadioConfigCmd* input)</code></p>
<p><strong>Description</strong>: Stores TX radio settings in secure
flash. The index parameter specifies the index of the radio
configuration to be stored.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb90"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> StoreTxRadioConfigCmd tx <span class="op">=</span> <span class="op">{</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>txRadioCfg <span class="op">=</span> <span class="dv">6</span><span class="op">,</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>radioCfgData <span class="op">=</span> <span class="op">{</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0xFB</span><span class="op">,</span> <span class="bn">0xF1</span><span class="op">,</span> <span class="bn">0xEE</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0x1C</span><span class="op">,</span> <span class="bn">0x41</span><span class="op">,</span> <span class="bn">0x5A</span><span class="op">,</span> <span class="bn">0x5A</span><span class="op">,</span> <span class="bn">0x41</span><span class="op">,</span> <span class="bn">0x1C</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0xEE</span><span class="op">,</span> <span class="bn">0xF1</span><span class="op">,</span> <span class="bn">0xFB</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0xFB</span><span class="op">,</span> <span class="bn">0xF1</span><span class="op">,</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0xEE</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0x1C</span><span class="op">,</span> <span class="bn">0x41</span><span class="op">,</span> <span class="bn">0x5A</span><span class="op">,</span> <span class="bn">0x5A</span><span class="op">,</span> <span class="bn">0x41</span><span class="op">,</span> <span class="bn">0x1C</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0xEE</span><span class="op">,</span> <span class="bn">0xF1</span><span class="op">,</span> <span class="bn">0xFB</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0xFB</span><span class="op">,</span> <span class="bn">0xF1</span><span class="op">,</span> <span class="bn">0xEE</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0x1C</span><span class="op">,</span> <span class="bn">0x41</span><span class="op">,</span> <span class="bn">0x5A</span><span class="op">,</span> <span class="bn">0x5A</span><span class="op">,</span> <span class="bn">0x41</span><span class="op">,</span> <span class="bn">0x1C</span><span class="op">,</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0xEE</span><span class="op">,</span> <span class="bn">0xF1</span><span class="op">,</span> <span class="bn">0xFB</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x06</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0xFF</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0xFD</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xD0</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x33</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x95</span><span class="op">,</span> <span class="bn">0x0D</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x8A</span><span class="op">,</span> <span class="bn">0xBB</span><span class="op">,</span> <span class="bn">0x3F</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x37</span><span class="op">,</span> <span class="bn">0x40</span><span class="op">,</span> <span class="bn">0xF0</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x4C</span><span class="op">,</span> <span class="bn">0x44</span><span class="op">,</span> <span class="bn">0x13</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x31</span><span class="op">,</span> <span class="bn">0x5C</span><span class="op">,</span> <span class="bn">0x41</span><span class="op">,</span> <span class="bn">0xC0</span><span class="op">,</span> <span class="bn">0x11</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x54</span><span class="op">,</span> <span class="bn">0x75</span><span class="op">,</span> <span class="bn">0xF4</span><span class="op">,</span> <span class="bn">0x34</span><span class="op">,</span> <span class="bn">0xF5</span><span class="op">,</span> <span class="bn">0x0C</span><span class="op">,</span> <span class="bn">0xC4</span><span class="op">,</span> <span class="bn">0x41</span><span class="op">,</span> <span class="bn">0xF4</span><span class="op">,</span> <span class="bn">0x0F</span><span class="op">,</span> <span class="bn">0x0C</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x07</span><span class="op">,</span> <span class="bn">0x4D</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x35</span><span class="op">,</span> <span class="bn">0xD4</span><span class="op">,</span> <span class="bn">0x0C</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xC4</span><span class="op">,</span> <span class="bn">0xC1</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x03</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x2E</span><span class="op">,</span> <span class="bn">0x40</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x0A</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x80</span><span class="op">,</span> <span class="bn">0x01</span><span class="op">,</span> <span class="bn">0x14</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x80</span><span class="op">,</span> <span class="bn">0x3F</span><span class="op">,</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x12</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xF8</span><span class="op">,</span> <span class="bn">0x02</span><span class="op">,</span> <span class="bn">0xE8</span><span class="op">,</span> <span class="bn">0x73</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x24</span><span class="op">,</span> <span class="bn">0x08</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xEF</span><span class="op">,</span> <span class="bn">0x0E</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xE5</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x13</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x14</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x70</span><span class="op">,</span> <span class="bn">0x47</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>            <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x2C</span><span class="op">,</span> <span class="bn">0x04</span><span class="op">,</span> <span class="bn">0x00</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>        UciStatus retCode<span class="op">;</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>        retCode <span class="op">=</span> UWB<span class="op">.</span>storeTxRadioConfig<span class="op">(&amp;</span>tx<span class="op">);</span></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>retCode <span class="op">!=</span> UCI_STATUS_SUCCESS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;storeTxRadioConfig failed: 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> retCode<span class="op">);</span></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;storeTxRadioConfig success</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">txRadioCfg</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=15) The index indicating
radio and frame configuration to be used for the receive mode (TX). The
default value is ‘0’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">radioCfgData</td>
<td style="text-align: left;">(bytes)</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3 id="uwb.importkeyinput"><code>UWB.importKey(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus importKey(ImportKeyCmd* input)</code></p>
<p><strong>Description</strong>: This command imports an AES raw key
intended for STS generation or UWB payload ciphering into the
system.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb91"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>        ImportKeyCmd exampleKey <span class="op">=</span> <span class="op">{</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>keyIdx <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>keyUsage <span class="op">=</span> UWB_DEVICE_IMPORT_KEY_CMD_PAYLOAD_STS_GENERATION<span class="op">,</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>rawKey <span class="op">=</span> <span class="op">{</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>                <span class="bn">0x0d</span><span class="op">,</span> <span class="bn">0xfc</span><span class="op">,</span> <span class="bn">0x5c</span><span class="op">,</span> <span class="bn">0x31</span><span class="op">,</span> <span class="bn">0x98</span><span class="op">,</span> <span class="bn">0xa1</span><span class="op">,</span> <span class="bn">0xbe</span><span class="op">,</span> <span class="bn">0x1a</span><span class="op">,</span> </span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>                <span class="bn">0xe6</span><span class="op">,</span> <span class="bn">0xee</span><span class="op">,</span> <span class="bn">0xcf</span><span class="op">,</span> <span class="bn">0x1b</span><span class="op">,</span> <span class="bn">0xa3</span><span class="op">,</span> <span class="bn">0x13</span><span class="op">,</span> <span class="bn">0xac</span><span class="op">,</span> <span class="bn">0x02</span> </span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>        UciStatus retCode <span class="op">=</span> UWB<span class="op">.</span>importKey<span class="op">(&amp;</span>exampleKey<span class="op">);</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>retCode <span class="op">!=</span> UCI_STATUS_SUCCESS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;importKey failed: </span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> retCode<span class="op">);</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>          Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;importKey success</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">keyIdx</td>
<td style="text-align: left;">(uint8&lt;=0x07) This is a user-selected
key index used to store the imported key in a table of key handles. This
key index can then be referenced by other commands. Eight key slots are
available.</td>
</tr>
<tr class="even">
<td style="text-align: left;">rawKey</td>
<td style="text-align: left;">(bytes) Raw key provides the raw
cryptographic key. For STS generation a AES-128 key is required for UWB
payload ciphering.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">keyUsage</td>
<td style="text-align: left;">(uint8&lt;=1) Provides the usage of key.
The default value is ‘0x00’.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3 id="uwb.getticksoutput"><code>UWB.getTicks(output)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus getTicks(GetTicksRsp* output)</code></p>
<p><strong>Description</strong>: Returns a timestamp from the running
timestamp timer. It shall serve as indication for the application to
determine timed RX/TX operations.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
<tr class="even">
<td style="text-align: left;">timestamp</td>
<td style="text-align: left;">(uint64) The timestamp from the timestamp
timer indicates at which exact point in time a UWB ranging message was
received or transmitted. Units are [ticks].</td>
</tr>
</tbody>
</table>
<h3 id="uwb.setpayloadinput"><code>UWB.setPayload(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus setPayload(SetPayloadCmd* input)</code></p>
<p><strong>Description</strong>: For the current session, adds
(optional) payload data to the upcoming transmission (TX).</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">payloadLength</td>
<td style="text-align: left;">(uint16&lt;=1020) The length of the
payload (in bytes) stored in the payloadData buffer.</td>
</tr>
<tr class="even">
<td style="text-align: left;">payloadData</td>
<td style="text-align: left;">(bytes) Payload data.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h2 id="actions">Actions</h2>
<h3
id="uwb.ontxupdatecallback-txtimestamp"><code>UWB.onTxUpdate(callback, txTimestamp)</code></h3>
<p><strong>Prototype</strong>:
<code>void onTxUpdate(void (*function)(void), TxTimestampNtf* txTimestamp)</code></p>
<p><strong>Description</strong>: To set a callback function (interrupt
service routine) to create fast event-driven procedures and to provide a
data container to store the notification payload for when an update is
ready regarding TX. This is the primary method to receive TX
notifications from the UWB subsystem. In case you are not interested in
the notification payload, you can pass a NULL pointer.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb92"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    TxTimestampNtf txResult<span class="op">;</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> tCommand<span class="op">;</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> tSchedule<span class="op">;</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> tEvent<span class="op">;</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> txEventHandler<span class="op">()</span> <span class="op">{</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>        tEvent <span class="op">=</span> micros<span class="op">();</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span>    </span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onTxUpdate<span class="op">(</span>txEventHandler<span class="op">,</span> <span class="op">&amp;</span>txResult<span class="op">);</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>        UciStatus retCode<span class="op">;</span></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>        tCommand <span class="op">=</span> micros<span class="op">();</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>        retCode <span class="op">=</span> UWB<span class="op">.</span>startTx<span class="op">(</span>ASAP<span class="op">);</span></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>        tSchedule <span class="op">=</span> micros<span class="op">();</span></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>retCode <span class="op">!=</span> UCI_STATUS_SUCCESS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;startTx failed: 0x</span><span class="sc">%X\n</span><span class="st">&quot;</span><span class="op">,</span> retCode<span class="op">);</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">// We get here before txEventHandler() is called (asynchronous programming):</span></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Command/schedule/event = </span><span class="sc">%u</span><span class="st">/</span><span class="sc">%u</span><span class="st">/</span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> tCommand<span class="op">,</span> tSchedule<span class="op">,</span> tEvent<span class="op">);</span></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Example output:</span></span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a><span class="co">    Command/schedule/event = 5008/5034/0</span></span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a><span class="co">    Command/schedule/event = 1009008/1009034/5162</span></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a><span class="co">    Command/schedule/event = 2013008/2013034/1009162</span></span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a><span class="co">    Command/schedule/event = 3018008/3018034/2013162</span></span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a><span class="co">    Command/schedule/event = 4023008/4023034/3018162</span></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">function</td>
<td style="text-align: left;">The function to be called when the
notification occurs must take no parameters and return nothing. This
function must perform very quickly to avoid slowing down or stopping the
operation of the device. Therefore, if some process needs to be executed
when this event occurs, it is recommended to use the
<code>triggerEvent()</code> method within the callback function, in
combination with <code>waitForEvent()</code> elsewhere. In case your isr
function only need to call <code>triggerEvent()</code>, instead of
passing the function pointer cou can simply pass a 16-bit value and
<code>triggerEvent()</code> will called internally with the 16-bit value
as <code>eventId</code>.</td>
</tr>
<tr class="even">
<td style="text-align: left;">txTimestamp</td>
<td style="text-align: left;">(TxTimestampNtf* ) Pointer to a
txTimestampNtf container. To get the most recently captured (RX/TX)
timestamp event.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">txTimestamp-&gt;uciStatus</td>
<td style="text-align: left;">A generic UCI status code. The value of
0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
<tr class="even">
<td style="text-align: left;">txTimestamp-&gt;txTimestamp</td>
<td style="text-align: left;">The captured Timestamp timer value for
when the message is transmitted (TX). The units are in ticks and to
convert its value to seconds you have to multiply it by
1/(128*499.2e6).</td>
</tr>
</tbody>
</table>
<h3
id="uwb.onrxupdatecallback-rxtimestamp-payload-capacity-firstpathinfo-cir"><code>UWB.onRxUpdate(callback, rxTimestamp, payload, capacity, firstPathInfo, cir)</code></h3>
<p><strong>Prototype</strong>:
<code>void onRxUpdate(void (*function)(void), RxTimestampNtf* rxTimestamp, PayloadNtf* payload, uint16_t payloadMaxLength, FirstPathInfoNtf* firstPathInfo, CirNtf* cir)</code></p>
<p><strong>Description</strong>: To set a callback function (interrupt
service routine) to create fast event-driven procedures and to provide
data containers to store the notification payload for when an update is
ready regarding RX. This is the primary method to receive RX
notifications from the UWB subsystem. In case you are not interested in
the notification payload, you can pass a NULL pointer.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb93"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    RxTimestampNtf rxTimestamp<span class="op">;</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> myRxPayloadBuffer<span class="op">[</span><span class="dv">20</span><span class="op">];</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    PayloadNtf<span class="op">*</span> rxPayload <span class="op">=</span> <span class="op">(</span>PayloadNtf<span class="op">*)&amp;</span>myRxPayloadBuffer<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">uint16_t</span> maxRxSize <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span>myRxPayloadBuffer<span class="op">)</span> <span class="op">-</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    FirstPathInfoNtf fpi<span class="op">;</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> myISR<span class="op">()</span> <span class="op">{</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Should be as quick as possible</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>        triggerEvent<span class="op">(</span><span class="dv">1234</span><span class="op">);</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>        attachInterrupt<span class="op">(</span>ERROR_INTERRUPT<span class="op">,</span> Serial<span class="op">.</span>printError<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>        ASSERT_0<span class="op">(</span>UWB<span class="op">.</span>begin<span class="op">());</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onRxUpdate<span class="op">(</span>myISR<span class="op">,</span> <span class="op">&amp;</span>rxTimestamp<span class="op">,</span> rxPayload<span class="op">,</span> maxRxSize<span class="op">,</span> <span class="op">&amp;</span>fpi<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Could also use instead:</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// UWB.onRxUpdate(1234, &amp;rxTimestamp, rxPayload, maxRxSize, &amp;fpi, 0);</span></span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>startContinuousRx<span class="op">(</span>ASAP<span class="op">);</span></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> eventId <span class="op">=</span> waitForEvent<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>eventId <span class="op">==</span> EVENT_TIMEOUT<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Nothing received</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>eventId <span class="op">==</span> <span class="dv">1234</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Received something!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Payload size = </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> rxPayload<span class="op">-&gt;</span>payloadLength<span class="op">);</span></span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Signal strength = </span><span class="sc">%i\n</span><span class="st">&quot;</span><span class="op">,</span> GET_RSSI_x10<span class="op">(</span>fpi<span class="op">.</span>overallRxPower<span class="op">));</span></span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">function</td>
<td style="text-align: left;">The function to be called when the
notification occurs must take no parameters and return nothing. This
function must perform very quickly to avoid slowing down or stopping the
operation of the device. Therefore, if some process needs to be executed
when this event occurs, it is recommended to use the
<code>triggerEvent()</code> method within the callback function, in
combination with <code>waitForEvent()</code> elsewhere. In case your isr
function only need to call <code>triggerEvent()</code>, instead of
passing the function pointer cou can simply pass a 16-bit value and
<code>triggerEvent()</code> will called internally with the 16-bit value
as <code>eventId</code>.</td>
</tr>
<tr class="even">
<td style="text-align: left;">rxTimestamp</td>
<td style="text-align: left;">(RxTimestampNtf* ) Pointer to a
rxTimestampNtf container. To get the most recently captured (RX/TX)
timestamp event.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rxTimestamp-&gt;uciStatus</td>
<td style="text-align: left;">A generic UCI status code. The value of
0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
<tr class="even">
<td style="text-align: left;">rxTimestamp-&gt;rxTimestamp</td>
<td style="text-align: left;">The captured Timestamp timer value for
when the message is received (RX). The units are in ticks and to convert
its value to seconds you have to multiply it by 1/(128*499.2e6).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rxTimestamp-&gt;rxCarrierFreqOffset</td>
<td style="text-align: left;">The device in Receive operation computes
the frequency offset(CFO_INT) between transmitter and receiver carrier
freq. This value will be provided after the Rx operation. To compute the
ppm from this CFO_INT value, the following are the steps: A) Compute CFO
in rad/pi per clock cycle: CFO = CFO_INT/2^17. B) Compute CFO(Hz) =
(124.8MHz/2)*CFO. C) Compute CFO(ppm) = CFO(Hz) / (fc/1e6), where fc is
the carrier frequency and for channel 9 it will be 7.9872GHz.</td>
</tr>
<tr class="even">
<td style="text-align: left;">payload</td>
<td style="text-align: left;">(PayloadNtf* ) Pointer to a payloadNtf
container. Returns the most recently received (RX) payload</td>
</tr>
<tr class="odd">
<td style="text-align: left;">payload-&gt;uciStatus</td>
<td style="text-align: left;">A generic UCI status code. The value of
0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
<tr class="even">
<td style="text-align: left;">payload-&gt;payloadLength</td>
<td style="text-align: left;">The length of the payload (in bytes)
stored in the payloadData buffer.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">payload-&gt;payloadData</td>
<td style="text-align: left;">Payload data.</td>
</tr>
<tr class="even">
<td style="text-align: left;">firstPathInfo</td>
<td style="text-align: left;">(FirstPathInfoNtf* ) Pointer to a
firstPathInfoNtf container. To get the most recently captured (RX)
signal strength.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">firstPathInfo-&gt;uciStatus</td>
<td style="text-align: left;">A generic UCI status code. The value of
0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
<tr class="even">
<td style="text-align: left;">firstPathInfo-&gt;firstPathDetected</td>
<td style="text-align: left;">Indicates the first path was detected and
the ToA estimation results are valid. The first path detected status is
indicated at the least significant bit position. i.e b_firstPathdetected
= (bool) (firstPathdetected &amp; 0x1).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">firstPathInfo-&gt;rfu1</td>
<td style="text-align: left;">Reserved for future use.</td>
</tr>
<tr class="even">
<td style="text-align: left;">firstPathInfo-&gt;edgeIdx</td>
<td style="text-align: left;">Index of first crossing of the detection
threshold.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">firstPathInfo-&gt;fpTime</td>
<td style="text-align: left;">Interpolated ToA result (first path lead
distance) in samples. ToA result = time / 2^15. The first path lead
distance is the distance between the end of CIR and the estimated first
path.</td>
</tr>
<tr class="even">
<td style="text-align: left;">firstPathInfo-&gt;maxTapIndex</td>
<td style="text-align: left;">Index of strongest path. Variable
maxTapIndex is computed from simplified approximation in HW instead of
complex CIR computation.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">firstPathInfo-&gt;maxTapPower</td>
<td style="text-align: left;">Power at the sample specified by
maxTapIndex. Level[dBm] = (log10(2) * 10 * (float)(int16_t)maxTapPower)
/ 0x200.</td>
</tr>
<tr class="even">
<td style="text-align: left;">firstPathInfo-&gt;firstPathIndex</td>
<td style="text-align: left;">Index of first path.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">firstPathInfo-&gt;firstPathPower</td>
<td style="text-align: left;">Power of the first path. The first-path
power is measured at the first-path index found by the ToA algorithm.
Level[dBm] = (log10(2) * 10 * (float)(int16_t)firstPathPower) /
0x200.</td>
</tr>
<tr class="even">
<td style="text-align: left;">firstPathInfo-&gt;noisePower</td>
<td style="text-align: left;">Noise power estimate. Level[dBm] =
(log10(2) * 10 * (float)(int16_t)noisePower) / 0x2000000.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">firstPathInfo-&gt;detectThrPower</td>
<td style="text-align: left;">Detection threshold power level.
Level[dBm] = (log10(2) * 10 * (float)(int16_t)detectThrPower) /
0x2000000.</td>
</tr>
<tr class="even">
<td style="text-align: left;">firstPathInfo-&gt;rfu2</td>
<td style="text-align: left;">Reserved Fields.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">firstPathInfo-&gt;overallRxPower</td>
<td style="text-align: left;">Overall received power computed by the Rx
front end. Level[dBm] = (log10(2) * 10 * (float)overallRxPower) /
0x2000000.</td>
</tr>
<tr class="even">
<td style="text-align: left;">firstPathInfo-&gt;phr</td>
<td style="text-align: left;">Structure for the Physical Header (PHR)
field of the UWB frame.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cir</td>
<td style="text-align: left;">(CirNtf* ) Pointer to a cirNtf container.
Returns the most recent Channel Input Response (RX)</td>
</tr>
<tr class="even">
<td style="text-align: left;">cir-&gt;uciStatus</td>
<td style="text-align: left;">A generic UCI status code. The value of
0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cir-&gt;fpIndex</td>
<td style="text-align: left;">Indicates at which sample the first path
is detected. A value of 255 means that the first path index is not
present in the samples contained.</td>
</tr>
<tr class="even">
<td style="text-align: left;">cir-&gt;cirLength</td>
<td style="text-align: left;">The length of the payload (in bytes)
stored in the cirData buffer.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cir-&gt;cirData</td>
<td style="text-align: left;">The CIR buffer data. Contains at most 255
samples. The cir data consists of a 16 bit real part and 16 bit
imaginary part.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.onloopbackupdatecallback-loopbacktimestamp"><code>UWB.onLoopbackUpdate(callback, loopbackTimestamp)</code></h3>
<p><strong>Prototype</strong>:
<code>void onLoopbackUpdate(void (*function)(void), LoopbackTimestampNtf* loopbackTimestamp)</code></p>
<p><strong>Description</strong>: To set a callback function (interrupt
service routine) to create fast event-driven procedures and to provide a
data container to store the notification payload for when an update is
ready regarding LOOPBACK. This is the primary method to receive LOOPBACK
notifications from the UWB subsystem. In case you are not interested in
the notification payload, you can pass a NULL pointer.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">function</td>
<td style="text-align: left;">The function to be called when the
notification occurs must take no parameters and return nothing. This
function must perform very quickly to avoid slowing down or stopping the
operation of the device. Therefore, if some process needs to be executed
when this event occurs, it is recommended to use the
<code>triggerEvent()</code> method within the callback function, in
combination with <code>waitForEvent()</code> elsewhere. In case your isr
function only need to call <code>triggerEvent()</code>, instead of
passing the function pointer cou can simply pass a 16-bit value and
<code>triggerEvent()</code> will called internally with the 16-bit value
as <code>eventId</code>.</td>
</tr>
<tr class="even">
<td style="text-align: left;">loopbackTimestamp</td>
<td style="text-align: left;">(LoopbackTimestampNtf* ) Pointer to a
loopbackTimestampNtf container. To get the most recently captured
(RX/TX) timestamp event.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">loopbackTimestamp-&gt;uciStatus</td>
<td style="text-align: left;">A generic UCI status code. The value of
0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
<tr class="even">
<td style="text-align: left;">loopbackTimestamp-&gt;txTimestamp</td>
<td style="text-align: left;">The captured Timestamp timer value for
when the message is transmitted (TX). The units are in ticks and to
convert its value to seconds you have to multiply it by
1/(128*499.2e6).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">loopbackTimestamp-&gt;rxTimestamp</td>
<td style="text-align: left;">The captured Timestamp timer value for
when the message is received (RX). The units are in ticks and to convert
its value to seconds you have to multiply it by 1/(128*499.2e6).</td>
</tr>
<tr class="even">
<td
style="text-align: left;">loopbackTimestamp-&gt;rxCarrierFreqOffset</td>
<td style="text-align: left;">The device in Receive operation computes
the frequency offset(CFO_INT) between transmitter and receiver carrier
freq. This value will be provided after the Rx operation. To compute the
ppm from this CFO_INT value, the following are the steps: A) Compute CFO
in rad/pi per clock cycle: CFO = CFO_INT/2^17. B) Compute CFO(Hz) =
(124.8MHz/2)*CFO. C) Compute CFO(ppm) = CFO(Hz) / (fc/1e6), where fc is
the carrier frequency and for channel 9 it will be 7.9872GHz.</td>
</tr>
</tbody>
</table>
<h3 id="uwb.begin"><code>UWB.begin()</code></h3>
<p><strong>Prototype</strong>: <code>UciStatus begin()</code></p>
<p><strong>Description</strong>: To activate the XTAL and UWB
circuitry.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb94"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fails:</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>        ASSERT<span class="op">(</span>UWB<span class="op">.</span>startTx<span class="op">(</span><span class="dv">0</span><span class="op">),</span> SUCCESS<span class="op">);</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Succeeds:</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>        ASSERT<span class="op">(</span>UWB<span class="op">.</span>startTx<span class="op">(</span><span class="dv">0</span><span class="op">),</span> SUCCESS<span class="op">);</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;done</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  </span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* example output:</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Returned 0x73 at line 5</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a><span class="co">    done</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span>  </span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3 id="uwb.starttxinput"><code>UWB.startTx(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus startTx(StartTxCmd* input)</code></p>
<p><strong>Description</strong>: To transmit a UWB message at the
specified time, or as soon as possible.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb95"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>startTx<span class="op">(</span>NULL<span class="op">);</span> <span class="co">// Transmit (empty) message</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>        </span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">time</td>
<td style="text-align: left;">(uint64&gt;=0x00) The time (in ticks with
15.65ps resolution) when the transmission is started. A value of 0 means
transmit as soon as possible. Fractional timestamp resolution is in
ticks, with 128 times 499.2 ticks per microsecond, i.e, 15.65 picosecs
per tick. However, the TX hardware only supports timed TX operation with
32 ticks (500.8 ps) resolution. Hence the Fractional TS passed as input
will be adjusted accordingly. Units are [ticks].</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3 id="uwb.startrxinput"><code>UWB.startRx(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus startRx(StartRxCmd* input)</code></p>
<p><strong>Description</strong>: To start listening for a UWB message at
the specified time, or as soon as possible. Stop listening using the
StopAction command.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb96"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> received<span class="op">()</span> <span class="op">{</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Received message!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Listening...</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onRxUpdate<span class="op">(</span>received<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>startRx<span class="op">(</span>ASAP<span class="op">);</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb97"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Listening...</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onRxUpdate<span class="op">(</span><span class="dv">123</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>startRx<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>        waitForEvent<span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// block</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Received message!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>        </span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">time</td>
<td style="text-align: left;">(uint64&gt;=0x00) The time (in ticks with
15.65ps resolution) when the reception is started. A value of 0 means
start reception as soon as possible. Units are [ticks].</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.startcontinuousrxinput"><code>UWB.startContinuousRx(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus startContinuousRx(StartContinuousRxCmd* input)</code></p>
<p><strong>Description</strong>: To start listening for a UWB message at
the specified time, or as soon as possible, and restart listening each
time a message is received. Stop listening using the StopAction
command.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">time</td>
<td style="text-align: left;">(uint64&gt;=0x00) The time (in ticks with
15.65ps resolution) when the reception is started. A value of 0 means
start reception as soon as possible. Units are [ticks].</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.startloopbackinput"><code>UWB.startLoopback(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus startLoopback(StartLoopbackCmd* input)</code></p>
<p><strong>Description</strong>: This command is intended for
calibrating the device by determining antenna delay. To do so the
command starts a loop-back transmission/reception mode according to the
current radio configuration. The antenna delay (i.e. difference between
the TX and RX timestamps in the LoopbackTimestamp result) should be
subtracted from the round-trip time in the two-way-ranging calculation
in order to get accurate distance measurements.</p>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb98"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    LoopbackTimestampNtf observed<span class="op">;</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> ready<span class="op">()</span> <span class="op">{</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> d <span class="op">=</span> observed<span class="op">.</span>rxTimestamp <span class="op">-</span> observed<span class="op">.</span>txTimestamp<span class="op">;</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Antenna delay = </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> d<span class="op">);</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onLoopbackUpdate<span class="op">(</span>ready<span class="op">,</span> <span class="op">&amp;</span>observed<span class="op">);</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>startLoopback<span class="op">(</span>ASAP<span class="op">);</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* example output:</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Antenna delay = 13916</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Code example:</strong></p>
<div class="sourceCode" id="cb99"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;user-application.h&quot;</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>        LoopbackTimestampNtf observed<span class="op">;</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>onLoopbackUpdate<span class="op">(</span><span class="dv">123</span><span class="op">,</span> <span class="op">&amp;</span>observed<span class="op">);</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>        UWB<span class="op">.</span>startLoopback<span class="op">(</span>ASAP<span class="op">);</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>        ASSERT<span class="op">(</span>waitForEvent<span class="op">(</span><span class="dv">5</span><span class="op">),</span> <span class="dv">123</span><span class="op">);</span> <span class="co">// block and check</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> d <span class="op">=</span> observed<span class="op">.</span>rxTimestamp <span class="op">-</span> observed<span class="op">.</span>txTimestamp<span class="op">;</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;Antenna delay = </span><span class="sc">%u\n</span><span class="st">&quot;</span><span class="op">,</span> d<span class="op">);</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* example output:</span></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Antenna delay = 13916</span></span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">time</td>
<td style="text-align: left;">(uint64&gt;=0x00) The time (in ticks with
15.65ps resolution) when the loopback is started. Units are
[ticks].</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3 id="uwb.recalcrxinput"><code>UWB.recalcRx(input)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus recalcRx(RecalcRxCmd* input)</code></p>
<p><strong>Description</strong>: This function re-runs ToA Algorithm on
the previously captured CIR Data with the input first path security
level.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">rxSecurityLevel</td>
<td style="text-align: left;">(0&lt;=uint8&lt;=176) The first path
security level allows to make a trade-off between security and
sensitivity. A higher value increases security while it also results in
sensitivity loss. The default value is ‘64’.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3 id="uwb.stopaction"><code>UWB.stopAction()</code></h3>
<p><strong>Prototype</strong>: <code>UciStatus stopAction()</code></p>
<p><strong>Description</strong>: This function will stop the current UWB
TX/RX action (if any).</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h3
id="uwb.getcirinput-output"><code>UWB.getCir(input, output)</code></h3>
<p><strong>Prototype</strong>:
<code>UciStatus getCir(GetCirCmd* input, GetCirRsp* output)</code></p>
<p><strong>Description</strong>: Returns the most recent Channel Input
Response (RX).</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Input</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">channelImpulseResponseStart</td>
<td style="text-align: left;">(-500&lt;=int16&lt;=470) Number of samples
before the Timestamp pulse (First path index) to be included in the CIR
notification. 0 means the first sample is at the First path index. Units
are [samples]. The default value is ‘-16’.</td>
</tr>
<tr class="even">
<td style="text-align: left;">channelImpulseResponseLength</td>
<td style="text-align: left;">(uint8) Total number of samples to be
included in the CIR notification. Units are [samples]. The default value
is ‘32’.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
<tr class="even">
<td style="text-align: left;">fpIndex</td>
<td style="text-align: left;">(uint8) Indicates at which sample the
first path is detected. A value of 255 means that the first path index
is not present in the samples contained. The default value is
‘255’.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cirLength</td>
<td style="text-align: left;">(uint16&lt;=1020) The length of the
payload (in bytes) stored in the cirData buffer.</td>
</tr>
<tr class="even">
<td style="text-align: left;">cirData</td>
<td style="text-align: left;">(bytes) The CIR buffer data. Contains at
most 255 samples. The cir data consists of a 16 bit real part and 16 bit
imaginary part.</td>
</tr>
</tbody>
</table>
<h3 id="uwb.end"><code>UWB.end()</code></h3>
<p><strong>Prototype</strong>: <code>UciStatus end()</code></p>
<p><strong>Description</strong>: To deactivate the XTAL and UWB
circuitry.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Output</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">uciStatus</td>
<td style="text-align: left;">(enum) A generic UCI status code. The
value of 0x00 indicates no error occurred. Please see the <a
href="#uci-status">Uci status table</a> below.</td>
</tr>
</tbody>
</table>
<h2 id="uci-status-codes">UCI Status Codes</h2>
<h5 id="uci-status">Uci status</h5>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Label / Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;"><em>UCI_STATUS_SUCCESS</em>. - Indicates a
successful command, sub command or firmware function execution.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x01</td>
<td style="text-align: left;"><em>UCI_STATUS_REJECTED</em>. - Intended
operation is not supported in the current state.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x02</td>
<td style="text-align: left;"><em>UCI_STATUS_FAILED</em>. - Intended
operation failed to complete.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x03</td>
<td style="text-align: left;"><em>UCI_STATUS_SYNTAX_ERROR</em>. - UCI
packet structure is not per spec.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x04</td>
<td style="text-align: left;"><em>UCI_STATUS_INVALID_PARAM</em>. -
Config ID is correct, and value is not specified.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x05</td>
<td style="text-align: left;"><em>UCI_STATUS_INVALID_RANGE</em>. -
Config ID is correct, and value is not in proper range.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x06</td>
<td style="text-align: left;"><em>UCI_STATUS_INVALID_MESSAGE_SIZE</em>.
- UCI packet payload size is not as per spec.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x07</td>
<td style="text-align: left;"><em>UCI_STATUS_UNKNOWN_GID</em>. - UCI
Group ID is not per spec.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x08</td>
<td style="text-align: left;"><em>UCI_STATUS_UNKNOWN_OID</em>. - UCI
Opcode ID is not per spec.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x09</td>
<td style="text-align: left;"><em>UCI_STATUS_READ_ONLY</em>. - Config ID
is read-only.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x0A</td>
<td style="text-align: left;"><em>UCI_STATUS_COMMAND_RETRY</em>. - UWBS
request retransmission from AP.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x11</td>
<td
style="text-align: left;"><em>UCI_STATUS_ERROR_SESSION_NOT_EXIST</em>. -
Session does not exist (is not created).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x12</td>
<td
style="text-align: left;"><em>UCI_STATUS_ERROR_SESSION_DUPLICATE</em>. -
Session exists (is already created).</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x13</td>
<td style="text-align: left;"><em>UCI_STATUS_ERROR_SESSION_ACTIVE</em>.
- Session is active.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x14</td>
<td
style="text-align: left;"><em>UCI_STATUS_ERROR_MAX_SESSIONS_EXCEEDED</em>.
- Max. number of sessions already created.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x15</td>
<td
style="text-align: left;"><em>UCI_STATUS_ERROR_SESSION_NOT_CONFIGURED</em>.
- Session is not configured with required app configurations.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x16</td>
<td
style="text-align: left;"><em>UCI_STATUS_ERROR_ACTIVE_SESSIONS_ONGOING</em>.
- Sessions are actively running in UWBS.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x17</td>
<td
style="text-align: left;"><em>UCI_STATUS_ERROR_MULTICAST_LIST_FULL</em>.
- Indicates when multicast list is full during one to many ranging.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x18</td>
<td
style="text-align: left;"><em>UCI_STATUS_ERROR_ADDRESS_NOT_FOUND</em>. -
Indicates when multicast list is full during one to many ranging.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x19</td>
<td
style="text-align: left;"><em>UCI_STATUS_ERROR_ADDRESS_ALREADY_PRESENT</em>.
- Indicates when short address is already present.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x1A</td>
<td
style="text-align: left;"><em>UCI_STATUS_SLOT_LEN_NOT_SUPPORTED</em>. -
Slot length is not supported in the requested configuration.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x1B</td>
<td style="text-align: left;"><em>UCI_STATUS_INVALID_SLOT_PER_RR</em>. -
Slot length is not supported in the requested configuration.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x1C</td>
<td style="text-align: left;"><em>UCI_STATUS_STS_NOT_CONFIGURED</em>. -
Radio config requires STS configuration.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x20</td>
<td style="text-align: left;"><em>UCI_STATUS_RANGING_TX_FAILED</em>. -
Failed to transmit UWB packet.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x21</td>
<td style="text-align: left;"><em>UCI_STATUS_RANGING_RX_TIMEOUT</em>. -
No UWB packet detected by the receiver.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x22</td>
<td
style="text-align: left;"><em>UCI_STATUS_RANGING_RX_PHY_DEC_FAILED</em>.
- UWB packet channel decoding error.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x23</td>
<td
style="text-align: left;"><em>UCI_STATUS_RANGING_RX_PHY_TOA_FAILED</em>.
- Failed to detect time of arrival of the UWB packet from CIR
samples.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x24</td>
<td
style="text-align: left;"><em>UCI_STATUS_RANGING_RX_PHY_STS_FAILED</em>.
- UWB packet STS segment mismatch.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x25</td>
<td
style="text-align: left;"><em>UCI_STATUS_RANGING_RX_MAC_DEC_FAILED</em>.
- MAC CRC or syntax error.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x26</td>
<td
style="text-align: left;"><em>UCI_STATUS_RANGING_RX_MAC_IE_DEC_FAILED</em>.
- IE syntax error.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x27</td>
<td
style="text-align: left;"><em>UCI_STATUS_RANGING_RX_MAC_IE_MISSING</em>.
- Expected IE missing in the packet.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x35</td>
<td style="text-align: left;"><em>UCI_STATUS_PARAM_TOO_HIGH</em>. -
Value is not in proper range: too high.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x36</td>
<td style="text-align: left;"><em>UCI_STATUS_PARAM_TOO_LOW</em>. - Value
is not in proper range: too low.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x37</td>
<td style="text-align: left;"><em>UCI_STATUS_PAYLOAD_TOO_BIG</em>. - The
buffer provided by the user is too small to fit the received
payload.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x38</td>
<td style="text-align: left;"><em>UCI_STATUS_SCHEDULED_TOO_EARLY</em>. -
This status indicates that the scheduled action cannot be executed
because the provided time lies too far into the future.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x39</td>
<td style="text-align: left;"><em>UCI_STATUS_SCHEDULED_TOO_LATE</em>. -
This status indicates that the scheduled action cannot be executed
because the provided time lies not far enough into the future.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x51</td>
<td style="text-align: left;"><em>UCI_STATUS_GENERAL_ERROR</em>. -
Indicates the returning functions failed without further
information.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x55</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_UNIT_NUMBER</em>. -
Invalid device unit number.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x56</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_INSTANCE</em>. - Bad
input instance value.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x57</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_HANDLE</em>. - Bad
input handle.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x58</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_INDEX</em>. - Bad input
index.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x59</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_PARAMETER</em>. -
Invalid input parameter.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x5A</td>
<td style="text-align: left;"><em>UCI_STATUS_NO_INSTANCES</em>. - No
instances available.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x5B</td>
<td style="text-align: left;"><em>UCI_STATUS_NO_COMPONENT</em>. -
Component is not present.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x5C</td>
<td style="text-align: left;"><em>UCI_STATUS_NO_RESOURCES</em>. -
Resource is not available.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x5D</td>
<td style="text-align: left;"><em>UCI_STATUS_INSTANCE_IN_USE</em>. -
Instance is already in use.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x5E</td>
<td style="text-align: left;"><em>UCI_STATUS_RESOURCE_OWNED</em>. -
Resource is already in use.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x5F</td>
<td style="text-align: left;"><em>UCI_STATUS_RESOURCE_NOT_OWNED</em>. -
Caller does not own resource.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x60</td>
<td style="text-align: left;"><em>UCI_STATUS_INCONSISTENT_PARAMS</em>. -
Inconsistent input params.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x61</td>
<td style="text-align: left;"><em>UCI_STATUS_NOT_INITIALIZED</em>. -
Component is not initialized.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x62</td>
<td style="text-align: left;"><em>UCI_STATUS_NOT_ENABLED</em>. -
Component is not enabled.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x63</td>
<td style="text-align: left;"><em>UCI_STATUS_NOT_SUPPORTED</em>. -
Function is not supported.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x64</td>
<td style="text-align: left;"><em>UCI_STATUS_INIT_FAILED</em>. -
Initialization failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x65</td>
<td style="text-align: left;"><em>UCI_STATUS_BUSY</em>. - Component is
busy.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x66</td>
<td style="text-align: left;"><em>UCI_STATUS_NOT_BUSY</em>. - Component
is not busy.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x67</td>
<td style="text-align: left;"><em>UCI_STATUS_READ</em>. - Read
error.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x68</td>
<td style="text-align: left;"><em>UCI_STATUS_WRITE</em>. - Write
error.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x69</td>
<td style="text-align: left;"><em>UCI_STATUS_ERASE</em>. - Erase
error.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x6A</td>
<td style="text-align: left;"><em>UCI_STATUS_LOCK</em>. - Lock
error.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x6B</td>
<td style="text-align: left;"><em>UCI_STATUS_UNLOCK</em>. - Unlock
error.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x6C</td>
<td style="text-align: left;"><em>UCI_STATUS_OUT_OF_MEMORY</em>. -
Memory allocation failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x6D</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_VIRT_ADDRESS</em>. -
Bad virtual address.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x6E</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_PHYS_ADDRESS</em>. -
Bad physical address.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x6F</td>
<td style="text-align: left;"><em>UCI_STATUS_TIMEOUT</em>. - Timeout
error.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x70</td>
<td style="text-align: left;"><em>UCI_STATUS_OVERFLOW</em>. - Data
overflow/overrun error.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x71</td>
<td style="text-align: left;"><em>UCI_STATUS_FULL</em>. - Queue (etc.)
is full.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x72</td>
<td style="text-align: left;"><em>UCI_STATUS_EMPTY</em>. - Queue, TX
payload (etc.) is empty.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x73</td>
<td style="text-align: left;"><em>UCI_STATUS_NOT_STARTED</em>. -
Streaming function failed or session should be started first.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x74</td>
<td style="text-align: left;"><em>UCI_STATUS_ALREADY_STARTED</em>. -
Start function failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x75</td>
<td style="text-align: left;"><em>UCI_STATUS_NOT_STOPPED</em>. -
Non-streaming function failed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x76</td>
<td style="text-align: left;"><em>UCI_STATUS_ALREADY_STOPPED</em>. -
Stop function failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x77</td>
<td style="text-align: left;"><em>UCI_STATUS_ALREADY_SETUP</em>. - Setup
function failed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x78</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_PARAMETER</em>. - Null
input parameter.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x79</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_DATAINFUNC</em>. -
Null data input function.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x7A</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_DATAOUTFUNC</em>. -
Null data output function.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x7B</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_CONTROLFUNC</em>. -
Null control function.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x7C</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_COMPLETIONFUNC</em>. -
Null completion function.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x7D</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_PROGRESSFUNC</em>. -
Null progress function.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x7E</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_ERRORFUNC</em>. - Null
error handler function.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x7F</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_MEMALLOCFUNC</em>. -
Null memory alloc function.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x80</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_MEMFREEFUNC</em>. -
Null memory free function.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x81</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_CONFIGFUNC</em>. -
Null configuration function.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x82</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_PARENT</em>. - Null
parent data.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x83</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_IODESC</em>. - Null
in/out descriptor.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x84</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_CTRLDESC</em>. - Null
control descriptor.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x85</td>
<td style="text-align: left;"><em>UCI_STATUS_UNSUPPORTED_DATACLASS</em>.
- Unsupported data class.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x86</td>
<td style="text-align: left;"><em>UCI_STATUS_UNSUPPORTED_DATATYPE</em>.
- Unsupported data type.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x87</td>
<td
style="text-align: left;"><em>UCI_STATUS_UNSUPPORTED_DATASUBTYPE</em>. -
Unsupported data subtype.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x88</td>
<td style="text-align: left;"><em>UCI_STATUS_FORMAT</em>. -
Invalid/unsupported format.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x89</td>
<td style="text-align: left;"><em>UCI_STATUS_INPUT_DESC_FLAGS</em>. -
Bad input descriptor flags.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x8A</td>
<td style="text-align: left;"><em>UCI_STATUS_OUTPUT_DESC_FLAGS</em>. -
Bad output descriptor flags.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x8B</td>
<td style="text-align: left;"><em>UCI_STATUS_CAP_REQUIRED</em>. -
Capabilities required ???.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x8C</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_TMALFUNC_TABLE</em>. -
Bad TMAL function table.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x8D</td>
<td style="text-align: left;"><em>UCI_STATUS_INVALID_CHANNEL_ID</em>. -
Invalid channel identifier.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x8E</td>
<td style="text-align: left;"><em>UCI_STATUS_INVALID_COMMAND</em>. -
Invalid command/request.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x8F</td>
<td style="text-align: left;"><em>UCI_STATUS_STREAM_MODE_CONFUSION</em>.
- Stream mode config conflict.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x90</td>
<td style="text-align: left;"><em>UCI_STATUS_UNDERRUN</em>. - Data
underflow/underrun.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x91</td>
<td style="text-align: left;"><em>UCI_STATUS_EMPTY_PACKET_RECVD</em>. -
Empty data packet received.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x92</td>
<td style="text-align: left;"><em>UCI_STATUS_OTHER_DATAINOUT_ERR</em>. -
Other data input/output err.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x93</td>
<td style="text-align: left;"><em>UCI_STATUS_STOP_REQUESTED</em>. - Stop
in progress.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x94</td>
<td style="text-align: left;"><em>UCI_STATUS_LPUART_RX_HW_OVERRUN</em>.
- UART RX Buffer overflow.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x95</td>
<td style="text-align: left;"><em>UCI_STATUS_LPUART_NOISE_ERROR</em>. -
UART RX Noise error.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x96</td>
<td style="text-align: left;"><em>UCI_STATUS_LPUART_FRAMING_ERROR</em>.
- UART RX Framing error.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x97</td>
<td style="text-align: left;"><em>UCI_STATUS_LPUART_PARITY_ERROR</em>. -
UART RX Parity error.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x98</td>
<td
style="text-align: left;"><em>UCI_STATUS_LPUART_FLAG_NO_MANUAL_CLEAR</em>.
- UART STATUS Flags clear failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x99</td>
<td style="text-align: left;"><em>UCI_STATUS_ASSERTION</em>. - Assertion
failure.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x9A</td>
<td style="text-align: left;"><em>UCI_STATUS_HIGHWAY_BANDWIDTH</em>. -
Highway bandwidth bus error.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x9B</td>
<td style="text-align: left;"><em>UCI_STATUS_HW_RESET_FAILED</em>. -
Hardware reset failed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x9D</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_FLAGS</em>. - Bad
flags.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0x9E</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_PRIORITY</em>. - Bad
priority.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0x9F</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_REFERENCE_COUNT</em>. -
Bad reference count.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xA0</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_SETUP</em>. - Bad
setup.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xA1</td>
<td style="text-align: left;"><em>UCI_STATUS_BAD_STACK_SIZE</em>. - Bad
stack size.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xA2</td>
<td style="text-align: left;"><em>UCI_STATUS_IDLE</em>. - Indicates that
a RF RX channel does not have retrievable data.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xA3</td>
<td style="text-align: left;"><em>UCI_STATUS_NULL_PACKET</em>. - Null
packet.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xA4</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_INVLD_PAGE_ADDR_PARAM</em>.
- A wrong PFLASH page address has been passed as input.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xA5</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_CMD_EXECUTION_FAILED</em>.
- Indicates flash command execution failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xA6</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_OPERATION_TIMEOUT</em>.
- Indicates ongoing PFLASH operation timed out.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xA7</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_WRITE_WORD_CMD_FAILED</em>.
- Indicates PFLASH Write word command failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xA8</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_PROGRAM_PAGE_CMD_FAILED</em>.
- Indicates pflash program page command failed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xA9</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_ERASE_PAGE_RANGE_FAILED</em>.
- Indicates pflash erase page range command failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xAA</td>
<td style="text-align: left;"><em>UCI_STATUS_ECC</em>. - Indicates that
a page flash page contains ECC errors.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xAB</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_MARGIN_CHECK_FAILED</em>.
- Indicates PFLASH margin check failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xAC</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_BLANK_CHECK_FAILED</em>.
- Indicates PFLASH blank check failed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xAD</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_PAGE_CORRUPTED</em>.
- Indicates PFLASH page corrupted.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xAE</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_PAGE_PROGRAMMED</em>.
- Indicates PFLASH page programmed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xAF</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_PAGE_ERASED</em>. -
Indicates PFLASH page erased.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xB0</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_CHECKSUM_PAGE_CMD_FAILED</em>.
- Indicates PFLASH checksum page command failed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xB1</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_ERASE_PAGE_FAILED</em>.
- Indicates PFLASH Erase page failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xB2</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_INVLD_WORD_ADDR_PARAM</em>.
- A wrong PFLASH word address has been passed as input.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xB3</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_SET_READ_MODE_ERROR</em>.
- Indicates that set read mode command execution failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xB4</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_INIT_FAILED</em>. -
Indicates that a page flash page initialization has failed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xB5</td>
<td style="text-align: left;"><em>UCI_STATUS_PAGE_REPAIR</em>. -
Indicates that the page write failed because all AMU wear-leveling
mappings are already in use.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xB6</td>
<td style="text-align: left;"><em>UCI_STATUS_IMAGECHECK_FAILED</em>. -
Indicates that an image verification failed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xB7</td>
<td style="text-align: left;"><em>UCI_STATUS_INVALID_STATE</em>. -
Indicates the function is activated but the overall state is invalid to
execute it correctly.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xB8</td>
<td
style="text-align: left;"><em>UCI_STATUS_OPERATION_NOT_PERMITTED</em>. -
Corresponds to Operation whose access is protected.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xB9</td>
<td style="text-align: left;"><em>UCI_STATUS_NOT_CLOCKED</em>. - Power
down - clocked off.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xBA</td>
<td style="text-align: left;"><em>UCI_STATUS_INVALID_PSDU_LEN</em>. -
Invalid PSDU length.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xBB</td>
<td style="text-align: left;"><em>UCI_STATUS_INVALID_TIMEOUT_TIME</em>.
- Invalid timeout time.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xBC</td>
<td style="text-align: left;"><em>UCI_STATUS_CONCURRENT_ACCESS</em>. -
Indicates that there was a concurrent access to a resource.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xBD</td>
<td style="text-align: left;"><em>UCI_STATUS_STORE_AMU</em>. - Indicates
that updating the page flash AMU configuration failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xBE</td>
<td style="text-align: left;"><em>UCI_STATUS_REMAP_AMU</em>. -
Indicaties that configuring the page flash AMU failed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xBF</td>
<td style="text-align: left;"><em>UCI_STATUS_INIT_AMU</em>. - Indicaties
AMU initialization failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xC0</td>
<td style="text-align: left;"><em>UCI_STATUS_PAGE_MARGIN_VERIFY</em>. -
Indicates failed page write due to maring verify error.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xC1</td>
<td style="text-align: left;"><em>UCI_STATUS_AMU_DISABLED</em>. -
Indicaties that AMU is disabled.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xC2</td>
<td style="text-align: left;"><em>UCI_STATUS_COMPATIBILITY</em>. - SW
Interface compatibility.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xC3</td>
<td
style="text-align: left;"><em>UCI_STATUS_TRIM_WITH_HARDWARE_DEFAULTS</em>.
- Indicates TRIMing used hardware RESET defaults only.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xC4</td>
<td style="text-align: left;"><em>UCI_STATUS_CRC</em>. - Indicates a CRC
error in a transmitted data packet.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xC5</td>
<td style="text-align: left;"><em>UCI_STATUS_FLASH_PAGE_COPY</em>. -
Indicates flash inter-page copy failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xC6</td>
<td
style="text-align: left;"><em>UCI_STATUS_PAGE_FLASH_REPORT_ECC_LOG_ERROR</em>.
- Indicates that report ECC log command execution failed.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xC7</td>
<td style="text-align: left;"><em>UCI_STATUS_RS_UNDECODABLE</em>. - RS
input is un-decodable, possible due to too many erasures or unsolvable
equation or locator does not split.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xC8</td>
<td
style="text-align: left;"><em>UCI_STATUS_RS_ILLEGAL_ERASURES_NUM</em>. -
No. of Erasures info not valid.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xC9</td>
<td
style="text-align: left;"><em>UCI_STATUS_RS_ILLEGAL_ERASURES_LOCATION</em>.
- Erasure location info not valid.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xCA</td>
<td style="text-align: left;"><em>UCI_STATUS_RS_ILLEGAL_PARAMS</em>. -
Invalid input parameters to rs decoder.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xCB</td>
<td style="text-align: left;"><em>UCI_STATUS_SECDED_UNDECODABLE</em>. -
SECDED decoder error state.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xCC</td>
<td style="text-align: left;"><em>UCI_STATUS_TOA_UNDETECTED</em>. -
Indicates an undetected ToA startup.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xCD</td>
<td style="text-align: left;"><em>UCI_STATUS_VERIFICATION_FAILED</em>. -
Signature verification failed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xCE</td>
<td style="text-align: left;"><em>UCI_STATUS_INVALID_CFG</em>. - This
status indicates invalid configuration.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xCF</td>
<td style="text-align: left;"><em>UCI_STATUS_NO_TRIM_DATA_ERR</em>. -
This status indicates unavailability of PFLASH stored TRIMming
data.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xD1</td>
<td style="text-align: left;"><em>UCI_STATUS_AUTHENT_FAIL</em>. - This
status indicates a failing authentication.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xD2</td>
<td
style="text-align: left;"><em>UCI_STATUS_CALL_FROM_ISR_NOT_ALLOWED</em>.
- This function must not be called from within a interrupt service
routine.</td>
</tr>
<tr class="even">
<td style="text-align: left;">0xF8</td>
<td style="text-align: left;"><em>UCI_STATUS_CRC_ERROR</em>. - Occurs
when the CRC verification checksum is wrong. Note that this status is
available only if SET_CRC_CFG_CMD is set to enable.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0xFE</td>
<td style="text-align: left;"><em>UCI_STATUS_NOT_IMPLEMENTED</em>. -
Default return code value value.</td>
</tr>
</tbody>
</table>
<h2 id="radio-config-table">Radio Config Table</h2>
<h5 id="section"></h5>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Index</th>
<th>Preample</th>
<th>STS Chips</th>
<th>Payload</th>
<th>Low FS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td>32 symbols</td>
<td>0</td>
<td>YES</td>
<td>ON</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td>32 symbols</td>
<td>8192</td>
<td>YES</td>
<td>ON</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td>32 symbols</td>
<td>8192</td>
<td>NO</td>
<td>ON</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td>32 symbols</td>
<td>0</td>
<td>YES</td>
<td>OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td>32 symbols</td>
<td>8192</td>
<td>YES</td>
<td>OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td>32 symbols</td>
<td>8192</td>
<td>NO</td>
<td>OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td>1024 symbols</td>
<td>0</td>
<td>YES</td>
<td>OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td>32 symbols</td>
<td>0</td>
<td>YES</td>
<td>ON</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td>32 symbols</td>
<td>16384</td>
<td>YES</td>
<td>ON</td>
</tr>
<tr class="even">
<td style="text-align: left;">9</td>
<td>32 symbols</td>
<td>16384</td>
<td>NO</td>
<td>ON</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10</td>
<td>32 symbols</td>
<td>0</td>
<td>YES</td>
<td>OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">11</td>
<td>32 symbols</td>
<td>16384</td>
<td>YES</td>
<td>OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">12</td>
<td>32 symbols</td>
<td>16384</td>
<td>NO</td>
<td>OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">13</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left;">14</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;">15</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</body>
</html>
